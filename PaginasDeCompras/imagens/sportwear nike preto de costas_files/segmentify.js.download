/* c7a4d925eb3d5b7ffed71afb748df97493a55ff9 Mon, 10 Jul 2023 08:07:29 GMT */
/* Wed May 24 13:42:24 UTC 2023 */
function initializeMustache(e){var t=Object.prototype.toString,n=Array.isArray||function(e){return"[object Array]"===t.call(e)};function a(e){return"function"==typeof e}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e,t){return null!=e&&"object"==typeof e&&t in e}var s=RegExp.prototype.test;var o=/\S/;function c(e){return!function(e,t){return s.call(e,t)}(o,e)}var g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};var _=/\s*/,m=/\s+/,l=/\s*=/,d=/\s*\}/,f=/#|\^|\/|>|\{|&|=|!/;function u(e){this.string=e,this.tail=e,this.pos=0}function p(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function S(){this.cache={}}u.prototype.eos=function(){return""===this.tail},u.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},u.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},p.prototype.push=function(e){return new p(e,this)},p.prototype.lookup=function(e){var t,n=this.cache;if(n.hasOwnProperty(e))t=n[e];else{for(var r,s,o=this,c=!1;o;){if(e.indexOf(".")>0)for(t=o.view,r=e.split("."),s=0;null!=t&&s<r.length;)s===r.length-1&&(c=i(t,r[s])),t=t[r[s++]];else t=o.view[e],c=i(o.view,e);if(c)break;o=o.parent}n[e]=t}return a(t)&&(t=t.call(this.view)),t},S.prototype.clearCache=function(){this.cache={}},S.prototype.parse=function(t,a){var i=this.cache,s=i[t];return null==s&&(s=i[t]=function(t,a){if(!t)return[];var i,s,o,g=[],p=[],S=[],v=!1,h=!1;function y(){if(v&&!h)for(;S.length;)delete p[S.pop()];else S=[];v=!1,h=!1}function Y(e){if("string"==typeof e&&(e=e.split(m,2)),!n(e)||2!==e.length)throw new Error("Invalid tags: "+e);i=new RegExp(r(e[0])+"\\s*"),s=new RegExp("\\s*"+r(e[1])),o=new RegExp("\\s*"+r("}"+e[1]))}Y(a||e.tags);for(var b,E,I,w,C,O,A=new u(t);!A.eos();){if(b=A.pos,I=A.scanUntil(i))for(var R=0,T=I.length;R<T;++R)c(w=I.charAt(R))?S.push(p.length):h=!0,p.push(["text",w,b,b+1]),b+=1,"\n"===w&&y();if(!A.scan(i))break;if(v=!0,E=A.scan(f)||"name",A.scan(_),"="===E?(I=A.scanUntil(l),A.scan(l),A.scanUntil(s)):"{"===E?(I=A.scanUntil(o),A.scan(d),A.scanUntil(s),E="&"):I=A.scanUntil(s),!A.scan(s))throw new Error("Unclosed tag at "+A.pos);if(C=[E,I,b,A.pos],p.push(C),"#"===E||"^"===E)g.push(C);else if("/"===E){if(!(O=g.pop()))throw new Error('Unopened section "'+I+'" at '+b);if(O[1]!==I)throw new Error('Unclosed section "'+O[1]+'" at '+b)}else"name"===E||"{"===E||"&"===E?h=!0:"="===E&&Y(I)}if(O=g.pop())throw new Error('Unclosed section "'+O[1]+'" at '+A.pos);return function(e){for(var t,n=[],a=n,r=[],i=0,s=e.length;i<s;++i)switch((t=e[i])[0]){case"#":case"^":a.push(t),r.push(t),a=t[4]=[];break;case"/":r.pop()[5]=t[2],a=r.length>0?r[r.length-1][4]:n;break;default:a.push(t)}return n}(function(e){for(var t,n,a=[],r=0,i=e.length;r<i;++r)(t=e[r])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(a.push(t),n=t));return a}(p))}(t,a)),s},S.prototype.render=function(e,t,n){var a=this.parse(e),r=t instanceof p?t:new p(t);return this.renderTokens(a,r,n,e)},S.prototype.renderTokens=function(e,t,n,a){for(var r,i,s,o="",c=0,g=e.length;c<g;++c)s=void 0,"#"===(i=(r=e[c])[0])?s=this.renderSection(r,t,n,a):"^"===i?s=this.renderInverted(r,t,n,a):">"===i?s=this.renderPartial(r,t,n,a):"&"===i?s=this.unescapedValue(r,t):"name"===i?s=this.escapedValue(r,t):"text"===i&&(s=this.rawValue(r)),void 0!==s&&(o+=s);return o},S.prototype.renderSection=function(e,t,r,i){var s=this,o="",c=t.lookup(e[1]);if(c){if(n(c))for(var g=0,_=c.length;g<_;++g)o+=this.renderTokens(e[4],t.push(c[g]),r,i);else if("object"==typeof c||"string"==typeof c||"number"==typeof c)o+=this.renderTokens(e[4],t.push(c),r,i);else if(a(c)){if("string"!=typeof i)throw new Error("Cannot use higher-order sections without the original template");null!=(c=c.call(t.view,i.slice(e[3],e[5]),function(e){return s.render(e,t,r)}))&&(o+=c)}else o+=this.renderTokens(e[4],t,r,i);return o}},S.prototype.renderInverted=function(e,t,a,r){var i=t.lookup(e[1]);if(!i||n(i)&&0===i.length)return this.renderTokens(e[4],t,a,r)},S.prototype.renderPartial=function(e,t,n){if(n){var r=a(n)?n(e[1]):n[e[1]];return null!=r?this.renderTokens(this.parse(r),t,n,r):void 0}},S.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},S.prototype.escapedValue=function(t,n){var a=n.lookup(t[1]);if(null!=a)return e.escape(a)},S.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.2.1",e.tags=["{{","}}"];var v=new S;e.clearCache=function(){return v.clearCache()},e.parse=function(e,t){return v.parse(e,t)},e.render=function(e,t,a){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(n(r=e)?"array":typeof r)+'" was given as the first argument for mustache#render(template, view, partials)');var r;return v.render(e,t,a)},e.to_html=function(t,n,r,i){var s=e.render(t,n,r);if(!a(i))return s;i(s)},e.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return g[e]})},e.Scanner=u,e.Context=p,e.Writer=S}!function(e,t,n){e.bowser=function(){var e=!0;function t(t){function n(e){var n=t.match(e);return n&&n.length>1&&n[1]||""}function a(e){var n=t.match(e);return n&&n.length>1&&n[2]||""}var r,i=n(/(ipod|iphone|ipad)/i).toLowerCase(),s=/like android/i.test(t),o=!s&&/android/i.test(t),c=/nexus\s*[0-6]\s*/i.test(t),g=!c&&/nexus\s*[0-9]+/i.test(t),_=/CrOS/.test(t),m=/silk/i.test(t),l=/sailfish/i.test(t),d=/tizen/i.test(t),f=/(web|hpw)os/i.test(t),u=/windows phone/i.test(t),p=(/SamsungBrowser/i.test(t),!u&&/windows/i.test(t)),S=!i&&!m&&/macintosh/i.test(t),v=!o&&!l&&!d&&!f&&/linux/i.test(t),h=a(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),y=n(/version\/(\d+(\.\d+)?)/i),Y=/tablet/i.test(t)&&!/tablet pc/i.test(t),b=!Y&&/[^-]mobi/i.test(t),E=/xbox/i.test(t);/opera/i.test(t)?r={name:"Opera",opera:e,version:y||n(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(t)?r={name:"Opera",opera:e,version:n(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||y}:/SamsungBrowser/i.test(t)?r={name:"Samsung Internet for Android",samsungBrowser:e,version:y||n(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(t)?r={name:"Opera Coast",coast:e,version:y||n(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(t)?r={name:"Yandex Browser",yandexbrowser:e,version:y||n(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?r={name:"UC Browser",ucbrowser:e,version:n(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?r={name:"Maxthon",maxthon:e,version:n(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?r={name:"Epiphany",epiphany:e,version:n(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?r={name:"Puffin",puffin:e,version:n(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?r={name:"Sleipnir",sleipnir:e,version:n(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?r={name:"K-Meleon",kMeleon:e,version:n(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:u?(r={name:"Windows Phone",osname:"Windows Phone",windowsphone:e},h?(r.msedge=e,r.version=h):(r.msie=e,r.version=n(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?r={name:"Internet Explorer",msie:e,version:n(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:_?r={name:"Chrome",osname:"Chrome OS",chromeos:e,chromeBook:e,chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(t)?r={name:"Microsoft Edge",msedge:e,version:h}:/vivaldi/i.test(t)?r={name:"Vivaldi",vivaldi:e,version:n(/vivaldi\/(\d+(\.\d+)?)/i)||y}:l?r={name:"Sailfish",osname:"Sailfish OS",sailfish:e,version:n(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?r={name:"SeaMonkey",seamonkey:e,version:n(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(r={name:"Firefox",firefox:e,version:n(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(r.firefoxos=e,r.osname="Firefox OS")):m?r={name:"Amazon Silk",silk:e,version:n(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?r={name:"PhantomJS",phantom:e,version:n(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?r={name:"SlimerJS",slimer:e,version:n(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?r={name:"BlackBerry",osname:"BlackBerry OS",blackberry:e,version:y||n(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:f?(r={name:"WebOS",osname:"WebOS",webos:e,version:y||n(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(r.touchpad=e)):/bada/i.test(t)?r={name:"Bada",osname:"Bada",bada:e,version:n(/dolfin\/(\d+(\.\d+)?)/i)}:d?r={name:"Tizen",osname:"Tizen",tizen:e,version:n(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||y}:/qupzilla/i.test(t)?r={name:"QupZilla",qupzilla:e,version:n(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||y}:/chromium/i.test(t)?r={name:"Chromium",chromium:e,version:n(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||y}:/chrome|crios|crmo/i.test(t)?r={name:"Chrome",chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:o?r={name:"Android",version:y}:/safari|applewebkit/i.test(t)?(r={name:"Safari",safari:e},y&&(r.version=y)):i?(r={name:"iphone"==i?"iPhone":"ipad"==i?"iPad":"iPod"},y&&(r.version=y)):r=/googlebot/i.test(t)?{name:"Googlebot",googlebot:e,version:n(/googlebot\/(\d+(\.\d+))/i)||y}:{name:n(/^(.*)\/(.*) /),version:a(/^(.*)\/(.*) /)},!r.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(r.name=r.name||"Blink",r.blink=e):(r.name=r.name||"Webkit",r.webkit=e),!r.version&&y&&(r.version=y)):!r.opera&&/gecko\//i.test(t)&&(r.name=r.name||"Gecko",r.gecko=e,r.version=r.version||n(/gecko\/(\d+(\.\d+)?)/i)),r.windowsphone||!o&&!r.silk?!r.windowsphone&&i?(r[i]=e,r.ios=e,r.osname="iOS"):S?(r.mac=e,r.osname="macOS"):E?(r.xbox=e,r.osname="Xbox"):p?(r.windows=e,r.osname="Windows"):v&&(r.linux=e,r.osname="Linux"):(r.android=e,r.osname="Android");var I="";r.windows?I=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(n(/Windows ((NT|XP)( \d\d?.\d)?)/i)):r.windowsphone?I=n(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):r.mac?I=(I=n(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):i?I=(I=n(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):o?I=n(/android[ \/-](\d+(\.\d+)*)/i):r.webos?I=n(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):r.blackberry?I=n(/rim\stablet\sos\s(\d+(\.\d+)*)/i):r.bada?I=n(/bada\/(\d+(\.\d+)*)/i):r.tizen&&(I=n(/tizen[\/\s](\d+(\.\d+)*)/i)),I&&(r.osversion=I);var w=!r.windows&&I.split(".")[0];return Y||g||"ipad"==i||o&&(3==w||w>=4&&!b)||r.silk?r.tablet=e:(b||"iphone"==i||"ipod"==i||o||c||r.blackberry||r.webos||r.bada)&&(r.mobile=e),r.msedge||r.msie&&r.version>=10||r.yandexbrowser&&r.version>=15||r.vivaldi&&r.version>=1||r.chrome&&r.version>=20||r.samsungBrowser&&r.version>=4||r.firefox&&r.version>=20||r.safari&&r.version>=6||r.opera&&r.version>=10||r.ios&&r.osversion&&r.osversion.split(".")[0]>=6||r.blackberry&&r.version>=10.1||r.chromium&&r.version>=20?r.a=e:r.msie&&r.version<10||r.chrome&&r.version<20||r.firefox&&r.version<20||r.safari&&r.version<6||r.opera&&r.version<10||r.ios&&r.osversion&&r.osversion.split(".")[0]<6||r.chromium&&r.version<20?r.c=e:r.x=e,r}var n=t("undefined"!=typeof navigator&&navigator.userAgent||"");function a(e){return e.split(".").length}function r(e,t){var n,a=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n++)a.push(t(e[n]));return a}function i(e){for(var t=Math.max(a(e[0]),a(e[1])),n=r(e,function(e){var n=t-a(e);return r((e+=new Array(n+1).join(".0")).split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--t>=0;){if(n[0][t]>n[1][t])return 1;if(n[0][t]!==n[1][t])return-1;if(0===t)return 0}}function s(e,a,r){var s=n;"string"==typeof a&&(r=a,a=void 0),void 0===a&&(a=!1),r&&(s=t(r));var o=""+s.version;for(var c in e)if(e.hasOwnProperty(c)&&s[c]){if("string"!=typeof e[c])throw new Error("Browser version in the minVersion map should be a string: "+c+": "+String(e));return i([o,e[c]])<0}return a}return n.test=function(e){for(var t=0;t<e.length;++t){var a=e[t];if("string"==typeof a&&a in n)return!0}return!1},n.isUnsupportedBrowser=s,n.compareVersions=i,n.check=function(e,t,n){return!s(e,t,n)},n._detect=t,n}()}(this),function(){var _SgmntfY_=window._SgmntfY_={LOG_LEVELS:{SILENT:0,ERROR:1,WARN:2,INFO:3,DEBUG:4},_variables:{jq:window.SegmentifyjQuery||null,mustache:null,domain:window.SegmentifyDomain||window.location.hostname,ua:{agentString:window.navigator.userAgent,type:null,name:null,version:null,os:null,osversion:null},controlGroup:{type:void 0,source:void 0,experimentID:void 0,controlValue:void 0,activeValue:void 0},search:{maxMobileWidth:801,searchMinChar:0,searchDelay:50,input:"",manuelTrigger:"",manuelTriggerEnabledForDesktop:!1,manuelTriggerDesktop:"",cancelText:"Cancel",showAll:"Show All",notFound:"Sorry, there are no results for that search term. ",initialCampaign:null,isExecutable:!1,searchTimer:null,isExecutableForAfter:!1,manuelTriggerClicked:!1,forceRemoveInputVal:!1,queryVerboseLog:!1,queryOverrideKey:"_sgf_search_override_query",bannerTargets:{ASSETS_HEADER:".sgm-search-sidebar",ASSETS_FOOTER:".sgm-search-sidebar",RESULTS_HEADER:".sgm-search-products",RESULTS_FOOTER:".sgm-search-products"}},pa:{loaded:!1,disabled:!1,wait:!1},journey:{},userStorageKey:"_sgf_user_id",sessionStorageKey:"_sgf_session_id",pushPermissionKey:"_sgf_push_permission_asked",testMode:"_sgf_test_mode",tracking:"_sgf_tracking",storage:{delayedActions:{key:"_sgf_delayed_actions",local:!0},delayedCampaigns:{key:"_sgf_delayed_campaigns",local:!0},pageViewCampaigns:{key:"_sgf_pageview_campaigns",local:!0},retryQueue:{key:"_sgf_rq",local:!0},extensionStatus:{key:"segmentifyExtension",local:!0},qaExtensionStatus:{key:"_sgf_qa_ext",local:!0},clickedBanners:{key:"_sgf_clicked_banners",local:!1},nextPageQueue:{key:"_sgf_npq",local:!0},user:{key:"_sgf_user_id",local:!1},session:{key:"_sgf_session_id",local:!1},qaMode:{key:"_sgf_qa_mode",local:!0},searchNoCache:{key:"_sgf_search_no_cache",local:!0}},logLevel:"ERROR",segmentifyObj:null,recommendedProducts:[],recommendedPromotions:[],waitingKeys:!1,keysTryCount:0,apiKey:null,skipProductDetail:{device:[]},offerRecommendedProducts:!1,offerRecommendedPromotions:!1,runTimer:null,initTimer:null,initTryCount:0,initTryLimit:50,isPageHide:!1,cssPreload:!1,constants:{frequency:100,redirectDelay:1e3,retryLimit:3,eventTimeout:10,clickedBannersLimit:20,recommendationSelectorFindLimit:50},requiredParams:{PAGE_VIEW:[],PRODUCT_VIEW:["productId"],BASKET_OPERATIONS:["productId","basketId","step"],CHECKOUT:["totalPrice","basketId","step"],USER_OPERATIONS:["step"],FORM:["formName","fields"],CUSTOM_EVENT:["type"],INTERACTION:["type"],BANNER_OPERATIONS:["type","title","group","order"],BANNER_GROUP_VIEW:["group"],INTERNAL_BANNER_GROUP:["group"],USER_CHANGE:["oldUserId"],PROMOTION:["type","code"],SEARCH:[],FILTER:["source"],COUPON:["type"],JOURNEY:["type"],WISHLIST:["step"],PERSONA_QUIZ:[],GAMIFICATION:[]},optionalParams:{PAGE_VIEW:["category","subCategory"],PRODUCT_VIEW:["title","url","mUrl","image","imageXS","imageS","imageM","imageL","imageXL","additionalImages","mainCategory","category","categories","price","oldPrice","specialPrice","lastUpdateTime","inStock","stockCount","stockRatio","stockStatus","brand","gender","labels","sizes","allSizes","colors","publishTime","source","noUpdate","activeBanners","groupId","scoreCount","reviewCount","subSource","paramsList"],BASKET_OPERATIONS:["price","quantity","size","activeBanners"],CHECKOUT:["productList","orderNo","paymentType","activeBanners","cartUrl","totalDiscount","discounts","shipment","tax","coupon"],USER_OPERATIONS:["username","fullName","phone","gender","birthDate","segments","memberSince","service","isRegistered","isLogin","location","emailNtf","mailTest","pushTest","custom","external","userIysPermissions","lastSearchDeletedKeywords"],FORM:[],CUSTOM_EVENT:[],INTERACTION:["interactionId","instanceId"],BANNER_OPERATIONS:["productId","category","brand","label"],BANNER_GROUP_VIEW:[],INTERNAL_BANNER_GROUP:["banners"],USER_CHANGE:[],PROMOTION:["title","url","mUrl","image","mImage","startDate","endDate","categories","brands","labels","productIds","publishTime"],SEARCH:["query","type","ordering","filters","trigger","service","mode"],FILTER:["productId","categories","brands","sizes","prices"],COUPON:[],JOURNEY:["step","answer","instanceId"],WISHLIST:["productId","favoritesList"],PERSONA_QUIZ:["answers","instanceId"],GAMIFICATION:["type","record","used"]},segmentifyApiUrl:"//gandalf.segmentify.com/",segmentifyQaApiUrl:"//gandalf-qa.segmentify.com",segmentifyCDNUrl:"//cdn.segmentify.com/",jQueryUrl:"//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js",paUrl:"https://cdn.sgmntfy.com/pa.js",dataLayer:"sgfLayer",consumeDataLayer:!0,dataLayerConfig:{},categoryHierarchy:!1,disableNextPage:!1,language:"EN",currency:"",region:"",pushInfo:{dataCenter:"",qaDataCenter:"https://gimli-qa.segmentify.com/",promptInteraction:""},ga:{groupCookie:"__SegmentifyGroup__",group:void 0,tracker:"window.ga",trackerName:void 0,activated:!1,enabled:!1,activateTryCount:100,activateTriedCount:0,activeGroup:void 0,activePage:void 0,groups:{control:"SGM-CG",groupA:"SGM-GA",groupB:"SGM-GB",unknown:"SGM-UN"},dimensions:{sgmGroup:void 0,sgmUser:void 0,sgmSession:void 0,sgmPage:void 0,sgmWidget:void 0,sgmProduct:void 0}},doNotTrack:!1},_loadJavascript:function(e,t,n){var a=document.createElement("script");return a.type="text/javascript",a.async=t,n&&"function"==typeof n&&(void 0!==a.onreadystatechange?a.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||(n(),a.onreadystatechange=null)}:a.onload=n),a.src=e,document.getElementsByTagName("head")[0].appendChild(a),a},_loadCSS:function(e,t){var n=document.createElement("link");return n.type="text/css",_SgmntfY_._variables.cssPreload?(n.rel="preload",n.as="style"):n.rel="stylesheet",n.media="screen",t&&"function"==typeof t&&(void 0!==n.onreadystatechange?n.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||(t(),n.onreadystatechange=null)}:n.onload=t),n.href=e,document.getElementsByTagName("head")[0].appendChild(n),n},_sgfPopupCloseHandler:function(e,t){(!1===e||_SgmntfY_._jbOverFlowOperations._journeyFinished(t))&&(_SgmntfY_._jbOverFlowOperations._enableBodyOverFlowForJBWrapper(),_SgmntfY_._jbTriggerButtonReEnable(),window.setTimeout(function(){var e=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector);e&&e.parentNode.removeChild(e)},500))},_actions:{_notificationWindow:function(params){var config={title:params.notificationTitle,vertical:"middle",horizontal:"center"},title=params.notificationTitle;switch(params.windowPosition){case"top":config.vertical="top";break;case"bottom":config.vertical="bottom";break;case"left":config.horizontal="left";break;case"right":config.horizontal="right";break;case"top-left":config.vertical="top",config.horizontal="left";break;case"top-right":config.vertical="top",config.horizontal="right";break;case"bottom-left":config.vertical="bottom",config.horizontal="left";break;case"bottom-right":config.vertical="bottom",config.horizontal="right"}var outerHtml=_SgmntfY_._getJq()('<div class="seg-popup seg-[[vertical]]-[[horizontal]] segFadeInUp fancybox-segmentify"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>'),notificationBody=_SgmntfY_._getJq()('<div class="fancybox-body" />').appendTo(outerHtml.find(".fancybox-inner"));params.html instanceof _SgmntfY_._getJq()?notificationBody.append(params.html):notificationBody.html(params.html);for(var button_overlay=_SgmntfY_._getJq()("<div />").appendTo(notificationBody),buttons=params.buttons||[],i=0;i<buttons.length;i++)_SgmntfY_._getJq()('<button data-newWindow="'+buttons[i].newWindow+'" data-target="'+buttons[i].buttonUrl+'" class="fancybox-button '+buttons[i].buttonColor+'">'+buttons[i].buttonTitle+"</button>").appendTo(button_overlay);"seamless"===params.windowStyle&&(title&&_SgmntfY_._getJq()('<div class="overlay-area-title" ><span>'+title+"</span></div>").appendTo(notificationBody),button_overlay.addClass("overlay-area-buttons").addClass("right"),title=null),"false"===params.isModal&&_SgmntfY_._getJq()('<span class="seg-popup-close"></span>').appendTo(outerHtml);var renderedHtml=_SgmntfY_._getMustache().render(outerHtml.prop("outerHTML"),config);_SgmntfY_._getJq()("body").prepend(renderedHtml),"true"===params.overlay&&(_SgmntfY_._getJq()('<div class="seg-popup-overlay"></div>').prependTo(_SgmntfY_._getJq()("body")),_SgmntfY_._getJq()(".seg-popup-overlay").show()),"false"===params.isModal&&_SgmntfY_._getJq()(".seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"close",instanceId:params.instanceId,interactionId:params.instanceId})}),params.cssCode&&_SgmntfY_._getJq()("<style />").html(params.cssCode).prependTo(_SgmntfY_._getJq()("body"));try{params.javascriptCode&&eval(params.javascriptCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing javascript code: "+e)}if(_SgmntfY_._getJq()(".seg-popup").find("form")){var $inner=_SgmntfY_._getJq()(".seg-popup .fancybox-body"),$form=$inner.find("form").eq(0);$form.bind("submit",function(e){e.preventDefault(),_SgmntfY_.LOG_MESSAGE("DEBUG","Popup Form button click for actionId: "+params.actionId),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"submit",interactionId:params.formName,instanceId:params.instanceId}),_SgmntfY_._variables.segmentifyObj("user:form",{formName:params.formName,fields:$form.sgmSerializeForm()}),$inner.html(params.successHtml),setTimeout(function(){$inner.parents(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),$inner.parents(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3)})}var redirectFn=function(e){var t=function(e,t){window.open(e.data("target"),t),e.parents(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3)};"true"===e.data("newwindow")||!0===e.data("newwindow")?t(e,"_blank"):setTimeout(function(){t(e,"_self")},_SgmntfY_._variables.constants.redirectDelay)};_SgmntfY_._getJq()(".seg-popup .fancybox-button").click(function(){_SgmntfY_.LOG_MESSAGE("DEBUG","Notification Window button click for actionId: "+params.actionId),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",interactionId:_SgmntfY_._getJq()(this).text(),instanceId:params.instanceId}),redirectFn(_SgmntfY_._getJq()(this))}),_SgmntfY_._getJq()(".seg-popup a img").bind("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:params.instanceId,interactionId:params.instanceId})}),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:params.instanceId,interactionId:params.instanceId})},notificationBanner:function(e){var t=[];try{e.buttons&&(t=JSON.parse(e.buttons))}catch(n){_SgmntfY_.LOG_MESSAGE("WARN","Cannot parse buttons json, str: "+e.buttons),t=[]}e.buttons=t,e.html=_SgmntfY_._getJq()('<div><a href="'+e.redirectUrl+'"><img id="sgm_img" src="'+e.imageUrl+'"></a></div>'),_SgmntfY_._actions._notificationWindow(e)},notificationMessage:function(e){var t=[];try{e.buttons&&(t=JSON.parse(e.buttons))}catch(n){_SgmntfY_.LOG_MESSAGE("WARN","Cannot parse buttons json, str: "+e.buttons),t=[]}e.html=e.notificationText,e.buttons=t,_SgmntfY_._actions._notificationWindow(e)},visitorForm:function(e){switch(e.actionType){case"INPAGE_WIDGET":(function e(){var t=this.params,n=this.selectorCount,a=t.selector;if(a&&_SgmntfY_._getJq()(a).length)try{a.addClass("sgm-recommendation sgm-clearcss").html(t.formHtml);var r=a.find("form").eq(0);r.submit(function(e){e.preventDefault(),_SgmntfY_.LOG_MESSAGE("DEBUG","In-page Form button click for actionId: "+t.actionId),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"submit",interactionId:t.formName,instanceId:t.instanceId}),_SgmntfY_._variables.segmentifyObj("user:form",{formName:t.formName,fields:r.sgmSerializeForm()}),setTimeout(function(){a.html(t.successHtml)},1e3)})}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error in filling target element["+t.selector+"] with visitor form: "+e)}else if(_SgmntfY_.LOG_MESSAGE("WARN","Error in finding target element["+target+"], element does not exist"),n<_SgmntfY_._variables.constants.recommendationSelectorFindLimit){++this.selectorCount;var i=e.bind(this);setTimeout(i,100)}}).bind({params:e,selectorCount:1})();break;case"POPUP_WINDOW":default:e.html=e.formHtml,_SgmntfY_._actions._notificationWindow(e)}},recommendProducts:function(params,request){var previousMetadata={productId:request.originalParams.productId,productUrl:request.originalParams.productUrl,instanceId:params.instanceId};function dynamicItemKey(e){var t=e.recommendationSource;return void 0!==e.timeFrame&&_SgmntfY_._isNotEmpty(e.timeFrame)&&(t+="|"+e.timeFrame,void 0!==e.score&&_SgmntfY_._isNotEmpty(e.score)&&(t+="|"+e.score)),t}function checkDynamicItemCount(e,t){for(var n=0;n<e.length;++n)if(dynamicItemKey(e[n])===t)return e[n].itemCount;return null}function checkProductInList(e,t){for(var n=0;n<e.length;n++)if(e[n].productId==t)return!0;return!1}function checkSelectorAndRender(){var params=this.params,selectorCount=this.selectorCount,target=params.selector;if(target&&_SgmntfY_._getJq()(target).length){var renderIdx=0,reConf={title:notificationTitle,products:productList,index:function(){return++renderIdx},discount:function(){try{var e=this.price,t=this.oldPrice;if(!e||!t||e==t)return null;var n=100-100*e/t;return n>0&&Math.round(n)}catch(e){return null}},commaFormatPrice:function(){return this.toFixed(2).toString().replace(/\./g,",")},dotFormatPrice:function(){return this.toFixed(2).toString()}};try{if(params.preJsCode){eval(params.preJsCode);var retVal=preRenderConf(reConf);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!");_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:params.actionId,instanceId:params.instanceId}),_SgmntfY_.GA.sendWidgetImpression(params.instanceId)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation pre js code: "+e)}reConf.brandingEnabled&&(reConf.title+='<a target="_blank" class="seg-rec-logo" href="//www.segmentify.com">Recommended by <img src="//cdn.segmentify.com/images/sgm-logo.svg" /></a>');var renderedHtml=_SgmntfY_._getMustache().render(params.recommendationTemplate,reConf);params.cssCode&&_SgmntfY_._getJq()("<style />").html(params.cssCode).prependTo(_SgmntfY_._getJq()("body"));try{var targetElement=_SgmntfY_._getJq()(target).first();if("SELF"===params.insertType)targetElement.html(renderedHtml),wvCB&&wvCB(targetElement);else{var $div=_SgmntfY_._getJq()("<div/>",{class:"seg-reco-wrapper seg-clear"});"AFTER"===params.insertType||"BEFORE"===params.insertType?"AFTER"===params.insertType?$div.html(renderedHtml).insertAfter(targetElement):$div.html(renderedHtml).insertBefore(targetElement):"APPEND"!==params.insertType&&"PREPEND"!==params.insertType||("APPEND"===params.insertType?$div.html(renderedHtml).appendTo(targetElement):$div.html(renderedHtml).prependTo(targetElement)),wvCB&&wvCB($div)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling target element["+target+"] with product recommendations: "+e)}try{params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation post js code: "+e)}_SgmntfY_._bindRecommendationTrackEvents("SELF"===params.insertType?targetElement:$div,params.recommendationSettings,params.instanceId,0)}else if(_SgmntfY_.LOG_MESSAGE("WARN","Error in finding target element["+target+"], element does not exist"),selectorCount<_SgmntfY_._variables.constants.recommendationSelectorFindLimit){++this.selectorCount;var binded=checkSelectorAndRender.bind(this);setTimeout(binded,100)}}var productList=[],recommendedProducts=params.recommendedProducts||{},dynamicItems=JSON.parse(params.dynamicItems)||[],recoVersion=params.version||"v1";if("v1"===recoVersion)if("SHUFFLE"===params.ordering){function allNull(e){for(var t in e)if(e.hasOwnProperty(t)&&(void 0!==e[t]||null!==e[t]))return!1;return!0}function arrayRandom(){return parseInt(100*Math.random())}function randomInt(e,t){return Math.floor(Math.random()*(t-e))+e}var itemCounts=[],dynamicLengths=[];for(var idx in dynamicItems)if(dynamicItems.hasOwnProperty(idx)){itemCounts.push(parseInt(dynamicItems[idx].itemCount||0));var source=dynamicItemKey(dynamicItems[idx]);recommendedProducts.hasOwnProperty(source)?dynamicLengths.push(recommendedProducts[source].length):dynamicLengths.push(0)}var firstLevel=[],firstLevelTotal=itemCounts.reduce(function(e,t){return e+t},0);for(idx in itemCounts)if(itemCounts.hasOwnProperty(idx)){var _idx=parseInt(idx);if(_idx===itemCounts.length-1)firstLevel.push(100);else{var pct=parseInt(itemCounts[idx]/firstLevelTotal*100);0===_idx?firstLevel.push(pct):firstLevel.push(firstLevel[firstLevel.length-1]+pct)}}var secondLevel=[];for(var dl in dynamicLengths)if(dynamicLengths.hasOwnProperty(dl)){for(var len=dynamicLengths[dl],sumOfSquares=len*(len+1)*(2*len+1)/6,tmpArr=[],l=len;l>0;--l)1===l?tmpArr.push(100):(pct=parseInt(Math.pow(l,2)/sumOfSquares*100),l===len?tmpArr.push(pct):tmpArr.push(tmpArr[tmpArr.length-1]+pct));secondLevel.push(tmpArr)}for(var dynamicProducts=[],iteration=0;!(++iteration>1e4||dynamicProducts.length>=firstLevelTotal);){var allNullCheck=!0;for(idx in dynamicItems)if(dynamicItems.hasOwnProperty(idx)){source=dynamicItemKey(dynamicItems[idx]);var tmpCheck=!0;if(recommendedProducts.hasOwnProperty(source)&&(tmpCheck=allNull(recommendedProducts[source])),!tmpCheck){allNullCheck=!1;break}}if(allNullCheck)break;var rand=arrayRandom(),firstLevelIndex=-1;for(var fl in firstLevel)if(firstLevel.hasOwnProperty(fl)&&rand<firstLevel[fl]){firstLevelIndex=parseInt(fl);break}if(-1!==firstLevelIndex&&dynamicItems.hasOwnProperty(firstLevelIndex.toString())){source=dynamicItemKey(dynamicItems[firstLevelIndex]),rand=arrayRandom();var secondLevelIndex=-1;for(var sl in secondLevel[firstLevelIndex])if(secondLevel[firstLevelIndex].hasOwnProperty(sl)&&rand<secondLevel[firstLevelIndex][sl]){secondLevelIndex=parseInt(sl);break}if(-1!==secondLevelIndex&&recommendedProducts[source].hasOwnProperty(secondLevelIndex.toString())){var candidate=recommendedProducts[source].splice(secondLevelIndex,1)[0];if(null!=candidate){recommendedProducts[source].splice(secondLevelIndex,0,null);var eliminationFuncRetVal=!1;if(params.eliminationFunction){var func=_SgmntfY_._getObjectByString(window,params.eliminationFunction);if("function"==typeof func)try{eliminationFuncRetVal=func.call(null,candidate)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation elimination js function: "+e)}}if(!eliminationFuncRetVal){candidate.name=_SgmntfY_._decodeHtml(candidate.name);var sourceLastVisited="RECOMMENDATION_SOURCE_LAST_VISITED"===dynamicItems[firstLevelIndex].recommendationSource||"RECOMMENDATION_EVENT_DATA"===dynamicItems[firstLevelIndex].recommendationSource;switch(params.elimination){case"ELIMINATE_DUPLICATES":case"ELIMINATE_PREVIOUS":checkProductInList(productList,candidate.productId)||(sourceLastVisited||!_SgmntfY_._containsRecommendedProduct(candidate.productId)||_SgmntfY_._variables.offerRecommendedProducts)&&(productList.push(candidate),dynamicProducts.push(candidate),sourceLastVisited||_SgmntfY_._addRecommendedProduct(candidate.productId));break;case"NO_ELIMINATION":default:productList.push(candidate),dynamicProducts.push(candidate),sourceLastVisited||_SgmntfY_._addRecommendedProduct(candidate.productId)}}}}}}for(var i=0;i<recommendedProducts.RECOMMENDATION_SOURCE_STATIC_ITEMS.length;++i){var elm=recommendedProducts.RECOMMENDATION_SOURCE_STATIC_ITEMS[i];checkProductInList(productList,elm.productId)||productList.splice(randomInt(0,productList.length),0,elm)}}else{for(var missingCount=0,i=0;i<recommendedProducts.RECOMMENDATION_SOURCE_STATIC_ITEMS.length;++i){var elm=recommendedProducts.RECOMMENDATION_SOURCE_STATIC_ITEMS[i];checkProductInList(productList,elm.productId)||productList.push(elm)}for(var ri=0;ri<dynamicItems.length;++ri){var curRecommendationSource=dynamicItemKey(dynamicItems[ri]),curCatItemCount=parseInt(checkDynamicItemCount(dynamicItems,curRecommendationSource));if(isNaN(curCatItemCount)&&(curCatItemCount=0),recommendedProducts.hasOwnProperty(curRecommendationSource)&&curCatItemCount){missingCount+=curCatItemCount;for(var index=0,i=0;i<recommendedProducts[curRecommendationSource].length;++i){var elm=recommendedProducts[curRecommendationSource][i];if(elm.name=_SgmntfY_._decodeHtml(elm.name),index>=curCatItemCount&&0===missingCount)break;var eliminationFnRetVal=!1;if(params.eliminationFunction){var fx=_SgmntfY_._getObjectByString(window,params.eliminationFunction);if("function"==typeof fx)try{eliminationFnRetVal=fx.call(null,elm)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation elimination js function: "+e)}}if(!eliminationFnRetVal){var sourceLastVisited="RECOMMENDATION_SOURCE_LAST_VISITED"===dynamicItems[ri].recommendationSource||"RECOMMENDATION_EVENT_DATA"===dynamicItems[ri].recommendationSource;switch(params.elimination){case"ELIMINATE_DUPLICATES":case"ELIMINATE_PREVIOUS":checkProductInList(productList,elm.productId)||(sourceLastVisited||!_SgmntfY_._containsRecommendedProduct(elm.productId)||_SgmntfY_._variables.offerRecommendedProducts)&&(productList.push(elm),sourceLastVisited||_SgmntfY_._addRecommendedProduct(elm.productId),++index,--missingCount);break;case"NO_ELIMINATION":default:productList.push(elm),sourceLastVisited||_SgmntfY_._addRecommendedProduct(elm.productId),++index,--missingCount}}}}}}else if("v3"===recoVersion&&recommendedProducts.length){for(var staticProducts=recommendedProducts[0]||[],i=0;i<staticProducts.length;++i){var elm=staticProducts[i];checkProductInList(productList,elm.productId)||productList.push(elm)}for(var missingCount=0,ri=1;ri<recommendedProducts.length;++ri){var dynamicItem=dynamicItems[ri-1],curCatItemCount=parseInt(dynamicItem.itemCount);if(isNaN(curCatItemCount)&&(curCatItemCount=0),curCatItemCount){missingCount+=curCatItemCount;for(var index=0,i=0;i<recommendedProducts[ri].length;++i){var elm=recommendedProducts[ri][i];if(elm.name=_SgmntfY_._decodeHtml(elm.name),index>=curCatItemCount&&0===missingCount)break;var sourceLastVisited="RECOMMENDATION_SOURCE_LAST_VISITED"===dynamicItem.recommendationSource||"RECOMMENDATION_EVENT_DATA"===dynamicItem.recommendationSource;switch(params.elimination){case"ELIMINATE_DUPLICATES":case"ELIMINATE_PREVIOUS":checkProductInList(productList,elm.productId)||(sourceLastVisited||!_SgmntfY_._containsRecommendedProduct(elm.productId)||_SgmntfY_._variables.offerRecommendedProducts)&&(productList.push(elm),sourceLastVisited||_SgmntfY_._addRecommendedProduct(elm.productId),++index,--missingCount);break;case"NO_ELIMINATION":default:productList.push(elm),sourceLastVisited||_SgmntfY_._addRecommendedProduct(elm.productId),++index,--missingCount}}}}}var notificationTitleMap=JSON.parse(params.notificationTitleMap||"{}"),notificationTitle=notificationTitleMap[request.data.lang]||params.notificationTitle;if(0!==productList.length){"INPAGE_WIDGET"!==params.actionType&&"POPUP_RECO"!==params.actionType&&(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:params.actionId,instanceId:params.instanceId}),_SgmntfY_.GA.sendWidgetImpression(params.instanceId));var wvInteractionId=params.interactionId,wvInstanceId=params.instanceId,wvCB=function(e){var t=!1;if(!t&&_SgmntfY_._isElemVisible(e))_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),_SgmntfY_.GA.sendWidgetView(params.instanceId),t=!0;else if(!t)var n=setInterval(function(){!t&&_SgmntfY_._isElemVisible(e)&&(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),_SgmntfY_.GA.sendWidgetView(params.instanceId),t=!0,window.clearInterval(n))},100)};switch(params.actionType){case"CALLBACK":request.recommendationCallback&&request.recommendationCallback(notificationTitle,productList,previousMetadata,wvCB);break;case"INPAGE_WIDGET":var binded_context=checkSelectorAndRender.bind({params:params,selectorCount:1});binded_context();break;case"JAVASCRIPT_FUNCTION":var fx=_SgmntfY_._getObjectByString(window,params.jsFunction);if("function"==typeof fx)try{fx.call(null,notificationTitle,productList,previousMetadata,wvCB)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation js function: "+e)}else _SgmntfY_.LOG_MESSAGE("WARN","Product Recommendation javascript function("+params.jsFunction+") does not exist");break;case"POPUP_RECO":var config={title:params.notificationTitle&&""!==params.notificationTitle?params.notificationTitle:notificationTitle||"",vertical:params.verticalPosition,horizontal:params.horizontalPosition,button:_SgmntfY_._jbGetButtonText("DELIVERY")},isJourney=_SgmntfY_._jbOverFlowOperations._journeyFinished(request);if(!1===isJourney&&productList.length<3)return;config.products=productList;try{if(params.preJsCode){eval(params.preJsCode);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!");_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:params.actionId,instanceId:params.instanceId}),_SgmntfY_.GA.sendWidgetImpression(params.instanceId)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var _products=[],_productId="";request.originalParams&&request.originalParams.params&&(_productId=request.originalParams.params.productId||"");for(var i=0;i<config.products.length&&(!1!==isJourney||3!==_products.length);++i){var _product=config.products[i];_product.productId!==_productId&&_products.push(_product)}if(!1===isJourney&&3!==_products.length)return;config.products=_products;var renderedHtml=_SgmntfY_._getMustache().render(params.recommendationTemplate,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),params.cssCode&&_SgmntfY_._getJq()("<style />").html(params.cssCode).prependTo(_SgmntfY_._getJq()("body")),_SgmntfY_._jbDeliveryOnBindEventHandler();try{params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}"true"===params.overlay&&_SgmntfY_._getJq()(".seg-popup-overlay").show(),_SgmntfY_._getJq()(".seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){_SgmntfY_._sgfPopupCloseHandler(!0,request),e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3)}),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:params.interactionId,instanceId:params.instanceId}),_SgmntfY_.GA.sendWidgetView(params.instanceId)}}else"CALLBACK"===params.actionType&&request.recommendationCallback&&request.recommendationCallback(notificationTitle,[],previousMetadata,null)},recommendPromotion:function(params,request){var metadata={title:params.notificationTitle};function checkDynamicItemCount(e,t){for(var n=0;n<e.length;++n)if(e[n].recommendationSource+"|"+e[n].timeFrame+"|"+e[n].score===t)return e[n].itemCount;return null}function checkPromotionInList(e,t){for(var n=0;n<e.length;n++)if(e[n].code===t)return!0;return!1}function checkSelectorAndRender(){var params=this.params,selectorCount=this.selectorCount,target=params.selector;if(target&&_SgmntfY_._getJq()(target).length){var renderIdx=0,reConf={title:params.notificationTitle,promotionList:promotionList,index:function(){return++renderIdx}};try{if(params.preJsCode){eval(params.preJsCode);var retVal=preRenderConf(reConf);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing promotion recommendation pre js code: "+e)}reConf.brandingEnabled&&(reConf.title+='<a target="_blank" class="seg-rec-logo" href="//www.segmentify.com">Recommended by <img src="//cdn.segmentify.com/images/sgm-logo.svg" /></a>');var renderedHtml=_SgmntfY_._getMustache().render(params.recommendationTemplate,reConf);try{var targetElement=_SgmntfY_._getJq()(target).first();if("SELF"===params.insertType)targetElement.addClass("seg-promotion-wrapper").html(renderedHtml),targetElement.attr("data-sgf-scenario-id",params.instanceId),wvCB&&wvCB(targetElement);else{var $div=_SgmntfY_._getJq()("<div/>",{class:"seg-promotion-wrapper"});$div.attr("data-sgf-scenario-id",params.instanceId),"AFTER"===params.insertType||"BEFORE"===params.insertType?"AFTER"===params.insertType?$div.html(renderedHtml).insertAfter(targetElement):$div.html(renderedHtml).insertBefore(targetElement):"APPEND"!==params.insertType&&"PREPEND"!==params.insertType||("APPEND"===params.insertType?$div.html(renderedHtml).appendTo(targetElement):$div.html(renderedHtml).prependTo(targetElement)),wvCB&&wvCB($div)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling target element["+target+"] with promotion recommendations: "+e)}try{params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing promotion recommendation post js code: "+e)}_SgmntfY_._bindRecommendationTrackEvents("SELF"===params.insertType?targetElement:$div,params.recommendationSettings,params.instanceId,0)}else if(_SgmntfY_.LOG_MESSAGE("WARN","Error in finding target element["+target+"], element does not exist"),selectorCount<_SgmntfY_._variables.constants.recommendationSelectorFindLimit){++this.selectorCount;var binded=checkSelectorAndRender.bind(this);setTimeout(binded,100)}}for(var promotionList=[],recommendedPromotions=params.recommendedPromotions||{},dynamicItems=JSON.parse(params.dynamicItems)||[],i=0;i<recommendedPromotions.RECOMMENDATION_SOURCE_STATIC_ITEMS.length;++i){var elm=recommendedPromotions.RECOMMENDATION_SOURCE_STATIC_ITEMS[i];checkPromotionInList(promotionList,elm.code)||promotionList.push(elm)}for(var missingCount=0,ri=0;ri<dynamicItems.length;++ri){void 0===dynamicItems[ri].timeFrame&&(dynamicItems[ri].timeFrame="null");var curRecommendationSource=dynamicItems[ri].recommendationSource+"|"+dynamicItems[ri].timeFrame+"|"+dynamicItems[ri].score,curCatItemCount=parseInt(checkDynamicItemCount(dynamicItems,curRecommendationSource));if(isNaN(curCatItemCount)&&(curCatItemCount=0),recommendedPromotions.hasOwnProperty(curRecommendationSource)&&curCatItemCount){missingCount+=curCatItemCount;for(var index=0,i=0;i<recommendedPromotions[curRecommendationSource].length;++i){var elm=recommendedPromotions[curRecommendationSource][i];if(elm.name=_SgmntfY_._decodeHtml(elm.name),index>=curCatItemCount&&0==missingCount)break;var eliminationFnRetVal=!1;if(params.eliminationFunction){var fx=_SgmntfY_._getObjectByString(window,params.eliminationFunction);if("function"==typeof fx)try{eliminationFnRetVal=fx.call(null,elm)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing promotion recommendation elimination js function: "+e)}}if(!eliminationFnRetVal)switch(params.elimination){case"ELIMINATE_DUPLICATES":case"ELIMINATE_PREVIOUS":checkPromotionInList(promotionList,elm.code)||_SgmntfY_._containsRecommendedPromotion(elm.code)&&!_SgmntfY_._variables.offerRecommendedPromotions||(promotionList.push(elm),_SgmntfY_._addRecommendedPromotion(elm.code),++index,--missingCount);break;case"NO_ELIMINATION":default:promotionList.push(elm),_SgmntfY_._addRecommendedPromotion(elm.code),++index,--missingCount}}}}if(0!==promotionList.length){"SHUFFLE"===params.ordering&&(promotionList=_SgmntfY_._shuffle(promotionList)),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:params.actionId,instanceId:params.instanceId});var wvInteractionId=params.interactionId,wvInstanceId=params.instanceId,wvCB=function(e){var t=!1;if(!t&&_SgmntfY_._isElemVisible(e))_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),t=!0;else if(!t)var n=setInterval(function(){!t&&_SgmntfY_._isElemVisible(e)&&(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),t=!0,window.clearInterval(n))},100)};switch(params.actionType){case"CALLBACK":request.recommendationCallback&&request.recommendationCallback(promotionList,metadata,wvCB);break;case"INPAGE_WIDGET":var binded_context=checkSelectorAndRender.bind({params:params,selectorCount:1});binded_context()}}else"CALLBACK"===params.actionType&&request.recommendationCallback&&request.recommendationCallback([],metadata,null)},recommendKeyword:function(params,request){var metadata={title:params.notificationTitle};function checkDynamicItemCount(e,t){for(var n=0;n<e.length;++n)if(e[n].recommendationSource+"|"+e[n].timeFrame==t)return e[n].itemCount;return null}function checkKeywordInList(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return!0;return!1}function checkSelectorAndRender(){var params=this.params,keywordList=this.keywordList,selectorCount=this.selectorCount,target=params.selector;if(target&&_SgmntfY_._getJq()(target).length){for(var keywords=[],k=0;k<keywordList.length;++k)keywords.push({name:keywordList[k],url:""});var recoTitle=params.notificationTitle,renderIdx=0,reConf={title:recoTitle,keywords:keywords,index:function(){return++renderIdx}};try{if(params.preJsCode){eval(params.preJsCode);var retVal=preRenderConf(reConf);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(params.recommendationTemplate,reConf);try{var targetElement=_SgmntfY_._getJq()(target).first();if("SELF"===params.insertType)targetElement.html(renderedHtml),targetElement.attr("data-sgf-scenario-id",params.instanceId),wvCB&&wvCB(targetElement);else{var $div=_SgmntfY_._getJq()("<div/>",{class:"seg-reco-wrapper seg-clear"});$div.attr("data-sgf-scenario-id",params.instanceId),"AFTER"===params.insertType||"BEFORE"===params.insertType?"AFTER"===params.insertType?$div.html(renderedHtml).insertAfter(targetElement):$div.html(renderedHtml).insertBefore(targetElement):"APPEND"!==params.insertType&&"PREPEND"!==params.insertType||("APPEND"===params.insertType?$div.html(renderedHtml).appendTo(targetElement):$div.html(renderedHtml).prependTo(targetElement)),wvCB&&wvCB($div)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling target element["+target+"] with product recommendations: "+e)}try{params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation post js code: "+e)}_SgmntfY_._bindRecommendationTrackEvents("SELF"===params.insertType?targetElement:$div,params.recommendationSettings,params.instanceId,0),_SgmntfY_._getJq()(".seg-label a").on("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",interactionId:params.actionId,instanceId:params.instanceId})})}else if(_SgmntfY_.LOG_MESSAGE("WARN","Error in finding target element["+target+"], element does not exist"),selectorCount<_SgmntfY_._variables.constants.recommendationSelectorFindLimit){++this.selectorCount;var binded=checkSelectorAndRender.bind(this);setTimeout(binded,100)}}for(var keywordList=[],recommendedKeywords=params.recommendedKeywords||{},dynamicItems=JSON.parse(params.dynamicItems)||[],i=0;i<recommendedKeywords.RECOMMENDATION_SOURCE_STATIC_ITEMS.length;++i){var elm=recommendedKeywords.RECOMMENDATION_SOURCE_STATIC_ITEMS[i];checkKeywordInList(keywordList,elm)||keywordList.push(elm)}for(var missingCount=0,ri=0;ri<dynamicItems.length;++ri){void 0===dynamicItems[ri].timeFrame&&(dynamicItems[ri].timeFrame="null");var curRecommendationSource=dynamicItems[ri].recommendationSource+"|"+dynamicItems[ri].timeFrame,curCatItemCount=parseInt(checkDynamicItemCount(dynamicItems,curRecommendationSource));if(isNaN(curCatItemCount)&&(curCatItemCount=0),recommendedKeywords.hasOwnProperty(curRecommendationSource)&&curCatItemCount){missingCount+=curCatItemCount;for(var index=0,i=0;i<recommendedKeywords[curRecommendationSource].length;++i){var elm=recommendedKeywords[curRecommendationSource][i];if(elm.name=_SgmntfY_._decodeHtml(elm.name),index>=curCatItemCount&&0==missingCount)break;keywordList.push(elm),++index,--missingCount}}}if(0!==keywordList.length){"SHUFFLE"===params.ordering&&(keywordList=_SgmntfY_._shuffle(keywordList)),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:params.actionId,instanceId:params.instanceId});var wvInteractionId=params.interactionId,wvInstanceId=params.instanceId,wvCB=function(e){var t=!1;if(!t&&_SgmntfY_._isElemVisible(e))_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),t=!0;else if(!t)var n=setInterval(function(){!t&&_SgmntfY_._isElemVisible(e)&&(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),t=!0,window.clearInterval(n))},100)};switch(params.actionType){case"CALLBACK":request.recommendationCallback&&request.recommendationCallback(keywordList,metadata,wvCB);break;case"INPAGE_WIDGET":var binded_context=checkSelectorAndRender.bind({params:params,keywordList:keywordList,selectorCount:1});binded_context()}}else request.recommendationCallback&&request.recommendationCallback([],metadata,null)},webNotification:function(e){},redirectUrl:function(e){_SgmntfY_.LOG_MESSAGE("DEBUG","Redirecting action to url: "+e.redirectUrl),window.location=e.redirectUrl},jsFunctionCall:function(e){e.actionType="JAVASCRIPT_FUNCTION",_SgmntfY_._actions.jsAction(e)},jsAction:function(params){var actionType=params.actionType;switch(actionType){case"JAVASCRIPT_EVENT":var event=params.event,parameters=[];try{params.parameters&&(parameters=JSON.parse(params.parameters))}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Js Action (Event Trigger) - Cannot parse parameters json, str: "+params.parameters),parameters=[]}parameters.push(function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_success",interactionId:params.actionId,instanceId:params.instanceId})}),parameters.push(function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_reject",interactionId:params.actionId,instanceId:params.instanceId})}),_SgmntfY_._getJq()(document).trigger(event,parameters),_SgmntfY_.LOG_MESSAGE("DEBUG","Js Action (Event Trigger) - Triggered Event: "+event);break;case"JAVASCRIPT_CODE":try{eval(params.javascriptCode),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_success",interactionId:params.actionId,instanceId:params.instanceId}),_SgmntfY_.LOG_MESSAGE("DEBUG","Js Action (Execute Code) successfully executed")}catch(e){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_reject",interactionId:params.actionId,instanceId:params.instanceId}),_SgmntfY_.LOG_MESSAGE("WARN","Error in JS Action (Execute Code): "+e)}break;case"JAVASCRIPT_FUNCTION":default:var fx=window[params.function],parameters=[];if("function"==typeof fx){try{params.parameters&&(parameters=JSON.parse(params.parameters))}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Js Action (Function Call) - Cannot parse parameters json, str: "+params.parameters),parameters=[]}parameters.push(function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_success",interactionId:params.actionId,instanceId:params.instanceId})}),parameters.push(function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_reject",interactionId:params.actionId,instanceId:params.instanceId})}),fx.apply(null,parameters),_SgmntfY_.LOG_MESSAGE("DEBUG","Js Action (Function Call) successfully run for function: "+params.function)}else _SgmntfY_.LOG_MESSAGE("WARN","Js Action (Function Call) failed, non existing function: "+params.function)}},jsCountdownTimer:function(e){var t=e.timeout;_SgmntfY_.LOG_MESSAGE("DEBUG","Starting countdown timer with "+1e3*(t||0)+" second(s)"),setTimeout(function(){_SgmntfY_.LOG_MESSAGE("DEBUG","Countdown timer finished after "+1e3*(t||0)+" second(s)"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"timeout",interactionId:e.actionId,instanceId:e.instanceId})},1e3*(t||0))},sendBannerDetails:function(e,t){var n=t.originalParams;n.group=e.group;var a=[],r=_SgmntfY_._functions.bannerGroupDetail(n);r&&a.push(r),_SgmntfY_._sendRequestToServer(a)},showPopup:function(params,request){var config={instanceId:params.instanceId,title:params.notificationTitle,vertical:params.verticalPosition,horizontal:params.horizontalPosition};try{if(params.preJsCode&&""!=params.preJsCode){eval(params.preJsCode);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing jb trigger pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(params.recommendationTemplate,config);_SgmntfY_._getJq()("body").prepend(renderedHtml);var styleDataId=_SgmntfY_._variables.journey.instanceId+"_trigger";params.cssCode&&_SgmntfY_._getJq()("<style data-id="+styleDataId+"/>").html(params.cssCode).prependTo(_SgmntfY_._getJq()("body")),"true"===params.overlay&&(_SgmntfY_._getJq()('<div class="seg-popup-overlay"></div>').prependTo(_SgmntfY_._getJq()("body")),_SgmntfY_._getJq()(".seg-popup-overlay").show()),document.getElementById("sgm-journey-trigger-"+config.instanceId).addEventListener("click",_SgmntfY_._jbTriggerClickHandler.bind(this,config.instanceId));try{params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing jb trigger post js code: "+e)}},buildJourney:function(e,t){var n;if(e.discovery&&(n=JSON.parse(e.discovery)||[]),n.length>0&&n[0].type){_SgmntfY_._jbOnInitJourneyFlowExecution(e.instanceId,n),_SgmntfY_._variables.journey.isCategoryTree=e.isCategoryTree?e.isCategoryTree:"true";var a={step:_SgmntfY_._variables.journey.currentStep,instanceId:_SgmntfY_._variables.journey.instanceId,answer:JSON.stringify(_SgmntfY_._variables.journey.answer)};_SgmntfY_._variables.segmentifyObj("journey:start",a);var r={steps:n,tree:e.tree};_SgmntfY_._jbCalculatePagesCount(r),_SgmntfY_._jbOnStepViewHandler(r)}},giveCoupon:function(params,request){if(params&&params.coupon){var notificationTitleMap=JSON.parse(params.notificationTitleMap||"{}"),notificationTitle=notificationTitleMap[request.data.lang]||params.notificationTitle,config={coupon:params.coupon,button:_SgmntfY_._jbGetButtonText("DELIVERY"),couponTitle:notificationTitle,instanceId:params.instanceId};try{if(params.preJsCode&&""!==params.preJsCode){if(eval(params.preJsCode),preRenderConf)var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing jb trigger pre js code: "+e)}var domparser=new DOMParser,hasPopupRecoTemplate=!1;try{if(0===_SgmntfY_._getJq()("#sgm-journey-coupon-template").length){var renderedHtml=_SgmntfY_._getMustache().render(params.recommendationTemplate,config);_SgmntfY_._getJq()("body").prepend(renderedHtml)}else hasPopupRecoTemplate=!0;var couponWrapperTemplate=domparser.parseFromString(params.recommendationTemplate,"text/html").getElementById("sgm-journey-coupon-template"),renderedHtml=_SgmntfY_._getMustache().render(couponWrapperTemplate.innerHTML,config);_SgmntfY_._getJq()("#sgm-journey-coupon-template").html(renderedHtml),_SgmntfY_._getJq()("#sgm-journey-coupon-wrapper").removeClass("sgm-journey-none");var copyButton=document.querySelector(".sgm-journey-discovery-action.sgm-journey-discovery-action-copy");copyButton&&copyButton.classList.remove("sgm-journey-none"),_SgmntfY_._jbDeliveryOnBindEventHandler(hasPopupRecoTemplate),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:params.actionId,instanceId:_SgmntfY_._variables.journey.instanceId});var styleDataId=_SgmntfY_._variables.journey.instanceId+"_delivery";params.cssCode&&_SgmntfY_._getJq()("<style data-id="+styleDataId+"/>").html(params.cssCode).prependTo(_SgmntfY_._getJq()(".sgm-journey-delivery.seg-popup"))}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in rendering jb coupon: "+e)}try{params.postJsCode&&""!==params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing jb trigger post js code: "+e)}}},landingPage:function(params,request){if(params&&params.landingPageUrl){var notificationTitleMap=JSON.parse(params.notificationTitleMap||"{}"),notificationTitle=notificationTitleMap[request.data.lang]||params.notificationTitle;_SgmntfY_._variables.journey.landingPageUrl=params.landingPageUrl;var config={button:_SgmntfY_._jbGetButtonText("DELIVERY")};config.button.redirect=notificationTitle;try{if(params.preJsCode&&""!==params.preJsCode){if(eval(params.preJsCode),preRenderConf)var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing jb trigger pre js code: "+e)}var domparser=new DOMParser;try{var redirectButtonTemplate=domparser.parseFromString(params.recommendationTemplate,"text/html").getElementById("sgm-journey-action-redirect"),renderedHtml=_SgmntfY_._getMustache().render(redirectButtonTemplate.innerHTML,config);_SgmntfY_._getJq()("#sgm-journey-action-redirect").html(renderedHtml),params.cssCode&&_SgmntfY_._getJq()("<style />").html(params.cssCode).prependTo(_SgmntfY_._getJq()(".sgm-journey-delivery.seg-popup"));var redirectButton=document.getElementById("sgm-journey-action-redirect");redirectButton&&redirectButton.classList.remove("sgm-journey-none"),_SgmntfY_._jbDeliveryOnBindEventHandler(!0)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in rendering jb landing Page: "+e)}try{params.postJsCode&&""!==params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing jb trigger post js code: "+e)}}}},_jbOverFlowOperations:{_disableBodyOverFlowForJBWrapper:function(){_SgmntfY_._evalSearchBodyScrollLockPreJs();var e=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector);e&&bodyScrollLock.disableBodyScroll(e)},_enableBodyOverFlowForJBWrapper:function(){var e=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector);e&&window.setTimeout(function(){bodyScrollLock.enableBodyScroll(e)},100)},_journeyFinished:function(e){return e&&e.originalParams&&("SUCCESS"===e.originalParams.type||"sfy-jb-finish"===e.originalParams.type)}},_jbCalculatePagesCount:function(e){_SgmntfY_._variables.journey.allPageCount=e.steps.length,_SgmntfY_._variables.journey.barRatio=0,_SgmntfY_._variables.journey.allPageCount>0&&(_SgmntfY_._variables.journey.barRatio=100/_SgmntfY_._variables.journey.allPageCount)},_jbTriggerClickHandler:function(e){_SgmntfY_._variables.segmentifyObj("journey:init",{instanceId:e})},_jbOnInitJourneyFlowExecution:function(e,t){_SgmntfY_._jbSetInitialVariables(e,t),_SgmntfY_._getJq()(".seg-popup-overlay").remove();var n=_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.journey.maxMobileWidth?"sgm-journey-mobile":"sgm-journey-desktop";document.getElementById("sgm-journey-main-wrapper")||_SgmntfY_._getJq()('<div id="sgm-journey-main-wrapper" class="'+n+'" ></div>').prependTo(_SgmntfY_._getJq()("body")),_SgmntfY_._jbOverFlowOperations._disableBodyOverFlowForJBWrapper();var a=document.querySelectorAll(".sgm-journey-trigger");a&&a.length>0&&a.forEach(function(e){e.classList.add("sgm-journey-none")})},_jbOnDestroyJourneyFlowExecution:function(e){var t={step:_SgmntfY_._variables.journey.currentStep,instanceId:_SgmntfY_._variables.journey.instanceId,answer:JSON.stringify(_SgmntfY_._variables.journey.answer)};try{var n=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector);!1===e?(_SgmntfY_._jbOverFlowOperations._enableBodyOverFlowForJBWrapper(),_SgmntfY_._jbTriggerButtonReEnable(),n&&n.parentNode.removeChild(n)):(_SgmntfY_._variables.segmentifyObj("journey:finish",t),n&&n.classList.add("sgm-journey-none"))}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in destroying jb flow: "+e)}},_jbTriggerButtonReEnable:function(){var e=document.querySelectorAll(".sgm-journey-trigger");e&&e.length>0&&e.forEach(function(e){e.classList.remove("sgm-journey-none")})},_jbSetInitialVariables:function(e,t){_SgmntfY_._variables.journey={answer:{},closed:!1,instanceId:e,currentStep:null,nextStep:t[0].type,previousStep:void 0,allSteps:t.map(function(e){return e.type}),maxMobileWidth:801,priceRange:{min:void 0,max:void 0},buttonTextMap:_SgmntfY_._variables.journey.buttonTextMap||{EN:{copy:"Copy",next:"Next",previous:"Go Back",close:"Close",skip:"Skip",finish:"Finish",start:"Let's Start",customize:"Customize",skipAndFinish:"Skip & Finish"},TR:{copy:"Kopyala",next:"Sonraki",previous:"Geri Dn",close:"Kapat",skip:"Atla",finish:"Bitir",start:"Hadi Balayalm",customize:"zelletir",skipAndFinish:"Atla ve Bitir"}},wrapperSelector:"#sgm-journey-main-wrapper",pageCount:0,allPageCount:0,barRatio:0,barWidth:0,isTriggeredBackButton:!1,progressBar:{EN:{label:"Step ",separator:" of "},TR:{label:"Adm ",separator:" / "}}}},_jbTransformStepItems:function(e,t){return t},_jbTransformCategoryStepItems:function(e,t){var n=_SgmntfY_._variables.journey.isCategoryTree;return t.map(function(e){var t={};if(t.originalData=e,t.lastChild=e,n&&"false"===n){var a=e.split(">");t.lastChild=a[a.length-1].trim()}return t})},_jbGetStepItems:function(e,t,n){try{var a=_SgmntfY_._variables.journey.answer;if("MAIN_CATEGORY"===e)return _SgmntfY_._jbTransformStepItems(e,Object.keys(n));if("CATEGORY"===e)return _SgmntfY_._jbTransformCategoryStepItems(e,Object.keys(n[a.mainCategory]));if("BRAND"===e)return _SgmntfY_._jbTransformStepItems(e,Object.keys(n[a.mainCategory][a.category]));if("SIZE"===e||"COLOR"===e||"PRICE_RANGE"===e||"CUSTOM_PRICE_RANGE"===e){var r={SIZE:"s",COLOR:"c",PRICE_RANGE:"p",CUSTOM_PRICE_RANGE:"p"},i=[];if(_SgmntfY_._variables.journey.allSteps.indexOf("BRAND")>-1){var s=Object.keys(n[a.mainCategory][a.category]);a.brand&&a.brand.length>0&&(s=a.brand),s.forEach(function(t){var s=n[a.mainCategory][a.category][t];i.push.apply(i,s[r[e]]||[])})}else{var o=n[a.mainCategory][a.category];i.push.apply(i,o[r[e]]||[])}if("PRICE_RANGE"===e||"CUSTOM_PRICE_RANGE"===e){var c=i.map(m.bind(null,!1)).sort(l),g=i.map(m.bind(null,!0)).sort(l);return c&&c.length>0&&g&&g.length>0?"CUSTOM_PRICE_RANGE"===e?[c[0],g[g.length-1]]:_SgmntfY_._jbGetPriceRangeData(c[0],g[g.length-1]):[]}var _=0;return t.forEach(function(e){e&&e.itemCount&&(_+=e.itemCount)}),_SgmntfY_._getDistinctArray(i.sort(function(e,t){return Object.entries(t)[0][1]-Object.entries(e)[0][1]}).map(function(e){var t=Object.entries(e);return t&&t[0]&&t[0][0]?t[0][0]:void 0})).slice(0,_)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error occurred while preparing journey items")}return[];function m(e,t){var n=!0===e?1:0;if(t&&t.split("-")&&t.split("-")[n]){var a=t.split("-")[n].trim();return""===a?0:parseFloat(a)}}function l(e,t){return e-t}},_jbGetPriceRangeData:function(e,t){if(0===e&&0===t)return[];var n=m(e,!0),a=m(t,!1);if(n==a)return e===t?[e.toString()]:[e+" - "+t];var r=(a-n)/6,i=n+r,s=a-r,o=(i+s)/2,c=l(i),g=l(o),_=l(s);return c<e&&(c=Math.ceil(e)),_>t&&(_=Math.floor(t)),["0 - "+c,c+" - "+g,g+" - "+_,_+"+"];function m(e,t){var n;if(e>1e5){var a=e%1e3;!0===t&&(e+=1e3),n=e-a}else if(e>1e4){a=e%500;!0===t&&(e+=500),n=e-a}else if(e>1e3){a=e%100;!0===t&&(e+=100),n=e-a}else if(e>100){a=e%10;!0===t&&(e+=10),n=e-a}else if(e>50){a=e%5;!0===t&&(e+=5),n=e-a}else n=l(e);return n}function l(e){var t=e%5;return t>=2.5&&(e+=5),Math.floor(e-t)}},_jbGetButtonText:function(e,t){var n={};if(_SgmntfY_._variables.journey&&_SgmntfY_._variables.journey.buttonTextMap){var a=_SgmntfY_._variables.journey.buttonTextMap[_SgmntfY_._variables.language]?_SgmntfY_._variables.language:"EN";t&&t[_SgmntfY_._variables.language]?n.next=t[_SgmntfY_._variables.language]:n.next="WELCOME"===e?_SgmntfY_._variables.journey.buttonTextMap[a].start:_SgmntfY_._variables.journey.buttonTextMap[a].next,n.skip=_SgmntfY_._variables.journey.buttonTextMap[a].skip,n.skipAndFinish=_SgmntfY_._variables.journey.buttonTextMap[a].skipAndFinish,n.finish=_SgmntfY_._variables.journey.buttonTextMap[a].finish,n.copy=_SgmntfY_._variables.journey.buttonTextMap[a].copy,n.close=_SgmntfY_._variables.journey.buttonTextMap[a].close,n.customize=_SgmntfY_._variables.journey.buttonTextMap[a].customize}return n},_jbOnStepViewHandler:function(jbDiscoveryData){var currentStep;if(currentStep=_SgmntfY_._variables.journey.isTriggeredBackButton?_SgmntfY_._jbGetPrevStepData(jbDiscoveryData):_SgmntfY_._jbGetCurrentStepData(jbDiscoveryData,!0),currentStep){shiftStep(currentStep);var config={title:currentStep.titleMap[_SgmntfY_._variables.language],step:currentStep.type.toLowerCase(),button:_SgmntfY_._jbGetButtonText(currentStep.type,currentStep.buttonTextMap),items:_SgmntfY_._jbGetStepItems(currentStep.type,currentStep.items,jbDiscoveryData.tree),currencyCode:_SgmntfY_._variables.currency},params={step:_SgmntfY_._variables.journey.currentStep,instanceId:_SgmntfY_._variables.journey.instanceId};_SgmntfY_._variables.segmentifyObj("journey:view",params);try{if(currentStep.preJsCode&&""!=currentStep.preJsCode){if(eval(currentStep.preJsCode),preRenderConf)var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing jb trigger pre js code: "+e)}if(_SgmntfY_._jbSetPageCountAndProgressBarWidth(),"WELCOME"!==_SgmntfY_._variables.journey.currentStep&&0===config.items.length)_SgmntfY_._jbOnStepViewHandler(jbDiscoveryData);else{var renderedHtml=_SgmntfY_._getMustache().render(currentStep.recommendationTemplate,config);_SgmntfY_._getJq()("#sgm-journey-main-wrapper").html(renderedHtml),_SgmntfY_._jbOnBindEventHandler(jbDiscoveryData,config.items);var styleDataId=_SgmntfY_._variables.journey.instanceId+"_"+currentStep.type;currentStep.cssCode&&_SgmntfY_._getJq()("<style data-id="+styleDataId+"/>").html(currentStep.cssCode).prependTo(_SgmntfY_._getJq()(_SgmntfY_._variables.journey.wrapperSelector)),_SgmntfY_._jbSetProgressBar(),_SgmntfY_._variables.journey.nextStep?"WELCOME"===_SgmntfY_._variables.journey.currentStep?_SgmntfY_._jbActionButtonHandler("next",currentStep,!0):_SgmntfY_._jbActionButtonHandler("skip",currentStep,!0):_SgmntfY_._jbActionButtonHandler("skipAndFinish",currentStep,!0),_SgmntfY_._variables.journey.isTriggeredBackButton&&!1===_SgmntfY_._jbIsSingleDataSelect()&&(reselectItems(_SgmntfY_._variables.journey.currentStep.toLowerCase()),_SgmntfY_._jbActionButtonHandler("next",currentStep,!0)),_SgmntfY_._variables.journey.isTriggeredBackButton=!1,_SgmntfY_._jbActionButtonHandler("previous",currentStep,!!_SgmntfY_._variables.journey.previousStep);try{currentStep.postJsCode&&eval(currentStep.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation post js code: "+e)}}}else _SgmntfY_._variables.segmentifyObj("journey:success",{instanceId:_SgmntfY_._variables.journey.instanceId,answer:JSON.stringify(_SgmntfY_._variables.journey.answer)});function shiftStep(e){_SgmntfY_._variables.journey.currentStep=e.type;for(var t=0;t<jbDiscoveryData.steps.length;t++){if(jbDiscoveryData.steps[t]&&jbDiscoveryData.steps[t].type===e.type){jbDiscoveryData.steps[t-1]?_SgmntfY_._variables.journey.previousStep=jbDiscoveryData.steps[t-1].type:_SgmntfY_._variables.journey.previousStep=void 0,jbDiscoveryData.steps[t+1]?_SgmntfY_._variables.journey.nextStep=jbDiscoveryData.steps[t+1].type:_SgmntfY_._variables.journey.nextStep=void 0;break}t===jbDiscoveryData.steps.length-1&&(_SgmntfY_._variables.journey.nextStep=void 0)}}function reselectItems(e){var t=_SgmntfY_._jbIsCheckMarkDataSelect()?"sgm-journey-checkmark":"sgm-journey-content-selected",n=document.querySelectorAll(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-content-item"),a=_SgmntfY_._variables.journey.answer[e];n&&n.length>0&&a&&a.length>0&&n.forEach(function(e){a.forEach(function(n){e.hasAttribute("data-original-value")&&n&&e.getAttribute("data-original-value")===n&&e.classList.add(t)})})}},_jbSetPageCountAndProgressBarWidth:function(){_SgmntfY_._variables.journey.isTriggeredBackButton?_SgmntfY_._variables.journey.pageCount>0&&(_SgmntfY_._variables.journey.pageCount-=1,_SgmntfY_._variables.journey.barWidth-=_SgmntfY_._variables.journey.barRatio):_SgmntfY_._variables.journey.pageCount<_SgmntfY_._variables.journey.allPageCount&&(_SgmntfY_._variables.journey.pageCount+=1,_SgmntfY_._variables.journey.barWidth+=_SgmntfY_._variables.journey.barRatio)},_jbSetProgressBar:function(){var e=document.getElementById("sgm-journey-bar");if(e){var t=_SgmntfY_._variables.journey.barWidth;t+_SgmntfY_._variables.journey.barRatio>100?e.style.width="100%":e.style.width=t+"%";var n="EN";"TR"===_SgmntfY_._variables.language&&(n=_SgmntfY_._variables.language);var a=_SgmntfY_._variables.journey.progressBar[n];document.getElementById("sgm-journey-progress-label").innerHTML=a.label+_SgmntfY_._variables.journey.pageCount+a.separator+_SgmntfY_._variables.journey.allPageCount}},_jbGetPrevStepData:function(e){var t=e.steps.filter(function(e){return e.type===_SgmntfY_._variables.journey.previousStep});if(t)return t[0]},_jbGetCurrentStepData:function(e,t){var n=e.steps.filter(function(e){return e.type===(!0===t?_SgmntfY_._variables.journey.nextStep:_SgmntfY_._variables.journey.currentStep)});if(n)return n[0]},_jbOnBindEventHandler:function(e,t){var n=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-topbar span.sgm-journey-close");n&&n.addEventListener("click",_SgmntfY_._jbExitHandler);var a=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-action .sgm-journey-discovery-action");a&&a.addEventListener("click",_SgmntfY_._jbOnStepChangeHandler.bind(this,e));var r=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-action .sgm-journey-discovery-prev-action");r&&r.addEventListener("click",_SgmntfY_._jbOnPrevStepChangeHandler.bind(this,e));var i=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-content .sgm-journey-price-range-customize-button");i&&i.addEventListener("click",_SgmntfY_._jbOnPriceRangeCustomizeHandler.bind(this,t,e));var s=document.querySelectorAll(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-content .sgm-journey-content-item");s&&s.length>0&&s.forEach(function(t){t.addEventListener("click",_SgmntfY_._jbOnDataSelectHandler.bind(this,e),!1)})},_jbDeliveryOnBindEventHandler:function(e){var t=document.querySelectorAll(".sgm-journey-delivery .sgm-journey-discovery-action");t&&t.length>0&&(t.forEach(function(e){"copy"===e.getAttribute("data-type")?e.addEventListener("click",_SgmntfY_._textCopyToClipBoard.bind(this,"sgm-journey-delivery-coupon")):"close"===e.getAttribute("data-type")?e.addEventListener("click",_SgmntfY_._jbOnCloseDelivery):"redirect"===e.getAttribute("data-type")&&e.addEventListener("click",_SgmntfY_._jbOnLandingPage)}),!1===e&&_SgmntfY_._getJq()(".seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){_SgmntfY_._sgfPopupCloseHandler(!1),e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3)}))},_jbOnLandingPage:function(){window.location=_SgmntfY_._variables.journey.landingPageUrl},_jbOnCloseDelivery:function(){var e=document.querySelector(".sgm-journey-delivery.seg-popup");e&&(e.classList.remove("segFadeInUp"),e.classList.add("segFadeOutDown"),window.setTimeout(function(){_SgmntfY_._sgfPopupCloseHandler(!1),e.parentNode.removeChild(e)},1e3))},_jbOnPriceRangeCustomizeHandler:function(e,t){var n=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-content-price-range-select"),a=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-content-price-range-custom");if(n&&a){n.classList.add("sgm-journey-none"),a.classList.remove("sgm-journey-none");var r=_SgmntfY_._jbGetCurrentStepData(t,!1);_SgmntfY_._jbActionButtonHandler("finish",r,!0);var i=document.querySelectorAll(_SgmntfY_._variables.journey.wrapperSelector+".sgm-journey-content-selected");i&&i.length>0&&i.forEach(function(e){e.classList.remove("sgm-journey-content-selected")});var s,o,c=_SgmntfY_._jbGetStepItems("CUSTOM_PRICE_RANGE",null,t.tree);c&&2===c.length?(s=c[0],o=c[1]):(s=parseInt(e&&e.length>0?e[0].replace("-","").trim():0),o=parseInt(e&&e.length>0?e[e.length-1].replace("-","").trim():0)),s-=s%10,o=o-o%10+10;var g=_SgmntfY_._variables.journey.priceRange.min||(s>=2?s-2:s),_=_SgmntfY_._variables.journey.priceRange.max||o+(o>10?20:5);function m(e,t){"input"===e.type&&(e=e.currentTarget),t||0===t||(t=Math.min(e.value,document.getElementById("sgm-journey-slider-range-input-value-max").value));var n=parseInt(e.min),a=parseInt(e.max),r=100/(a-n)*t-100/(a-n)*n;document.getElementsByClassName("sgm-journey-slider-range-point-min")[0].style.left=r+"%",document.getElementsByClassName("sgm-journey-slider-inverse-left")[0].style.width=r+"%",document.getElementsByClassName("sgm-journey-slider-range-fill")[0].style.left=r+"%",document.getElementsByClassName("sgm-journey-slider-range-fill")[0].min=r,document.getElementById("sgm-journey-slider-range-point-value-min").parentElement.style.left=r+"%",document.getElementById("sgm-journey-slider-range-point-value-min").innerHTML=""+t,document.getElementById("price-range-min").value=t;var i=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-content-item-custom");i&&(i.classList.add("sgm-journey-content-selected"),i.setAttribute("data-original-value",document.getElementById("price-range-min").value+" - "+document.getElementById("price-range-max").value))}function l(e,t){"input"===e.type&&(e=e.currentTarget),t||0===t||(t=Math.max(e.value,document.getElementById("sgm-journey-slider-range-input-value-min").value));var n=parseInt(e.min),a=parseInt(e.max),r=100/(a-n)*parseInt(t)-100/(a-n)*n;document.getElementsByClassName("sgm-journey-slider-inverse-right")[0].style.width=100-r+"%",document.getElementsByClassName("sgm-journey-slider-range-fill")[0].style.right=100-r+"%",document.getElementsByClassName("sgm-journey-slider-range-fill")[0].max=r,document.getElementsByClassName("sgm-journey-slider-range-point-max")[0].style.left=r+"%",document.getElementById("sgm-journey-slider-range-point-value-max").parentElement.style.left=r+"%",document.getElementById("sgm-journey-slider-range-point-value-max").innerHTML=""+t,document.getElementById("price-range-max").value=t;var i=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-content-item-custom");i&&(i.classList.add("sgm-journey-content-selected"),i.setAttribute("data-original-value",document.getElementById("price-range-min").value+" - "+document.getElementById("price-range-max").value))}document.getElementById("sgm-journey-slider-range-input-value-min").min=g,document.getElementById("sgm-journey-slider-range-input-value-min").max=_,document.getElementById("sgm-journey-slider-range-input-value-min").value=s,document.getElementById("sgm-journey-slider-range-input-value-max").min=g,document.getElementById("sgm-journey-slider-range-input-value-max").max=_,document.getElementById("sgm-journey-slider-range-input-value-max").value=o,m(document.getElementById("sgm-journey-slider-range-input-value-max"),s),l(document.getElementById("sgm-journey-slider-range-input-value-min"),o),document.getElementById("sgm-journey-slider-range-input-value-min").addEventListener("input",m.bind(this)),document.getElementById("sgm-journey-slider-range-input-value-max").addEventListener("input",l.bind(this))}},_jbOnDataSelectHandler:function(e,t){var n=_SgmntfY_._jbIsCheckMarkDataSelect()?"sgm-journey-checkmark":"sgm-journey-content-selected";if(_SgmntfY_._jbIsSingleDataSelect()){var a=document.querySelectorAll(_SgmntfY_._variables.journey.wrapperSelector+" ."+n);a&&a.length>0&&a.forEach(function(e){e.classList.remove("sgm-journey-content-selected")}),t.currentTarget.classList.add("sgm-journey-content-selected"),_SgmntfY_._jbIsAllowedToChangeStepAfterSelect()&&_SgmntfY_._jbOnStepChangeHandler(e)}else{t.currentTarget.classList.contains(n)?t.currentTarget.classList.remove(n):t.currentTarget.classList.add(n);var r=document.querySelectorAll(_SgmntfY_._variables.journey.wrapperSelector+" ."+n),i=r&&r.length>0,s=_SgmntfY_._jbGetCurrentStepData(e,!1);!_SgmntfY_._variables.journey.nextStep&&i&&_SgmntfY_._jbActionButtonHandler("finish",s,!0),!_SgmntfY_._variables.journey.nextStep&&!i&&_SgmntfY_._jbActionButtonHandler("skipAndFinish",s,!0),_SgmntfY_._variables.journey.nextStep&&i&&_SgmntfY_._jbActionButtonHandler("next",s,!0),_SgmntfY_._variables.journey.nextStep&&!i&&_SgmntfY_._jbActionButtonHandler("skip",s,!0)}},_jbActionButtonHandler:function(e,t,n){var a,r=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-action .sgm-journey-discovery-action");("previous"===e&&(r=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-action .sgm-journey-discovery-prev-action")),r)&&(!0===n?(r.classList.remove("sgm-journey-none"),r.setAttribute("data-type",e),"previous"===e?(a="TR"===_SgmntfY_._variables.language?_SgmntfY_._variables.language:"EN",r.textContent=_SgmntfY_._variables.journey.buttonTextMap[a].previous):r.textContent=_SgmntfY_._jbGetButtonText(t.type,t.buttonTextMap)[e]||""):r.classList.add("sgm-journey-none"))},_jbIsSingleDataSelect:function(){return"MAIN_CATEGORY"===_SgmntfY_._variables.journey.currentStep||"CATEGORY"===_SgmntfY_._variables.journey.currentStep},_jbIsCheckMarkDataSelect:function(){return"COLOR"===_SgmntfY_._variables.journey.currentStep},_jbIsAllowedToChangeStepAfterSelect:function(){return"MAIN_CATEGORY"===_SgmntfY_._variables.journey.currentStep||"CATEGORY"===_SgmntfY_._variables.journey.currentStep},_jbOnStepChangeHandler:function(e){var t=_SgmntfY_._jbIsCheckMarkDataSelect()?"sgm-journey-checkmark":"sgm-journey-content-selected",n=[],a=document.querySelectorAll(_SgmntfY_._variables.journey.wrapperSelector+" ."+t);a&&a.length>0&&a.forEach(function(e){e.hasAttribute("data-original-value")&&n.push(e.getAttribute("data-original-value"))}),_SgmntfY_._jbPrepareJourneyAnswer(n);var r={step:_SgmntfY_._variables.journey.currentStep,instanceId:_SgmntfY_._variables.journey.instanceId,answer:JSON.stringify(_SgmntfY_._variables.journey.answer)};_SgmntfY_._variables.segmentifyObj("journey:select",r),_SgmntfY_._jbOnStepViewHandler(e)},_jbPrepareJourneyAnswer:function(e){switch(_SgmntfY_._variables.journey.currentStep){case"MAIN_CATEGORY":_SgmntfY_._variables.journey.answer.mainCategory=e[0];break;case"CATEGORY":_SgmntfY_._variables.journey.answer.category=e[0];break;case"BRAND":_SgmntfY_._variables.journey.answer.brand=e;break;case"SIZE":_SgmntfY_._variables.journey.answer.size=e;break;case"COLOR":_SgmntfY_._variables.journey.answer.color=e;break;case"PRICE_RANGE":e&&e.length>0&&(e=e.map(function(e){return e.replace("+"," - ")})),_SgmntfY_._variables.journey.answer.priceRange=e}},_jbOnPrevStepChangeHandler:function(e){_SgmntfY_._variables.journey.isTriggeredBackButton=!0,_SgmntfY_._jbRecalculateJourneyAnswer(e);var t={step:_SgmntfY_._variables.journey.currentStep,instanceId:_SgmntfY_._variables.journey.instanceId,answer:JSON.stringify(_SgmntfY_._variables.journey.answer)};_SgmntfY_._variables.segmentifyObj("journey:select",t),_SgmntfY_._jbOnStepViewHandler(e)},_jbRecalculateJourneyAnswer:function(e){if("MAIN_CATEGORY"===_SgmntfY_._variables.journey.previousStep)_SgmntfY_._variables.journey.answer={};else if("CATEGORY"===_SgmntfY_._variables.journey.previousStep){var t=_SgmntfY_._variables.journey.answer.mainCategory;_SgmntfY_._variables.journey.answer={},_SgmntfY_._variables.journey.answer.mainCategory=t}else for(var n={},a=0;a<e.steps.length;a++){var r=e.steps[a].type,i=r.toLowerCase();if("MAIN_CATEGORY"===r?i="mainCategory":"PRICE_RANGE"===r&&(i="priceRange"),_SgmntfY_._variables.journey.currentStep===r){_SgmntfY_._variables.journey.answer={},_SgmntfY_._variables.journey.answer=n;break}_SgmntfY_._variables.journey.answer[i]&&(n[i]=_SgmntfY_._variables.journey.answer[i])}},_jbExitHandler:function(){var e={step:_SgmntfY_._variables.journey.currentStep,instanceId:_SgmntfY_._variables.journey.instanceId,answer:JSON.stringify(_SgmntfY_._variables.journey.answer)};_SgmntfY_._variables.segmentifyObj("journey:exit",e),_SgmntfY_._jbOnDestroyJourneyFlowExecution(!1)},_getDistinctArray:function(e){return e&&e.length>0?e.filter(function(t,n){return t&&e.indexOf(t)===n}):[]},_campaigns:{NEWSLETTER:function(campaign,request){var config={title:campaign.title,description:campaign.description,placeholder:campaign.placeholder,termsUrl:campaign.termsUrl,termsText:campaign.termsText,buttonSubmitText:campaign.buttonSubmitText,buttonThanksText:campaign.buttonThanksText,buttonBgColor:campaign.buttonBgColor,buttonTextColor:campaign.buttonTextColor,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}_SgmntfY_.LOG_MESSAGE("DEBUG","Newsletter popup appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),_SgmntfY_._getJq()(".seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove()},1e3)}),_SgmntfY_._getJq()(".seg-form-submit").bind("click",function(e){_SgmntfY_._getJq()(".seg-form-input").removeClass("seg-form-invalid"),_SgmntfY_._getJq()(".seg-email-collection .seg-checkbox").removeClass("seg-form-invalid"),e.preventDefault();var t=_SgmntfY_._getJq()(".seg-form-input"),n=_SgmntfY_._getJq()('.seg-email-collection .seg-form-footer input[type="checkbox"]');if(isEmail(t.val())&&1==n.is(":checked")){_SgmntfY_._getJq()(this).addClass("seg-sending"),_SgmntfY_._getJq()(this).css({"pointer-events":"none"}),setTimeout(function(){_SgmntfY_._getJq()(".seg-email-collection").addClass("seg-popup-thanks").removeClass("segFadeInUp")},1300),setTimeout(function(){_SgmntfY_._getJq()(".seg-email-collection").addClass("segFadeOutDown")},3e3),setTimeout(function(){_SgmntfY_._getJq()(".seg-email-collection").remove()},6e3);var a=_SgmntfY_._getJq()("#seg-email-collection");a.length>0&&(_SgmntfY_._variables.segmentifyObj("user:form",{formName:campaign.name,fields:a.sgmSerializeForm(),params:{instanceId:campaign.instanceId}}),_SgmntfY_._variables.segmentifyObj("user:iyspermissions",{email:a.sgmSerializeForm().email,emailNtf:!0}))}isEmail(t.val())||t.addClass("seg-form-invalid"),0==n.is(":checked")&&_SgmntfY_._getJq()(".seg-terms .seg-checkbox").addClass("seg-form-invalid")});var isEmail=function(e){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)}},FORM:function(campaign,request){for(var config={title:campaign.title,description:campaign.description,buttonSubmitText:campaign.buttonSubmitText,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition},fields=campaign.fields||[],i=0;i<fields.length;++i){var field=fields[i];config["ff"+i+"_required"]=field.required,"INPUT"===field.type?(config["ff"+i+"_name"]=field.name,config["ff"+i+"_placeholder"]=field.placeholder,config["ff"+i+"_inputType"]=field.inputType,field.name?config["ff"+i+"_fieldName"]=field.name:config["ff"+i+"_fieldName"]="input-"+i):"TEXT_AREA"===field.type?(config["ff"+i+"_name"]=field.name,config["ff"+i+"_placeholder"]=field.placeholder,field.name?config["ff"+i+"_fieldName"]=field.name:config["ff"+i+"_fieldName"]="textarea-"+i):"CHECKBOX"!==field.type&&"RADIO_BUTTON"!==field.type||(config["ff"+i+"_groupTitle"]=field.groupTitle,config["ff"+i+"_options"]=field.options,field.groupTitle?config["ff"+i+"_fieldName"]=field.groupTitle:"CHECKBOX"===field.type?config["ff"+i+"_fieldName"]="checkbox-"+i:config["ff"+i+"_fieldName"]="radiobutton-"+i)}try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}_SgmntfY_.LOG_MESSAGE("DEBUG","Form popup appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),_SgmntfY_._getJq()(".seg-form-survey").each(function(){var e=_SgmntfY_._getJq()(this);-1===e.attr("class").indexOf("cmp_")&&e.addClass(campaign.instanceId)}),"true"===campaign.overlay&&_SgmntfY_._getJq()(".seg-popup-overlay").show(),_SgmntfY_._getJq()("."+campaign.instanceId+" .seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3)}),_SgmntfY_._getJq()("."+campaign.instanceId+" .seg-form-submit").bind("click",function(e){e.preventDefault();var t=_SgmntfY_._getJq()(this),n=_SgmntfY_._getJq()("."+campaign.instanceId+".seg-form-survey"),a=n.find(".seg-form");checkValidity(a)&&(t.addClass("seg-sending"),t.css({"pointer-events":"none"}),setTimeout(function(){n.addClass("seg-popup-thanks").removeClass("segFadeInUp")},1300),setTimeout(function(){n.addClass("segFadeOutDown")},3e3),setTimeout(function(){n.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},6e3),a.length>0&&_SgmntfY_._variables.segmentifyObj("user:form",{formName:campaign.name,fields:a.sgmSerializeForm(),params:{instanceId:campaign.instanceId}}))});var checkValidity=function(e){try{e.find(".seg-form-invalid").removeClass("seg-form-invalid");for(var t=e.find("input,textarea"),n=!0,a=0;a<t.length;++a){var r=t[a],i=_SgmntfY_._getJq()(r);"checkbox"!==i.attr("type")&&(r.checkValidity()||("radio"===i.attr("type")?i.parent().addClass("seg-form-invalid"):i.addClass("seg-form-invalid"),n=!1))}var s=e.find('input[type="checkbox"]'),o=[];s.each(function(){-1==o.indexOf(this.name)&&o.push(this.name)});for(var c=0;c<o.length;++c)e.find('input[name="'+o[c]+'"]:required').length>0&&0==e.find('input[name="'+o[c]+'"]:checked').length&&(e.find('input[name="'+o[c]+'"]').parent().addClass("seg-form-invalid"),n=!1);return n}catch(e){return!0}}},POPUP_BANNER:function(campaign,request){var config={title:campaign.title,image:campaign.image,url:campaign.url,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}"true"===campaign.overlay&&_SgmntfY_._getJq()(".seg-popup-overlay").show(),_SgmntfY_._getJq()(".seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"close",instanceId:campaign.instanceId,interactionId:campaign.instanceId})}),_SgmntfY_._getJq()(".seg-banner-container-v2 img").bind("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:campaign.instanceId,interactionId:campaign.instanceId})}),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId})},PERSONA_QUIZ:function(e,t){if(void 0!==e){var n=_SgmntfY_._getJq(),a=_SgmntfY_._getMustache(),r=_SgmntfY_._variables.segmentifyObj,i=_SgmntfY_.LOG_MESSAGE,s={quizTitle:e.quizTitle,responses:e.responses,resultButton:e.resultButton,vertical:e.verticalPosition,horizontal:e.horizontalPosition,instanceId:e.instanceId,onlyOneSelected:e.onlyOneSelected};if(!0===e.hasOwnProperty("preJs"))try{var o=Function('"use strict";return ('.concat(e.preJs,")"))()(s);if(void 0!==o&&!o)return void i("WARN","preRenderConf returned false exiting!")}catch(e){i("WARN","Error in executing campaign pre js code: ".concat(e))}if(!0===e.hasOwnProperty("html")){var c=a.render(e.html,s),g=document.createElement("div");g.innerHTML=c,document.body.appendChild(g)}if(!0===e.hasOwnProperty("css")){var _=document.createElement("style");_.innerHTML=e.css,document.head.appendChild(_)}var m=function(t,n){var a=t.instanceId,r=t.onlyOneSelected,i=t.successTimeout||5e3,s=document.querySelectorAll(".seg-my-persona-".concat(a," .seg-persona-item")),o=document.querySelector(".seg-my-persona-".concat(a," .seg-persona-submit--button")),c=document.querySelectorAll(".seg-my-persona-".concat(a," .seg-persona-item .seg-persona-item--checkbox")),g=document.querySelector(".seg-my-persona-".concat(a)),_=document.getElementById("seg-my-persona-".concat(a,"--close"));if(null===s||null===o||null===c||null===g||null===_)return!1;var m=function(e){var t=e.currentTarget,n=t.querySelector(".seg-persona-item--checkbox");return!0===r&&(c.forEach(function(e){e.classList.remove("selected")}),s.forEach(function(e){e.classList.remove("selected")})),n.classList.contains("selected")?(t.querySelector(".seg-persona-item--checkbox").classList.remove("selected"),t.classList.remove("selected")):(t.querySelector(".seg-persona-item--checkbox").classList.add("selected"),t.classList.add("selected")),!0};s.forEach(function(e){e.addEventListener("click",m)}),o.addEventListener("click",function(){const t=[];c.forEach(function(e){!1!==e.classList.contains("selected")&&t.push({segmentName:e.getAttribute("segment-name"),segmentId:e.getAttribute("segment-id")})}),0===t.length?g.classList.add("seg-persona-error"):(g.classList.remove("seg-persona-error"),g.classList.add("seg-persona-success"),setTimeout(function(){_.click()},i),n("select:persona",{answers:t,instanceId:e.instanceId}))})}(s,r);if(void 0!==m&&!1===m&&i("WARN","Persona Quiz logic returned false, please checkout the required elements!"),!0===e.hasOwnProperty("postJs"))try{Function('"use strict";return ('.concat(e.postJs,")"))()}catch(e){i("WARN","Error in executing campaign post js code: ".concat(e))}"true"===e.overlay&&n(".seg-popup-overlay").show(),n(".seg-popup-close").bind("click",function(){var t=n(this);t.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){t.parent(".seg-popup").remove(),n(".seg-popup-overlay").remove()},1e3),r("event:interaction",{type:"close",instanceId:e.instanceId,interactionId:e.instanceId})}),r("event:interaction",{type:"impression",instanceId:e.instanceId,interactionId:e.instanceId})}},NOTIFICATION_BAR:function(campaign,request){var config={title:campaign.title,image:campaign.image,bgColor:campaign.bgColor,textColor:campaign.textColor,url:campaign.url,instanceId:campaign.instanceId,divClass:"sgf-notif-bar-"+(campaign.verticalPosition||"top")};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}_SgmntfY_.LOG_MESSAGE("DEBUG","Notification Bar appended to html body for campaign("+campaign.instanceId+")"),"true"===campaign.sticky&&(_SgmntfY_._getJq()(".seg-notification-bar").addClass("seg-notification-bar-sticky"),_SgmntfY_._getJq()(".seg-notification-bar-sticky:not([data-loaded])").each(function(){var e=_SgmntfY_._getJq()(this);if(e.attr("data-loaded","true"),e.find("img").length){var t=e.find("img:first"),n=t.attr("src")||t.attr("data-src");t.on("load",function(){var e=_SgmntfY_._getJq()(this).parents(".seg-notification-bar:first"),t=parseInt(_SgmntfY_._getJq()("body").css("padding-top").replace("px","")),n=parseInt(_SgmntfY_._getJq()("body").css("padding-bottom").replace("px",""));e.hasClass("sgf-notif-bar-top")?t+=e.height():e.hasClass("sgf-notif-bar-bottom")&&(n+=e.height()),_SgmntfY_._getJq()("body").css("padding-top",t).css("padding-bottom",n)}),t[0].src=n}})),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),_SgmntfY_._getJq()(".seg-notification-bar-v2-"+campaign.instanceId).length?_SgmntfY_._getJq()(".seg-notification-bar-v2-"+campaign.instanceId).bind("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:campaign.instanceId,interactionId:campaign.instanceId})}):_SgmntfY_._getJq()(".sgf-link").bind("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:campaign.instanceId,interactionId:campaign.instanceId})})},PUSH_PERMISSION:function(campaign,request){var config={title:campaign.title,text:campaign.text,icon:campaign.icon,buttonLaterText:campaign.buttonLaterText,buttonAllowText:campaign.buttonAllowText,safariEnabled:campaign.safariEnabled,swPath:campaign.serviceWorkerPath,twoStepEnabled:campaign.twoStepEnabled};window.location.origin.indexOf("www")>0&&config.swPath.indexOf("www")<0?config.swPath=config.swPath.replace("https://","https://www."):window.location.origin.indexOf("www")<0&&config.swPath.indexOf("www")>0&&(config.swPath=config.swPath.replace("https://www.","https://"));try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}try{var _pushPermissionKey=_SgmntfY_._getPersistentData(_SgmntfY_._variables.pushPermissionKey),exdays=-1,frequency=campaign.frequency;if(frequency&&("SESSION"===frequency.type?exdays=0:"LIFETIME"===frequency.type?exdays=390:"DAYS"===frequency.type&&(exdays=frequency.param)),_SgmntfY_._storePersistentData(_SgmntfY_._variables.pushPermissionKey,"true",exdays),_SgmntfY_._isNotEmpty(_pushPermissionKey)&&"true"===_pushPermissionKey)return}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while checking campaign frequency:"+e),_SgmntfY_._storePersistentData(_SgmntfY_._variables.pushPermissionKey,"true",0)}try{campaign.postJs&&eval(campaign.postJs),/OPR/i.test(navigator.userAgent)?_SgmntfY_._variables.pushInfo.agent="Opera":/YaBrowser/i.test(navigator.userAgent)||/Yowser/i.test(navigator.userAgent)?_SgmntfY_._variables.pushInfo.agent="Yandex":/SamsungBrowser/i.test(navigator.userAgent)?_SgmntfY_._variables.pushInfo.agent="Samsung":/ucbrowser/i.test(navigator.userAgent)?_SgmntfY_._variables.pushInfo.agent="UCBrowser":/Chrome/i.test(navigator.userAgent)?_SgmntfY_._variables.pushInfo.agent="Chrome":/Firefox/i.test(navigator.userAgent)&&(_SgmntfY_._variables.pushInfo.agent="Firefox"),"safari"in window&&"pushNotification"in window.safari&&(_SgmntfY_._variables.pushInfo.agent="Safari"),"Chrome"!==_SgmntfY_._variables.pushInfo.agent&&"Opera"!==_SgmntfY_._variables.pushInfo.agent&&"Yandex"!==_SgmntfY_._variables.pushInfo.agent&&"Samsung"!==_SgmntfY_._variables.pushInfo.agent&&"UCBrowser"!==_SgmntfY_._variables.pushInfo.agent&&"Firefox"!==_SgmntfY_._variables.pushInfo.agent||(_SgmntfY_._variables.pushInfo.isFirebaseCompatible=!0),"Safari"!==_SgmntfY_._variables.pushInfo.agent&&"Firebase"===_SgmntfY_._variables.pushInfo.permissionMethod&&_SgmntfY_._variables.pushInfo.isFirebaseCompatible&&_SgmntfY_._getJq().getScript(_SgmntfY_._variables.pushInfo.firebase.scriptUrl,function(){_SgmntfY_._variables.pushInfo.isFirebaseCompatible&&(firebase.apps.length||firebase.initializeApp({apiKey:_SgmntfY_._variables.pushInfo.firebase.apiKey,messagingSenderId:_SgmntfY_._variables.pushInfo.firebase.messagingSenderId}),_SgmntfY_._variables.pushInfo.messaging=firebase.messaging()),"serviceWorker"in navigator&&navigator.serviceWorker.register(config.swPath,{updateViaCache:"none"}).then(function(e){_SgmntfY_._variables.pushInfo.isFirebaseCompatible&&firebase.messaging().useServiceWorker(e),_SgmntfY_._variables.pushInfo.serviceWorkerReg=e,_SgmntfY_._pushInitPermissionCampaign(campaign,config)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while registering service worker "+e)})}),"Safari"===_SgmntfY_._variables.pushInfo.agent&&_SgmntfY_._pushInitPermissionCampaign(campaign,config),"Safari"!==_SgmntfY_._variables.pushInfo.agent&&"Vapid"===_SgmntfY_._variables.pushInfo.permissionMethod&&"serviceWorker"in navigator&&navigator.serviceWorker.register(config.swPath,{updateViaCache:"none"}).then(function(e){_SgmntfY_._variables.pushInfo.serviceWorkerReg=e,_SgmntfY_._pushInitPermissionCampaign(campaign,config)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while registering service worker in vapid method"+e)})}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while executing PUSH_PERMISSION campaign "+e)}},HERO_BANNER:function(campaign){var config={title:campaign.title,url:campaign.url,image:campaign.image,instanceId:campaign.instanceId},_instanceId=campaign.instanceId,wvCB=function(e){var t=!1;if(!t&&_SgmntfY_._isElemVisible(e))_SgmntfY_._interaction("widget-view",_instanceId,_instanceId),t=!0;else if(!t)var n=setInterval(function(){!t&&_SgmntfY_._isElemVisible(e)&&(_SgmntfY_._interaction("widget-view",_instanceId,_instanceId),t=!0,window.clearInterval(n))},100)};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);try{var _target=campaign.targetSelector,targetElement=_SgmntfY_._getJq()(_target).first(),_targetPosition=campaign.targetPosition;if("SELF"===_targetPosition)targetElement.html(renderedHtml),wvCB&&wvCB(targetElement);else{var $div=_SgmntfY_._getJq()("<div/>",{class:"seg-hero-banner-wrapper seg-clear"});"AFTER"===_targetPosition||"BEFORE"===_targetPosition?"AFTER"===_targetPosition?$div.html(renderedHtml).insertAfter(targetElement):$div.html(renderedHtml).insertBefore(targetElement):"APPEND"!==_targetPosition&&"PREPEND"!==_targetPosition||("APPEND"===_targetPosition?$div.html(renderedHtml).appendTo(targetElement):$div.html(renderedHtml).prependTo(targetElement)),wvCB&&wvCB($div)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling target element ["+_target+"] for banner: "+e)}campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}_SgmntfY_.LOG_MESSAGE("DEBUG","Hero Banner inserted to html for campaign("+_instanceId+")"),_SgmntfY_._interaction("impression",_instanceId,_instanceId),_SgmntfY_._getJq()(".seg-hero-banner-link-"+_instanceId).length&&_SgmntfY_._getJq()(".seg-hero-banner-link-"+_instanceId).bind("click",function(){_SgmntfY_._interaction("click",_instanceId,_instanceId)})},ADDED_TO_BASKET:function(campaign){var config={instanceId:campaign.instanceId,campaignMessage:campaign.campaignMessage,bgColor:campaign.bgColor,textColor:campaign.textColor,vertical:campaign.verticalPosition,iconUrl:campaign.iconUrl,horizontal:campaign.horizontalPosition,fadeOut:campaign.fadeOut,runFadeOut:!0};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}void 0!==config.fadeOut&&0!==config.fadeOut||(config.fadeOut=1,config.runFadeOut=!1)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}if(_SgmntfY_.LOG_MESSAGE("DEBUG","AddedToBasket appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),!1===config.runFadeOut)_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(this);window.setTimeout(function(){e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)});else{var $this=_SgmntfY_._getJq()(_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId));window.setTimeout(function(){$this.removeClass("segFadeInUp").addClass("segFadeOutDown"),$this.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)}_SgmntfY_._getJq()(".seg-social-proof-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId);e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()})},LAST_BOUGHT_TIME:function(campaign){var config={instanceId:campaign.instanceId,campaignMessage:campaign.campaignMessage,bgColor:campaign.bgColor,textColor:campaign.textColor,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition,iconUrl:campaign.iconUrl,fadeOut:campaign.fadeOut,runFadeOut:!0};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}void 0!==config.fadeOut&&0!==config.fadeOut||(config.fadeOut=1,config.runFadeOut=!1)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}if(_SgmntfY_.LOG_MESSAGE("DEBUG","LastBoughtTime appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),!1===config.runFadeOut)_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(this);window.setTimeout(function(){e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)});else{var $this=_SgmntfY_._getJq()(_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId));window.setTimeout(function(){$this.removeClass("segFadeInUp").addClass("segFadeOutDown"),$this.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)}_SgmntfY_._getJq()(".seg-social-proof-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId);e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()})},PRODUCT_PURCHASE_COUNTER:function(campaign){var config={instanceId:campaign.instanceId,campaignMessage:campaign.campaignMessage,bgColor:campaign.bgColor,textColor:campaign.textColor,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition,iconUrl:campaign.iconUrl,fadeOut:campaign.fadeOut,runFadeOut:!0};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}void 0!==config.fadeOut&&0!==config.fadeOut||(config.fadeOut=1,config.runFadeOut=!1)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}if(_SgmntfY_.LOG_MESSAGE("DEBUG","ProductPurchaseCounter appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),!1===config.runFadeOut)_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(this);window.setTimeout(function(){e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)});else{var $this=_SgmntfY_._getJq()(_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId));window.setTimeout(function(){$this.removeClass("segFadeInUp").addClass("segFadeOutDown"),$this.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)}_SgmntfY_._getJq()(".seg-social-proof-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId);e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()})},PRODUCT_VIEW_COUNTER:function(campaign){var config={instanceId:campaign.instanceId,campaignMessage:campaign.campaignMessage,bgColor:campaign.bgColor,textColor:campaign.textColor,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition,iconUrl:campaign.iconUrl,fadeOut:campaign.fadeOut,runFadeOut:!0};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}void 0!==config.fadeOut&&0!==config.fadeOut||(config.fadeOut=1,config.runFadeOut=!1)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}if(_SgmntfY_.LOG_MESSAGE("DEBUG","ProductViewCounter appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),!1===config.runFadeOut)_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(this);window.setTimeout(function(){e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)});else{var $this=_SgmntfY_._getJq()(_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId));window.setTimeout(function(){$this.removeClass("segFadeInUp").addClass("segFadeOutDown"),$this.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)}_SgmntfY_._getJq()(".seg-social-proof-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId);e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()})},SAVING_OVER:function(campaign){var config={instanceId:campaign.instanceId,campaignMessage:campaign.campaignMessage,bgColor:campaign.bgColor,textColor:campaign.textColor,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition,iconUrl:campaign.iconUrl,fadeOut:campaign.fadeOut,runFadeOut:!0};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}void 0!==config.fadeOut&&0!==config.fadeOut||(config.fadeOut=1,config.runFadeOut=!1)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}if(_SgmntfY_.LOG_MESSAGE("DEBUG","SavingOver appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),!1===config.runFadeOut)_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(this);window.setTimeout(function(){e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)});else{var $this=_SgmntfY_._getJq()(_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId));window.setTimeout(function(){$this.removeClass("segFadeInUp").addClass("segFadeOutDown"),$this.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)}_SgmntfY_._getJq()(".seg-social-proof-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId);e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()})},SCORE_AND_REVIEW:function(campaign){var config={instanceId:campaign.instanceId,campaignMessage:campaign.campaignMessage,bgColor:campaign.bgColor,textColor:campaign.textColor,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition,iconUrl:campaign.iconUrl,fadeOut:campaign.fadeOut,runFadeOut:!0};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}void 0!==config.fadeOut&&0!==config.fadeOut||(config.fadeOut=1,config.runFadeOut=!1)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}if(_SgmntfY_.LOG_MESSAGE("DEBUG","ScoreAndReview appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),!1===config.runFadeOut)_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(this);window.setTimeout(function(){e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)});else{var $this=_SgmntfY_._getJq()(_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId));window.setTimeout(function(){$this.removeClass("segFadeInUp").addClass("segFadeOutDown"),$this.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)}_SgmntfY_._getJq()(".seg-social-proof-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId);e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()})},STOCK_COUNT:function(campaign){var config={instanceId:campaign.instanceId,campaignMessage:campaign.campaignMessage,bgColor:campaign.bgColor,textColor:campaign.textColor,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition,iconUrl:campaign.iconUrl,fadeOut:campaign.fadeOut,runFadeOut:!0};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}void 0!==config.fadeOut&&0!==config.fadeOut||(config.fadeOut=1,config.runFadeOut=!1)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}if(_SgmntfY_.LOG_MESSAGE("DEBUG","StockCount appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),!1===config.runFadeOut)_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(this);window.setTimeout(function(){e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)});else{var $this=_SgmntfY_._getJq()(_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId));window.setTimeout(function(){$this.removeClass("segFadeInUp").addClass("segFadeOutDown"),$this.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)}_SgmntfY_._getJq()(".seg-social-proof-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId);e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()})},PREVIOUSLY_ADDED_TO_BASKET:function(campaign){var config={instanceId:campaign.instanceId,campaignMessage:campaign.campaignMessage,bgColor:campaign.bgColor,textColor:campaign.textColor,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition,iconUrl:campaign.iconUrl,fadeOut:campaign.fadeOut,runFadeOut:!0};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}void 0!==config.fadeOut&&0!==config.fadeOut||(config.fadeOut=1,config.runFadeOut=!1)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}if(_SgmntfY_.LOG_MESSAGE("DEBUG","PreviouslyAddedToBasket appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),!1===config.runFadeOut)_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(this);window.setTimeout(function(){e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)});else{var $this=_SgmntfY_._getJq()(_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId));window.setTimeout(function(){$this.removeClass("segFadeInUp").addClass("segFadeOutDown"),$this.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)}_SgmntfY_._getJq()(".seg-social-proof-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId);e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()})},LAST_VISIT_TIME:function(campaign){var config={instanceId:campaign.instanceId,campaignMessage:campaign.campaignMessage,bgColor:campaign.bgColor,textColor:campaign.textColor,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition,iconUrl:campaign.iconUrl,fadeOut:campaign.fadeOut,runFadeOut:!0};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}void 0!==config.fadeOut&&0!==config.fadeOut||(config.fadeOut=1,config.runFadeOut=!1)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}if(_SgmntfY_.LOG_MESSAGE("DEBUG","LastVisitTime appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),!1===config.runFadeOut)_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(this);window.setTimeout(function(){e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)});else{var $this=_SgmntfY_._getJq()(_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId));window.setTimeout(function(){$this.removeClass("segFadeInUp").addClass("segFadeOutDown"),$this.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)}_SgmntfY_._getJq()(".seg-social-proof-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId);e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()})},FAVORITE_ACTIVITY:function(campaign){var config={instanceId:campaign.instanceId,campaignMessage:campaign.campaignMessage,bgColor:campaign.bgColor,textColor:campaign.textColor,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition,iconUrl:campaign.iconUrl,fadeOut:campaign.fadeOut,runFadeOut:!0};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}void 0!==config.fadeOut&&0!==config.fadeOut||(config.fadeOut=1,config.runFadeOut=!1)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}if(_SgmntfY_.LOG_MESSAGE("DEBUG","FavoriteActivity appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),!1===config.runFadeOut)_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(this);window.setTimeout(function(){e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)});else{var $this=_SgmntfY_._getJq()(_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId));window.setTimeout(function(){$this.removeClass("segFadeInUp").addClass("segFadeOutDown"),$this.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3*config.fadeOut)}_SgmntfY_._getJq()(".seg-social-proof-close-"+config.instanceId).bind("click",function(){var e=_SgmntfY_._getJq()(".seg-social-proof-popup-close-"+config.instanceId);e.removeClass("segFadeInUp").addClass("segFadeOutDown"),e.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()})},SEE_ALL:function(campaign){var config={instanceId:campaign.instanceId,buttonText:campaign.buttonText,buttonUrl:campaign.buttonUrl,bgColor:campaign.bgColor,textColor:campaign.textColor},_instanceId=campaign.instanceId,wvCB=function(e){var t=!1;if(!t&&_SgmntfY_._isElemVisible(e))_SgmntfY_._interaction("widget-view",_instanceId,_instanceId),t=!0;else if(!t)var n=setInterval(function(){!t&&_SgmntfY_._isElemVisible(e)&&(_SgmntfY_._interaction("widget-view",_instanceId,_instanceId),t=!0,window.clearInterval(n))},100)};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);try{var _target=campaign.targetSelector,targetElement=_SgmntfY_._getJq()(_target).first(),_targetPosition=campaign.targetPosition;if("SELF"===_targetPosition)targetElement.html(renderedHtml),wvCB&&wvCB(targetElement);else{var $div=_SgmntfY_._getJq()("<div/>",{class:"sgm-see-all-button-wrapper seg-clear"});"AFTER"===_targetPosition||"BEFORE"===_targetPosition?"AFTER"===_targetPosition?$div.html(renderedHtml).insertAfter(targetElement):$div.html(renderedHtml).insertBefore(targetElement):"APPEND"!==_targetPosition&&"PREPEND"!==_targetPosition||("APPEND"===_targetPosition?$div.html(renderedHtml).appendTo(targetElement):$div.html(renderedHtml).prependTo(targetElement)),wvCB&&wvCB($div)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling target element ["+_target+"] for banner: "+e)}campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}_SgmntfY_.LOG_MESSAGE("DEBUG","SeeAll campaign inserted to html for campaign("+_instanceId+")"),_SgmntfY_._interaction("impression",_instanceId,_instanceId),_SgmntfY_._getJq()(".seg-see-all-link-"+_instanceId).length&&_SgmntfY_._getJq()(".seg-see-all-link-"+_instanceId).bind("click",function(){location.href=config.buttonUrl})},WHEEL_OF_FORTUNE:function(campaign){var config={slices:campaign.possibleRewards,reward:campaign.reward,instanceId:campaign.instanceId,wofBackGroundImg:campaign.bgImage,wofHeader:campaign.campaignTitle,wofModalHeader:campaign.resultTitle,pointerColor:campaign.pointerColor,wheelBaseColor:campaign.baseColor,pointerImage:campaign.pointerImage,contentOfButton:campaign.ctaButtonContent,contentButtonColor:campaign.ctaButtonColor,contentButtonTextColor:campaign.ctaButtonTextColor,overlay:campaign.overlay};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}function getScreenWidth(){return window.innerWidth}_SgmntfY_.LOG_MESSAGE("DEBUG","FavoriteActivity appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId});var slicesLength=config.slices.length,wofHeader=document.querySelector(".seg-wof-header"),elSpin=document.querySelector(".seg-wof-content-of-button"),wheelBaseRectangle=document.querySelector("#seg-wheel-base-circle"),wheelBaseCircle=document.querySelector("#seg-wheel-circle"),wheelPointer=document.querySelector("#seg-wof-pointer-svg"),wheelCenterPointImg=document.querySelector(".seg-wof-center-point-image"),contentOfButton=document.querySelector(".seg-wof-content-of-button"),overlay=document.querySelector(".seg-drop-layout"),modalClose=document.querySelector(".seg-modal-bg .seg-wof-modal-close"),winModalClose=document.querySelector(".seg-wof-win-bg .seg-wof-modal-close"),wheelBg=document.querySelector(".seg-modal-bg"),winModalBackGround=document.querySelector(".seg-wof-win-bg"),winModalHeader=document.querySelector(".seg-wof-win-bg .seg-wof-header"),windDescription=document.querySelector(".seg-wof-win-description"),winCoupon=document.querySelectorAll(".seg-wof-win-coupon"),anchorButton=document.querySelector(".seg-wof-win-description-button"),couponBtn=document.querySelectorAll(".seg-wof-copy-coupon"),btnCouponInitialState=document.querySelectorAll(".seg-copy-btn-initial-state"),btnCouponFinalState=document.querySelectorAll(".seg-copy-btn-final-state"),couponReady=document.querySelector(".seg-coupon-ready-icon"),couponReadyIcon=document.querySelector(".seg-coupon-ready-icon"),couponReadyModal=document.querySelector(".seg-coupon-ready-modal"),couponReadyContainer=document.querySelector(".seg-coupon-ready-container"),couponReadyCloseIcon=document.querySelector(".seg-arrow-close-icon"),segCouponReadyHeader=document.querySelector(".seg-coupon-ready-header"),couponReadyContent=document.querySelector(".seg-coupon-ready-header-content"),pointerImageContainer=document.querySelector(".seg-wof-icon"),wheelRotateContainer=document.querySelector(".sfy-wheel-container");function drawWheelBase(){document.body.classList.add("seg-overflow-lock"),overlay.style["background-color"]="true"===config.overlay?"rgba(53,44,44,0.8)":"transparent",wheelBg.style.backgroundImage=`url(${config.wofBackGroundImg})`,wofHeader.innerHTML=config.wofHeader,wheelPointer.style.fill=config.pointerColor,wheelBaseRectangle.style.fill=config.wheelBaseColor,wheelBaseCircle.style.fill=config.wheelBaseColor,contentOfButton.innerHTML=config.contentOfButton,contentOfButton.setAttribute("style","background-color: "+config.contentButtonColor+"!important"),contentOfButton.style.color=config.contentButtonTextColor,config.pointerImage&&""!==config.pointerImage?wheelCenterPointImg.src=config.pointerImage:(wheelCenterPointImg.remove(),pointerImageContainer.style.backgroundColor=config.wheelBaseColor)}var PI=Math.PI,tot=slicesLength,TAU=2*PI,arc=TAU/tot,isSpinning=!1,isAccelerating=!1,freeSpinning=!0,finishDegree=0,isReadyToFinish=!1,differenceDegreeForFinish=2880,angleForOneSlice=360/slicesLength,userHasSpinWheelWonReward=config.reward.assignedToUser;function randomInRange(e,t){return Math.random()*(t-e)+e}function winHandler(){config.pointerImage||(wheelCenterPointImg.style.display="none"),wheelBg.remove(),wheelBg.style.display="none",winModalBackGround.style.backgroundImage=`url(${config.wofBackGroundImg})`,winModalBackGround.style.display="block",windDescription.innerHTML=config.reward.description,winModalHeader.innerHTML=config.wofModalHeader;for(var e=0;e<winCoupon.length;e++)winCoupon[e].value=config.reward.coupon;anchorButton.href=config.reward.couponUrl,_SgmntfY_._variables.segmentifyObj("gamification:wof",{type:"win",interactionId:config.instanceId,instanceId:config.instanceId,used:"true",record:config.reward}),anchorButton.addEventListener("click",function(){winModalBackGround.style.display="none"})}function degreesToRadians(e){return e*Math.PI/180}modalClose.addEventListener("click",function(e){_SgmntfY_._variables.segmentifyObj("gamification:wof",{type:"win",interactionId:config.instanceId,instanceId:config.instanceId,used:"false",record:config.reward}),document.body.classList.remove("seg-overflow-lock"),wheelBg.remove(),overlay.remove()}),winModalClose.addEventListener("click",function(e){winModalBackGround.style.display="none",overlay.style.display="none",couponReadyContainer.style.display="inline-flex",document.body.classList.remove("seg-overflow-lock")}),anchorButton.style.backgroundColor=config.contentButtonColor,couponReadyIcon.style.backgroundColor=config.contentButtonColor,segCouponReadyHeader.style.backgroundColor=config.contentButtonColor;for(var cp=0;cp<couponBtn.length;cp++)couponBtn[cp].style.backgroundColor=config.contentButtonColor,couponBtn[cp].addEventListener("click",function(e){document.body.classList.remove("seg-overflow-lock"),navigator.clipboard.writeText(config.reward.coupon);for(let e=0;e<btnCouponInitialState.length;e++)btnCouponInitialState[e].style.display="none",btnCouponFinalState[e].style.display="block";setTimeout(function(){for(let e=0;e<btnCouponInitialState.length;e++)btnCouponFinalState[e].style.display="none",btnCouponInitialState[e].style.display="block"},1e3)});function frame(){if(isSpinning){if(!isReadyToFinish){var e=randomInRange(2,angleForOneSlice-2);differenceDegreeForFinish+=e,finishDegree=-1*(config.reward.index*angleForOneSlice+differenceDegreeForFinish)}(isReadyToFinish=!0)&&(wheelRotateContainer.style.transition="none",wheelRotateContainer.style.transform="rotate(0deg)",wheelRotateContainer.style.transition="transform 5s ease-out 0s",wheelRotateContainer.style.transform=`rotate(${finishDegree}deg)`,isSpinning=!1,setTimeout(function(){winHandler()},6750))}}function wheelEngine(){frame(),requestAnimationFrame(wheelEngine)}elSpin.addEventListener("click",function(e){isSpinning||(isSpinning=!0,isAccelerating=!0,wheelRotateContainer.style.transition="transform 15s cubic-bezier(0.1, 0, 1, 1) 0s",wheelRotateContainer.style.transform="rotate(10800deg)",_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),setTimeout(function(){freeSpinning=!1},3e3))}),couponReadyIcon.addEventListener("click",function(e){getScreenWidth()<=600&&(couponReadyIcon.style.setProperty("display","none","important"),couponReadyContainer.top="15%",couponReadyContainer.style.marginLeft="-30px",couponReadyContent.innerHTML=config.reward.description),couponReadyModal.style.display="flex",couponReadyContent.innerHTML=config.reward.description}),couponReadyCloseIcon.addEventListener("click",function(e){getScreenWidth()<=600&&(couponReadyModal.style.display="none",couponReadyContainer.top="0%",couponReadyContainer.style.marginLeft="0px",couponReadyIcon.style.display="flex"),couponReadyModal.style.display="none",couponReadyIcon.style.display="flex"}),userHasSpinWheelWonReward?(overlay.style.display="none",couponReadyContainer.style.display="flex",couponReadyContent.innerHTML=config.reward.description,winCoupon[1].value=config.reward.coupon):(drawWheelBase(),wheelEngine())},POP_UP_BANNER_COUNTDOWN:function(campaign){var config={targetUrl:campaign.targetUrl,name:campaign.name,title:campaign.title,description:campaign.description,seperator:campaign.seperator,showOnWebsite:campaign.showOnWebsite,bgColor:campaign.bgColor,textColor:campaign.textColor,imageUrl:campaign.imageUrl,overlay:campaign.overlay,endDate:campaign.endDate,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}_SgmntfY_.LOG_MESSAGE("DEBUG","FavoriteActivity appended to html body for campaign("+campaign.instanceId+")"),config.overlay&&_SgmntfY_._getJq()(".seg-popup-overlay").show(),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),_SgmntfY_._getJq()(".seg-popup-countdown-close").bind("click",function(){window.clearInterval(popUpInterval);var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"close",instanceId:campaign.instanceId,interactionId:campaign.instanceId})}),_SgmntfY_._getJq()(".seg-banner-container-v2 img").bind("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:campaign.instanceId,interactionId:campaign.instanceId})});var mainElement=document.querySelector(".seg-countdown-timeWrapper");function createCountDownItem(e){var t;t="<div id="+e.type+' class="seg-flexCol-center '+e.activate+'CountdownP">\n<h3 style="color:'+config.textColor+'" id="seg-countdown-'+e.type+'n"></h3>\n<span style="color:'+config.textColor+'" id="seg-countdown-'+e.type+'t">'+e.text+'</span>\n</div>\n<h3 style="color:'+config.textColor+'" class="seg-countdown-seperator '+e.activate+'CountdownP">'+config.seperator+"</h3>",mainElement.innerHTML+=t}function countdownRenderer(e){e.forEach(e=>{createCountDownItem(e)}),Array.from(document.querySelectorAll(".trueCountdownP")).slice(-1)[0].style.display="none"}countdownRenderer(config.showOnWebsite);var popUpInterval=setInterval(function(){var e=document.querySelector("#seg-countdown-DAYn"),t=document.querySelector("#seg-countdown-HOURn"),n=document.querySelector("#seg-countdown-MINUTEn"),a=document.querySelector("#seg-countdown-SECONDn"),r=new Date(config.endDate)-new Date,i=Math.floor(r/1e3/60/60/24),s=Math.floor(r/1e3/60/60)%24,o=Math.floor(r/1e3/60)%60,c=Math.floor(r/1e3)%60;c<0?window.clearInterval(popUpInterval):(t.innerHTML=s<10?"0"+s:s,n.innerHTML=o<10?"0"+o:o,a.innerHTML=c<10?"0"+c:c,e.innerHTML=i)},1e3)},SCRATCH:function(campaign){var config={bgBgColor:campaign.bgBgColor,bgImage:campaign.bgImage,bgTextColor:campaign.bgTextColor,campaignTitle:campaign.campaignTitle,contentOfResultButton:campaign.contentOfResultButton,contentButtonColor:campaign.scratchTextColor,contentBgColor:campaign.scratchBgColor,reward:campaign.reward,overlay:campaign.overlay,instanceId:campaign.instanceId};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}_SgmntfY_.LOG_MESSAGE("DEBUG","Scratch modal appended to html body for scratch campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId,nextPage:"false"});var screenWidth=window.innerWidth;function getScreenWidth(){return screenWidth}var autoCloseModal={isTrue:!1,timing:5e3},scratchHeader=document.querySelector(".seg-scratch-header"),scratchDescription=document.querySelector(".seg-scratch-description"),scratchCanvas=document.getElementById("seg-scratch-canvas"),scratchContext=scratchCanvas.getContext("2d",{willReadFrequently:!0}),scratchOverlay=document.querySelector(".seg-scratch-drop-layout"),scratchCoupon=document.querySelector(".seg-scratch-coupon"),scratchContainer=document.querySelector(".seg-scratch-container"),modalClose=document.querySelector(".seg-scratch-modal-bg .seg-scratch-modal-close"),winModalClose=document.querySelector(".seg-scratch-win-bg .seg-scratch-modal-close"),scratchBg=document.querySelector(".seg-scratch-modal-bg"),winModalBackGround=document.querySelector(".seg-scratch-win-bg"),windDescription=document.querySelector(".seg-scratch-win-description"),winScratchHeader=document.querySelector(".seg-scratch-win-bg .seg-scratch-header"),winCoupon=document.querySelectorAll(".seg-scratch-win-coupon"),anchorButton=document.querySelector(".seg-scratch-win-description-button"),segScratch=document.querySelector(".seg-scratch-modal-bg .seg-scratch"),segWinScratch=document.querySelector(".seg-scratch-win-bg .seg-scratch"),couponBtn=document.querySelectorAll(".seg-scratch-copy-coupon"),btnCouponInitialState=document.querySelectorAll(".seg-copy-btn-initial-state"),btnCouponFinalState=document.querySelectorAll(".seg-copy-btn-final-state"),couponReady=document.querySelector(".seg-coupon-ready-icon"),couponReadyIcon=document.querySelector(".seg-coupon-ready-icon"),couponReadyModal=document.querySelector(".seg-coupon-ready-modal"),couponReadyContainer=document.querySelector(".seg-coupon-ready-container"),couponReadyCloseIcon=document.querySelector(".seg-arrow-close-icon"),couponReadyContent=document.querySelector(".seg-coupon-ready-header-content"),dynamicWidth=440,dynamicHeight=85;function getCanvasArea(){return dynamicHeight*dynamicWidth}function drawScratchBase(){var e;segScratch.style.backgroundImage=`url(${config.bgImage})`,segScratch.style["background-color"]=config.bgBgColor,segScratch.style.color=`${config.bgTextColor} !important`,scratchDescription.style.color=config.bgTextColor||"#989898",scratchHeader.style.color=config.bgTextColor||"black",scratchCoupon.style.color=config.bgTextColor||"black",scratchOverlay.style["background-color"]="true"===config.overlay?"rgba(53,44,44,0.8)":"transparent",scratchHeader.innerHTML=config.campaignTitle,scratchDescription.innerHTML="Scratch this area to see the coupon code.",scratchCoupon.innerHTML=config.reward.coupon,anchorButton.innerHTML=config.contentOfResultButton,anchorButton.style["background-color"]=config.contentBgColor,anchorButton.style.color=config.contentButtonColor,scratchContext.globalCompositeOperation="source-over",e=0;var t=scratchContext.createLinearGradient(100,0,0,0);t.addColorStop(0,"#B9B9B9"),t.addColorStop(1,"#E4E4E4"),scratchContext.fillStyle=t,scratchContext.fillRect(e,0,dynamicWidth,dynamicHeight)}function getMobileOffset(e){var t=e.target.getBoundingClientRect();return{offsetX:e.touches[0].clientX-window.pageXOffset-t.left,offsetY:e.touches[0].clientY-window.pageYOffset-t.top}}getScreenWidth()<=576?(scratchContext.canvas.width=300,dynamicWidth=300,scratchContext.canvas.height=50,dynamicHeight=50):(scratchContext.canvas.width=440,scratchContext.canvas.height=85);var PI=Math.PI,isDrag=!1,isEventSent=!1,couponHasBeenAssigned=config.reward.assignedToUser,isWinEventSent=!1,allMobileOffsets=null;function clearArc(e,t){scratchContext.globalCompositeOperation="destination-out",scratchContext.beginPath(),scratchContext.arc(e,t,15,0,2*PI,!1),scratchContext.fill()}scratchCanvas.addEventListener("mousedown",function(e){isDrag=!0,clearArc(e.offsetX,e.offsetY),judgeVisible(),isEventSent||(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:campaign.instanceId,interactionId:campaign.instanceId,nextPage:"false"}),isEventSent=!0)},!1),scratchCanvas.addEventListener("mousemove",function(e){isDrag&&(clearArc(e.offsetX,e.offsetY),judgeVisible())},!1),scratchCanvas.addEventListener("mouseup",function(e){isDrag=!1},!1),scratchCanvas.addEventListener("mouseleave",function(e){isDrag=!1},!1),scratchCanvas.addEventListener("touchstart",function(e){1===e.targetTouches.length&&(e.cancelable&&e.preventDefault(),allMobileOffsets=getMobileOffset(e),isDrag=!0,clearArc(allMobileOffsets.offsetX,allMobileOffsets.offsetY),judgeVisible())},!1),scratchCanvas.addEventListener("touchmove",function(e){isDrag&&1===e.targetTouches.length&&(e.cancelable&&e.preventDefault(),clearArc((allMobileOffsets=getMobileOffset(e)).offsetX,allMobileOffsets.offsetY),judgeVisible())},!1),scratchCanvas.addEventListener("touchend",function(e){isDrag=!1},!1);for(var cp=0;cp<couponBtn.length;cp++)couponBtn[cp].addEventListener("click",function(e){navigator.clipboard.writeText(config.reward.coupon);for(let e=0;e<btnCouponInitialState.length;e++)btnCouponInitialState[e].style.display="none",btnCouponFinalState[e].style.display="block";setTimeout(function(){for(let e=0;e<btnCouponInitialState.length;e++)btnCouponFinalState[e].style.display="none",btnCouponInitialState[e].style.display="block"},1e3)});function judgeVisible(){var e=.85;getScreenWidth()<=596&&(e=.7);var t,n,a=scratchContext.getImageData(0,0,dynamicWidth,dynamicHeight).data,r={};for(t=3,n=a.length;t<n;t+=4)r[a[t]]||(r[a[t]]=0),r[a[t]]++;r[255]<getCanvasArea()*e&&setTimeout(function(){winHandler()},5e3)}function winHandler(){scratchBg.style.display="none",winModalBackGround.style.display="block",segWinScratch.style.backgroundImage=`url(${config.bgImage})`,segWinScratch.style["background-color"]=config.bgBgColor,segWinScratch.style.color=`${config.bgTextColor} !important`,winScratchHeader.style.color=config.bgTextColor||"black",windDescription.style.color=config.bgTextColor||"black",windDescription.innerHTML=config.reward.description;for(var e=0;e<winCoupon.length;e++)winCoupon[e].value=config.reward.coupon,winCoupon[e].style.color=config.bgTextColor||"black";isWinEventSent||(_SgmntfY_._variables.segmentifyObj("gamification:scratch",{type:"win",interactionId:config.instanceId,instanceId:config.instanceId,used:"true",record:config.reward}),isWinEventSent=!0),anchorButton.href=config.reward.couponUrl,anchorButton.addEventListener("click",function(){winModalBackGround.style.display="none"}),autoCloseModal.isTrue&&setTimeout(function(){winModalBackGround.style.display="none"},autoCloseModal.timing)}modalClose.addEventListener("click",function(e){_SgmntfY_._variables.segmentifyObj("gamification:scratch",{type:"win",interactionId:campaign.instanceId,instanceId:campaign.instanceId,used:"false",record:config.reward}),scratchBg.style.display="none",scratchOverlay.style.display="none"}),winModalClose.addEventListener("click",function(e){winModalBackGround.style.display="none",scratchOverlay.style.display="none",couponReadyContainer.style.display="inline-flex"}),couponReadyIcon.addEventListener("click",function(e){getScreenWidth()<=576&&(couponReadyIcon.style.display="none",couponReadyModal.style.display="flex",couponReadyContainer.top="15%",couponReadyContainer.style.marginLeft="-30px",couponReadyContent.innerHTML=config.reward.description),couponReadyModal.style.display="flex",couponReadyContent.innerHTML=config.reward.description}),couponReadyCloseIcon.addEventListener("click",function(e){getScreenWidth()<=576&&(couponReadyModal.style.display="none",couponReadyContainer.top="0%",couponReadyContainer.style.marginLeft="0px",couponReadyIcon.style.display="flex"),couponReadyModal.style.display="none",couponReadyIcon.style.display="flex"}),couponHasBeenAssigned?(scratchOverlay.style.display="none",couponReadyContainer.style.display="flex",couponReadyContent.innerHTML=config.reward.description,winCoupon[1].value=config.reward.coupon):drawScratchBase()},HERO_BANNER_COUNTDOWN:function(campaign){var config={targetUrl:campaign.targetUrl,name:campaign.name,title:campaign.title,description:campaign.description,seperator:campaign.seperator,showOnWebsite:campaign.showOnWebsite,bgColor:campaign.bgColor,textColor:campaign.textColor,imageUrl:campaign.imageUrl,endDate:campaign.endDate,targetSelector:campaign.targetSelector,instanceId:campaign.instanceId,targetPosition:campaign.targetPosition},wvCB=function(e){var t=!1;if(!t&&_SgmntfY_._isElemVisible(e))_SgmntfY_._interaction("widget-view",config.instanceId,config.instanceId),t=!0;else if(!t)var n=setInterval(function(){!t&&_SgmntfY_._isElemVisible(e)&&(_SgmntfY_._interaction("widget-view",config.instanceId,config.instanceId),t=!0,window.clearInterval(n))},100)};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}try{var _target=campaign.targetSelector,targetElement=_SgmntfY_._getJq()(_target).first(),_targetPosition=campaign.targetPosition;if("SELF"===_targetPosition)targetElement.html(renderedHtml),wvCB&&wvCB(targetElement);else{var $div=_SgmntfY_._getJq()("<div/>",{class:"seg-hero-banner-wrapper seg-clear"});"AFTER"===_targetPosition||"BEFORE"===_targetPosition?"AFTER"===_targetPosition?$div.html(renderedHtml).insertAfter(targetElement):$div.html(renderedHtml).insertBefore(targetElement):"APPEND"!==_targetPosition&&"PREPEND"!==_targetPosition||("APPEND"===_targetPosition?$div.html(renderedHtml).appendTo(targetElement):$div.html(renderedHtml).prependTo(targetElement)),wvCB&&wvCB($div)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling target element ["+_target+"] for banner: "+e)}_SgmntfY_.LOG_MESSAGE("DEBUG","HeroBannerCountCown appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),_SgmntfY_._getJq()(".seg-banner-container-v2 img").bind("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:campaign.instanceId,interactionId:campaign.instanceId})});var mainElement=document.querySelector(".seg-countdown-timeWrapperH");function createCountDownItem(e){var t;t="<div id="+e.type+' class="seg-flexCol-center '+e.activate+'CountdownH">\n<h3 style="color:'+config.textColor+'" id="seg-countdown-'+e.type+'nhero"></h3>\n<span style="color:'+config.textColor+'" id="seg-countdown-'+e.type+'t">'+e.text+'</span>\n</div>\n<h3 style="color:'+config.textColor+'" class="seg-countdown-seperator '+e.activate+'CountdownH">'+config.seperator+"</h3>",mainElement.innerHTML+=t}function countdownRenderer(e){e.forEach(e=>{createCountDownItem(e)}),Array.from(document.querySelectorAll(".trueCountdownH")).slice(-1)[0].style.display="none"}countdownRenderer(config.showOnWebsite);var heroInterval=setInterval(function(){var e=document.querySelector("#seg-countdown-DAYnhero"),t=document.querySelector("#seg-countdown-HOURnhero"),n=document.querySelector("#seg-countdown-MINUTEnhero"),a=document.querySelector("#seg-countdown-SECONDnhero"),r=new Date(config.endDate)-new Date,i=Math.floor(r/1e3/60/60/24),s=Math.floor(r/1e3/60/60)%24,o=Math.floor(r/1e3/60)%60,c=Math.floor(r/1e3)%60;c<0?window.clearInterval(heroInterval):(t.innerHTML=s<10?"0"+s:s,n.innerHTML=o<10?"0"+o:o,a.innerHTML=c<10?"0"+c:c,e.innerHTML=i)},1e3)},NOTIFICATION_BAR_COUNTDOWN:function(campaign){var config={targetUrl:campaign.targetUrl,name:campaign.name,title:campaign.title,description:campaign.description,seperator:campaign.seperator,showOnWebsite:campaign.showOnWebsite,bgColor:campaign.bgColor,textColor:campaign.textColor,sticky:campaign.sticky,imageUrl:campaign.imageUrl,endDate:campaign.endDate,divClass:"sgf-notif-bar-"+(campaign.verticalPosition.toLowerCase()||"top")};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}_SgmntfY_.LOG_MESSAGE("DEBUG","NotificationBarCountDown appended to html body for campaign("+campaign.instanceId+")"),config.sticky&&_SgmntfY_._getJq()(".seg-notification-bar").addClass("seg-notification-bar-sticky"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),_SgmntfY_._getJq()(".seg-banner-container-v2 img").bind("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:campaign.instanceId,interactionId:campaign.instanceId})});var mainElement=document.querySelector(".seg-countdown-timeWrapperN");function createCountDownItem(e){var t;t="<div id="+e.type+' class="seg-flexCol-center '+e.activate+'CountdownN">\n<h3 style="color:'+config.textColor+'" id="seg-countdown-'+e.type+'ntf"></h3>\n<span style="color:'+config.textColor+'" id="seg-countdown-'+e.type+'t">'+e.text+'</span>\n</div>\n<h3 style="color:'+config.textColor+'" class="seg-countdown-seperator '+e.activate+'CountdownN">'+config.seperator+"</h3>",mainElement.innerHTML+=t}function countdownRenderer(e){e.forEach(e=>{createCountDownItem(e)}),Array.from(document.querySelectorAll(".trueCountdownN")).slice(-1)[0].style.display="none"}countdownRenderer(config.showOnWebsite);var ntfCountdownInterval=setInterval(function(){var e=document.querySelector("#seg-countdown-DAYntf"),t=document.querySelector("#seg-countdown-HOURntf"),n=document.querySelector("#seg-countdown-MINUTEntf"),a=document.querySelector("#seg-countdown-SECONDntf"),r=new Date(config.endDate)-new Date,i=Math.floor(r/1e3/60/60/24),s=Math.floor(r/1e3/60/60)%24,o=Math.floor(r/1e3/60)%60,c=Math.floor(r/1e3)%60;c<0?window.clearInterval(ntfCountdownInterval):(t.innerHTML=s<10?"0"+s:s,n.innerHTML=o<10?"0"+o:o,a.innerHTML=c<10?"0"+c:c,e.innerHTML=i)},1e3)}},_functions:{getFunction:function(e){switch(e.toLowerCase()){case"apikey":return _SgmntfY_._functions.setApiKey;case"loglevel":return _SgmntfY_._functions.setLogLevel;case"variables":return _SgmntfY_._functions.setVariables;case"userid":return _SgmntfY_._functions.setUserId;case"view:page":return _SgmntfY_._functions.pageView;case"view:product":return _SgmntfY_._functions.productView;case"basket:add":return _SgmntfY_._functions.addToBasket;case"basket:remove":return _SgmntfY_._functions.removeFromBasket;case"basket:clear":return _SgmntfY_._functions.clearBasket;case"checkout:basket":return _SgmntfY_._functions.checkoutViewBasket;case"checkout:customer":return _SgmntfY_._functions.checkoutCustomerInfo;case"checkout:payment":return _SgmntfY_._functions.checkoutPaymentInfo;case"checkout:purchase":return _SgmntfY_._functions.checkoutPurchase;case"user:signin":return _SgmntfY_._functions.userSignIn;case"user:signout":return _SgmntfY_._functions.userSignOut;case"user:signup":return _SgmntfY_._functions.userSignUp;case"user:subscribe":return _SgmntfY_._functions.userSubscribe;case"user:unsubscribe":return _SgmntfY_._functions.userUnsubscribe;case"user:update":return _SgmntfY_._functions.userInfoUpdate;case"user:iyspermissions":return _SgmntfY_._functions.userIysPermissions;case"user:lastsearchdeletedkeywords":return _SgmntfY_._functions.lastSearchDeletedKeywords;case"event:custom":return _SgmntfY_._functions.customEvent;case"event:interaction":return _SgmntfY_._functions.interaction;case"user:form":return _SgmntfY_._functions.userForm;case"banner:impression":return _SgmntfY_._functions.bannerImpression;case"banner:click":return _SgmntfY_._functions.bannerClick;case"banner:update":return _SgmntfY_._functions.bannerUpdate;case"bannergroup:view":return _SgmntfY_._functions.bannerGroupView;case"bannergroup:detail":return _SgmntfY_._functions.bannerGroupDetail;case"impression:promotion":return _SgmntfY_._functions.promotionImpression;case"view:promotion":return _SgmntfY_._functions.promotionView;case"push:click:interaction":return _SgmntfY_._functions.pushInteraction;case"search":case"search:instant":return _SgmntfY_._functions.search;case"search:faceted":return _SgmntfY_._functions.facetedSearch;case"filter":return _SgmntfY_._functions.filter;case"coupon":return _SgmntfY_._functions.coupon;case"email:click":return _SgmntfY_._functions.mailClickInteraction;case"ga:event":return _SgmntfY_.GA.sendEvent;case"journey:init":return _SgmntfY_._functions.initJourney;case"journey:success":return _SgmntfY_._functions.successJourney;case"journey:start":return _SgmntfY_._functions.startJourney;case"journey:view":return _SgmntfY_._functions.viewJourney;case"journey:select":return _SgmntfY_._functions.selectJourney;case"journey:exit":return _SgmntfY_._functions.exitJourney;case"journey:skip":return _SgmntfY_._functions.skipJourney;case"journey:finish":return _SgmntfY_._functions.finishJourney;case"favorite:add":return _SgmntfY_._functions.favoriteAdd;case"favorite:remove":return _SgmntfY_._functions.favoriteRemove;case"favorite:detail":return _SgmntfY_._functions.favoriteDetail;case"view:favorites":return _SgmntfY_._functions.favoritesView;case"select:persona":return _SgmntfY_._functions.personaSelect;case"gamification:wof":return _SgmntfY_._functions.wheelOfFortune;case"gamification:scratch":return _SgmntfY_._functions.scratch;default:return function(t){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Command: "+e)}}},getDataLayerFunction:function(e,t){try{switch(void 0===e&&(e=""),void 0===t&&(t={}),void 0===t.step&&(t.step=""),void 0===t.type&&(t.type=""),e.toLowerCase()){case"page":return _SgmntfY_._functions.pageView;case"product":return _SgmntfY_._functions.productView;case"basket":switch(t.step.toLowerCase()){case"add":return _SgmntfY_._functions.addToBasket;case"remove":return _SgmntfY_._functions.removeFromBasket;case"clear":return _SgmntfY_._functions.clearBasket;default:return function(e){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Basket Operations Step: "+e.step)}}case"checkout":switch(t.step.toLowerCase()){case"basket":return _SgmntfY_._functions.checkoutViewBasket;case"customer":return _SgmntfY_._functions.checkoutCustomerInfo;case"payment":return _SgmntfY_._functions.checkoutPaymentInfo;case"purchase":return _SgmntfY_._functions.checkoutPurchase;default:return function(e){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Checkout Step: "+e.step)}}case"user":switch(t.step.toLowerCase()){case"signin":return _SgmntfY_._functions.userSignIn;case"signout":return _SgmntfY_._functions.userSignOut;case"signup":return _SgmntfY_._functions.userSignUp;case"subscribe":return _SgmntfY_._functions.userSubscribe;case"unsubscribe":return _SgmntfY_._functions.userUnsubscribe;case"update":return _SgmntfY_._functions.userInfoUpdate;case"iyspermissions":return _SgmntfY_._functions.userIysPermissions;case"lastsearchdeletedkeywords":return _SgmntfY_._functions.lastSearchDeletedKeywords;default:return function(e){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected User Operations Step: "+e.step)}}case"interaction":return _SgmntfY_._functions.interaction;case"form":return _SgmntfY_._functions.userForm;case"banners":return _SgmntfY_._functions.bannerGroupView;case"banner":switch(t.type.toLowerCase()){case"impression":return _SgmntfY_._functions.bannerImpression;case"click":return _SgmntfY_._functions.bannerClick;case"update":return _SgmntfY_._functions.bannerUpdate;default:return function(e){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Banner Operations Type: "+e.type)}}case"custom":return _SgmntfY_._functions.customEvent;case"promotion":switch(t.type.toLowerCase()){case"impression":return _SgmntfY_._functions.promotionImpression;case"view":return _SgmntfY_._functions.promotionView;default:return function(e){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Promotion Type: "+e.type)}}default:return function(t){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Command: "+e)}}}catch(e){return function(){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Command: "+e)}}},callFunction:function(e){var t=[];e=e||[];for(var n=0;n<e.length;n++){var a=e[n],r=_SgmntfY_._functions.getFunction(a[0]),i=Array.prototype.slice.call(a,1);try{var s=r.apply(null,i);s&&(t=t.concat(s)),_SgmntfY_.LOG_MESSAGE("INFO","Event triggered: "+a[0])}catch(e){_SgmntfY_.LOG_MESSAGE("Error","Can't convert command("+a[0]+") into request data. Details: "+e)}}_SgmntfY_._sendRequestToServer(t)},setApiKey:function(e,t){if(_SgmntfY_._variables.apiKey=e,_SgmntfY_.LOG_MESSAGE("DEBUG","Api Key: "+e),t)_SgmntfY_.LOG_MESSAGE("INFO","Account specific style is disabled, skipping...");else{var n=_SgmntfY_._variables.segmentifyCDNUrl+e+"/segmentify.css";_SgmntfY_.LOG_MESSAGE("INFO","Loading account specific css file: "+n),_SgmntfY_._loadCSS(n)}_SgmntfY_._isNotEmpty(_SgmntfY_._variables.apiKey)&&(_SgmntfY_._consumeNextPageQueue(),_SgmntfY_._consumeRetryQueue()),_SgmntfY_._variables.ga.enabled&&_SgmntfY_.GA.activate()},setLogLevel:function(e){var t=_SgmntfY_.LOG_LEVELS[e];void 0!==t&&(_SgmntfY_._variables.logLevel=t,_SgmntfY_.LOG_MESSAGE("DEBUG","Segmentify Log Level Changed to: "+e))},setVariables:function(e){e=e||{},_SgmntfY_._extend(_SgmntfY_._variables,e),_SgmntfY_.LOG_MESSAGE("DEBUG","Segmentify Variables are updated - New Values: "+e)},setUserId:function(e,t){if(!0!==_SgmntfY_._variables.doNotTrack){var n=_SgmntfY_._getUserId();if(_SgmntfY_._storePersistentData(_SgmntfY_._variables.userStorageKey,e,390,_SgmntfY_._variables.storage.user.local),_SgmntfY_.LOG_MESSAGE("DEBUG","Segmentify User Id Changed to: "+e),!_SgmntfY_._isNotEmpty(t)||"true"!==t&&!0!==t){if(n!==e){var a={};return a.oldUserId=n||"",a.async="false",_SgmntfY_._prepareRequest(a,"USER_CHANGE")}}else _SgmntfY_.LOG_MESSAGE("DEBUG","Segmentify User Id Changed to: "+e+" without sending USER_CHANGE event.")}},pageView:function(e){return e=e||{},_SgmntfY_.GA.sendPageView(e.category||""),_SgmntfY_._prepareRequest(e,"PAGE_VIEW")},productView:function(e){if((e=e||{}).url=_SgmntfY_._clearProductUrl(e.url||document.URL),e.productUrl=e.productUrl||e.url||document.URL,"number"==typeof e.productId&&(e.productId=e.productId.toString()),"string"==typeof e.categories)if(-1!==e.categories.indexOf("|")){var t=e.categories.split("|");for(var n in e.categories=[],t)t.hasOwnProperty(n)&&e.categories.push(t[n].trim())}else e.categories=[e.categories];else for(var a in e.categories)e.categories.hasOwnProperty(a)&&"string"==typeof e.categories[a]&&(e.categories[a]=e.categories[a].trim());e.categories=(e.categories||[]).filter(_SgmntfY_._null),e.paramsList=e.paramsList||{},e.source="SOCIAL"===_SgmntfY_._sourceOfUrl().source?_SgmntfY_._sourceOfUrl().source:_SgmntfY_._sourceOfUrl(),e.subSource=_SgmntfY_._sourceOfUrl().subSource?_SgmntfY_._sourceOfUrl().subSource:null;var r=_SgmntfY_._getClickedBanners();if(r.length>0){var i=[];for(a=0;a<r.length;++a){var s=_SgmntfY_._split(r[a],":",4);4!==s.length||isNaN(parseInt(s[2]))||i.push({title:s[0],group:s[1],order:parseInt(s[2])})}e.activeBanners=i}return _SgmntfY_._variables.skipProductDetail.device.indexOf(_SgmntfY_._variables.ua.type)>=0&&(e.noUpdate=["all"]),_SgmntfY_._prepareRequest(e,"PRODUCT_VIEW")},addToBasket:function(e){(e=e||{}).step="add",e.async="false",e.quantity=e.quantity||1;var t=_SgmntfY_._getClickedBanners();if(t.length>0){for(var n=[],a=0;a<t.length;++a){var r=_SgmntfY_._split(t[a],":",4);4!==r.length||isNaN(parseInt(r[2]))||n.push({title:r[0],group:r[1],order:parseInt(r[2])})}e.activeBanners=n}return _SgmntfY_._variables.disableNextPage||void 0!==e.nextPage||(e.nextPage=!0),e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"BASKET_OPERATIONS")},removeFromBasket:function(e){return(e=e||{}).step="remove",e.async="false",_SgmntfY_._variables.disableNextPage||void 0!==e.nextPage||(e.nextPage=!0),e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"BASKET_OPERATIONS")},clearBasket:function(e){return(e=e||{}).step="clear",e.async="false",_SgmntfY_._variables.disableNextPage||void 0!==e.nextPage||(e.nextPage=!0),e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"BASKET_OPERATIONS")},checkoutViewBasket:function(e){if((e=e||{}).step="view-basket",e.hasOwnProperty("productList"))for(var t=0;t<e.productList.length;++t)e.productList[t].quantity=e.productList[t].quantity||1;return e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"CHECKOUT")},checkoutCustomerInfo:function(e){return(e=e||{}).step="customer-info",e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"CHECKOUT")},checkoutPaymentInfo:function(e){return(e=e||{}).step="payment-info",e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"CHECKOUT")},checkoutPurchase:function(e){if((e=e||{}).step="purchase",e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),e.hasOwnProperty("productList"))for(var t=0;t<e.productList.length;++t)e.productList[t].quantity=e.productList[t].quantity||1;var n=_SgmntfY_._getClickedBanners();if(n.length>0){for(var a=[],r=0;r<n.length;++r){var i=_SgmntfY_._split(n[r],":",4);4!==i.length||isNaN(parseInt(i[2]))||a.push({title:i[0],group:i[1],order:parseInt(i[2])})}e.activeBanners=a}return _SgmntfY_._prepareRequest(e,"CHECKOUT")},userSignIn:function(e){return(e=e||{}).step="signin",e.async="false",e.isLogin=!0,e.isRegistered=!0,!0===_SgmntfY_._variables.pa.loaded&&!1===_SgmntfY_._variables.pa.disabled&&(e.external=_SgmntfY_._variables.pa.data.output),_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userSignOut:function(e){return(e=e||{}).step="signout",e.async="false",e.isLogin=!1,!0===_SgmntfY_._variables.pa.loaded&&!1===_SgmntfY_._variables.pa.disabled&&(e.external=_SgmntfY_._variables.pa.data.output),_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userSignUp:function(e){return(e=e||{}).step="signup",e.async="false",e.isRegistered=!0,!0===_SgmntfY_._variables.pa.loaded&&!1===_SgmntfY_._variables.pa.disabled&&(e.external=_SgmntfY_._variables.pa.data.output),_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userSubscribe:function(e){return(e=e||{}).step="subscribe",e.async="false",!0===_SgmntfY_._variables.pa.loaded&&!1===_SgmntfY_._variables.pa.disabled&&(e.external=_SgmntfY_._variables.pa.data.output),_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userUnsubscribe:function(e){return(e=e||{}).step="unsubscribe",e.async="false",!0===_SgmntfY_._variables.pa.loaded&&!1===_SgmntfY_._variables.pa.disabled&&(e.external=_SgmntfY_._variables.pa.data.output),_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userInfoUpdate:function(e){(e=e||{}).step="update",e.async="false",void 0!==e.isLogin&&(e.isRegistered="true"===e.isLogin||!0===e.isLogin?"true":e.isRegistered),!0===_SgmntfY_._variables.pa.loaded&&!1===_SgmntfY_._variables.pa.disabled&&(e.external=_SgmntfY_._variables.pa.data.output);var t=JSON.stringify(e),n=_SgmntfY_._getPersistentData("sgfUserUpdateData",!0);if(void 0===n||t!==n)return _SgmntfY_._storePersistentData("sgfUserUpdateData",t,-1,!0),_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userIysPermissions:function(e){(e=e||{}).step="iyspermissions",e.async="false";var t="PC"===_SgmntfY_._variables.ua.type?"HS_WEB":"HS_MOBIL",n=(new Date).getTime();return e.userIysPermissions={emailIysReceiptType:"BIREYSEL",emailIysSource:t,emailIysAllowDate:n},_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},lastSearchDeletedKeywords:function(e){return(e=e||{}).step="delete_last_search",e.async="false",_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userForm:function(e){return(e=e||{}).async="false",_SgmntfY_._prepareRequest(e,"FORM")},customEvent:function(e){return e=e||{},_SgmntfY_._prepareRequest(e,"CUSTOM_EVENT")},search:function(e){var t=(e=e||{}).params||{};return t=_SgmntfY_._getSearchVerboseParams(t),e.params=t,e.type="instant",_SgmntfY_._prepareRequest(e,"SEARCH")},facetedSearch:function(e){var t=(e=e||{}).params||{};return t=_SgmntfY_._getSearchVerboseParams(t),e.params=t,e.type="faceted",_SgmntfY_._prepareRequest(e,"SEARCH")},interaction:function(e){return(e=e||{}).async="false",_SgmntfY_._variables.disableNextPage||void 0!==e.nextPage||(e.nextPage=!0),"impression"!==e.type&&"widget-view"!==e.type&&"push-permission-impression"!==e.type&&"push"!==e.type&&"email"!==e.type&&"slider:arrow:left"!==e.type&&"slider:arrow:right"!==e.type||(e.nextPage=!1),_SgmntfY_._prepareRequest(e,"INTERACTION")},bannerImpression:function(e){return(e=e||{}).async="false",e.type="impression",_SgmntfY_._prepareRequest(e,"BANNER_OPERATIONS")},bannerClick:function(e){return(e=e||{}).async="false",e.type="click",_SgmntfY_._variables.disableNextPage||void 0!==e.nextPage||(e.nextPage=!0),_SgmntfY_._addClickedBanner(e.title,e.group,e.order,e.url),_SgmntfY_._prepareRequest(e,"BANNER_OPERATIONS")},bannerUpdate:function(e){return(e=e||{}).async="false",e.type="update",_SgmntfY_._prepareRequest(e,"BANNER_OPERATIONS")},bannerGroupView:function(e){return e=e||{},_SgmntfY_._prepareRequest(e,"BANNER_GROUP_VIEW")},bannerGroupDetail:function(e){return(e=e||{}).async="false",_SgmntfY_._prepareRequest(e,"INTERNAL_BANNER_GROUP")},promotionImpression:function(e){return(e=e||{}).type="impression","string"==typeof e.categories&&(e.categories=[e.categories]),e.categories=(e.categories||[]).filter(_SgmntfY_._null),"string"==typeof e.brands&&(e.brands=[e.brands]),e.brands=(e.brands||[]).filter(_SgmntfY_._null),"string"==typeof e.labels&&(e.labels=[e.labels]),e.labels=(e.labels||[]).filter(_SgmntfY_._null),"string"==typeof e.productIds&&(e.productIds=[e.productIds]),e.productIds=(e.productIds||[]).filter(_SgmntfY_._null),_SgmntfY_._prepareRequest(e,"PROMOTION")},promotionView:function(e){return(e=e||{}).type="view","string"==typeof e.categories&&(e.categories=[e.categories]),e.categories=(e.categories||[]).filter(_SgmntfY_._null),"string"==typeof e.brands&&(e.brands=[e.brands]),e.brands=(e.brands||[]).filter(_SgmntfY_._null),"string"==typeof e.labels&&(e.labels=[e.labels]),e.labels=(e.labels||[]).filter(_SgmntfY_._null),"string"==typeof e.productIds&&(e.productIds=[e.productIds]),e.productIds=(e.productIds||[]).filter(_SgmntfY_._null),_SgmntfY_._prepareRequest(e,"PROMOTION")},pushInteraction:function(e){return(e=e||{}).async="false",e.nextPage="false",_SgmntfY_._storePersistentData(e.instanceId,"1",.006),_SgmntfY_.LOG_MESSAGE("DEBUG","Push campaign interaction is sent for campaign: "+e.instanceId),_SgmntfY_._prepareRequest(e,"INTERACTION")},filter:function(e){return(e=e||{}).categories=(e.categories||[]).filter(_SgmntfY_._null),e.brands=(e.brands||[]).filter(_SgmntfY_._null),e.sizes=(e.sizes||[]).filter(_SgmntfY_._null),e.prices=(e.prices||[]).filter(_SgmntfY_._null),_SgmntfY_._prepareRequest(e,"FILTER")},coupon:function(e){return(e=e||{}).nextPage="false",_SgmntfY_._prepareRequest(e,"COUPON")},mailClickInteraction:function(e){return(e=e||{}).async="false",e.nextPage="false",_SgmntfY_._storePersistentData(e.instanceId+"_email","1",.006),_SgmntfY_._prepareRequest(e,"INTERACTION")},initJourney:function(e){return(e=e||{}).type="INIT",_SgmntfY_._prepareRequest(e,"JOURNEY")},successJourney:function(e){return(e=e||{}).type="SUCCESS",_SgmntfY_._prepareRequest(e,"JOURNEY")},startJourney:function(e){return(e=e||{}).type="START",_SgmntfY_._prepareRequest(e,"JOURNEY")},viewJourney:function(e){return(e=e||{}).type="VIEW",_SgmntfY_._prepareRequest(e,"JOURNEY")},selectJourney:function(e){return(e=e||{}).type="SELECT",_SgmntfY_._prepareRequest(e,"JOURNEY")},exitJourney:function(e){return(e=e||{}).type="EXIT",_SgmntfY_._prepareRequest(e,"JOURNEY")},skipJourney:function(e){return(e=e||{}).type="SKIP",_SgmntfY_._prepareRequest(e,"JOURNEY")},finishJourney:function(e){return(e=e||{}).type="FINISH",_SgmntfY_._prepareRequest(e,"JOURNEY")},favoriteAdd:function(e){return(e=e||{}).async="false",e.step="add",_SgmntfY_._prepareRequest(e,"WISHLIST")},favoriteRemove:function(e){return(e=e||{}).async="false",e.step="remove",_SgmntfY_._prepareRequest(e,"WISHLIST")},favoriteDetail:function(e){return(e=e||{}).async="false",e.step="detail",_SgmntfY_._prepareRequest(e,"WISHLIST")},favoritesView:function(e){return(e=e||{}).async="false",e.step="view-favorites",_SgmntfY_._prepareRequest(e,"WISHLIST")},personaSelect:function(e){return e=e||{},_SgmntfY_._prepareRequest(e,"PERSONA_QUIZ")},wheelOfFortune:function(e){return(e=e||{}).used=e.used,e.record=e.record,e.nextPage="false",_SgmntfY_._prepareRequest(e,"GAMIFICATION")},scratch:function(e){return(e=e||{}).used=e.used,e.record=e.record,_SgmntfY_._prepareRequest(e,"GAMIFICATION")}},_bindRecommendationTrackEvents:function(e,t,n,a){if(!(a>10)){a+=1;var r=t&&t.sliderClick,i=r&&t.sliderClick.leftArrowSelector,s=r&&t.sliderClick.rightArrowSelector;if(i&&s){var o=e.find(i),c=e.find(s);0===o.length||0===c.length?setTimeout(_SgmntfY_._bindRecommendationTrackEvents,200,e,t,n,a):(o.on("click",function(){_SgmntfY_._sendSliderClick(n,"left")}),c.on("click",function(){_SgmntfY_._sendSliderClick(n,"right")}))}}},_sendSliderClick:function(e,t){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"slider:arrow:"+t,interactionId:"slider:arrow:"+t,instanceId:e}),_SgmntfY_.GA.sendArrowClick(e,t)},_prepareRequest:function(e,t,n){if(void 0===e.noSend||"true"!==e.noSend)if(_SgmntfY_._getJq()("html").hasClass("translated-ltr")||_SgmntfY_._getJq()("html").hasClass("translated-rtl"))_SgmntfY_.LOG_MESSAGE("DEBUG","Page is translated, ignoring event");else if(navigator&&navigator.language&&"c"===navigator.language)_SgmntfY_.LOG_MESSAGE("DEBUG","This is a bot, ignoring event");else if(_SgmntfY_._isEmpty(_SgmntfY_._variables.apiKey))_SgmntfY_.LOG_MESSAGE("ERROR","Api Key is not set, not sending event: "+t);else if(_SgmntfY_._isEmpty(_SgmntfY_._getUserId()))_SgmntfY_.LOG_MESSAGE("ERROR","userId is not set, not sending event: "+t);else{if(!_SgmntfY_._isEmpty(_SgmntfY_._getSessionId())){if(void 0===n&&(n=!1),!n&&"boolean"==typeof e.nextPage&&!0===e.nextPage)return _SgmntfY_._addToNextPageQueue({eventName:t,params:e}),null;var a=new Date,r={data:{name:t,userId:_SgmntfY_._getUserId(),sessionId:_SgmntfY_._getSessionId(),testMode:_SgmntfY_._getTestMode()||"false",device:_SgmntfY_._variables.ua.type||"PC",noProcess:e.noProcess||!1,tryCount:0,nextPage:e.nextPage||!1,dnt:_SgmntfY_._variables.doNotTrack,params:e.params||{},recommendIds:(e.recommendIds||[]).filter(_SgmntfY_._null),pageUrl:_SgmntfY_._getRequestParam(e.pageUrl,document.URL,!1),referrer:_SgmntfY_._getRequestParam(e.referrer,document.referrer,!1),browser:_SgmntfY_._getRequestParam(e.browser,_SgmntfY_._variables.ua.name,!1),os:_SgmntfY_._getRequestParam(e.os,_SgmntfY_._variables.ua.os,!1),osversion:_SgmntfY_._getRequestParam(e.osversion,_SgmntfY_._variables.ua.osversion,!1),userAgent:_SgmntfY_._getRequestParam(e.userAgent,_SgmntfY_._variables.ua.agentString,!1),lang:_SgmntfY_._getRequestParam(e.lang,_SgmntfY_._variables.language,!0),currency:_SgmntfY_._getRequestParam(e.currency,_SgmntfY_._variables.currency,!0),region:_SgmntfY_._getRequestParam(e.region,_SgmntfY_._variables.region,!0),async:e.async||"true",globalMode:_SgmntfY_._getControlGroup(),experiments:_SgmntfY_._experiment.init()||{},email:e.email||"",ft:_SgmntfY_._getFireTime(a)||"",tz:_SgmntfY_._getTimeZone(a)||""},originalParams:e,eventName:t};e.hasOwnProperty("bypassControlGroup")&&(r.data.bypassControlGroup=!0===e.bypassControlGroup),"function"==typeof e.recommendationCallback&&_SgmntfY_._getJq().extend(r,{recommendationCallback:e.recommendationCallback}),"function"==typeof e._cb&&_SgmntfY_._getJq().extend(r,{_cb:e._cb});for(var i=_SgmntfY_._variables.requiredParams[t],s=0;s<i.length;++s){if(!_SgmntfY_._isNotEmpty(e[i[s]]))return void _SgmntfY_.LOG_MESSAGE("ERROR","Missing parameter["+i[s]+"] in event: "+t);r.data[i[s]]=e[i[s]],"string"==typeof r.data[i[s]]&&(r.data[i[s]]=_SgmntfY_._clearNullByte(r.data[i[s]]).trim())}var o=_SgmntfY_._variables.optionalParams[t];for(s=0;s<o.length;++s)_SgmntfY_._isNotEmpty(e[o[s]])&&(r.data[o[s]]=e[o[s]],"string"==typeof r.data[o[s]]&&(r.data[o[s]]=_SgmntfY_._clearNullByte(r.data[o[s]]).trim()));return r}_SgmntfY_.LOG_MESSAGE("ERROR","sessionId is not set, not sending event: "+t)}else _SgmntfY_.LOG_MESSAGE("DEBUG","No send flag is set for event: "+t+", ignoring event")},_getRequestParam:function(e,t,n){return!0===_SgmntfY_._variables.doNotTrack?n?t:null:e||t},_storePersistentData:function(e,t,n,a){if(!0!==_SgmntfY_._variables.doNotTrack)if("undefined"!=typeof Storage&&a)try{localStorage.setItem(e,t),_SgmntfY_.LOG_MESSAGE("DEBUG","Segmentify Persistent Data (Local Storage) Update: "+e+": "+t)}catch(n){_SgmntfY_.LOG_MESSAGE("ERROR","Can't store Persistent Data (Local Storage) Update: "+e+": "+t)}else{"string"==typeof t&&(t=encodeURIComponent(t));var r,i,s="",o="";n&&((r=new Date).setTime(r.getTime()+24*n*60*60*1e3),s="; expires="+r.toGMTString()),_SgmntfY_._variables.domain&&_SgmntfY_._variables.domain.split(".").length>=2&&(o="; domain="+_SgmntfY_._variables.domain),i=e+"="+t+s+o+"; path=/";try{document.cookie=i,_SgmntfY_.LOG_MESSAGE("DEBUG","Segmentify Persistent Data (Cookie) Update: "+i)}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't store Persistent Data (Cookie) Update: "+i)}}},_getPersistentData:function(e,t){if(!0===_SgmntfY_._variables.doNotTrack)return null;if("undefined"!=typeof Storage&&t)try{return localStorage.getItem(e)}catch(t){return _SgmntfY_.LOG_MESSAGE("ERROR","Can't get Persistent Data (Local Storage): "+e),null}else{var n=e+"=";try{for(var a=document.cookie.split(";"),r=0;r<a.length;r++){var i=a[r].trim();if(0===i.indexOf(n))return decodeURIComponent(i.substring(n.length,i.length))}return null}catch(t){return _SgmntfY_.LOG_MESSAGE("ERROR","Can't get Persistent Data (Cookie): "+e),null}}},_clearProductUrl:function(e){return _SgmntfY_._stripQueryParameters(e,["_sgm_source","_sgm_campaign","_sgm_action","_sgm_type","_sgm_test","utm_source","utm_medium","utm_term","utm_content","utm_campaign","utm_type","p_id","gclid","ds_p","ds_eid","ds_aid","ds_e","ds_c","ds_cid","ds_ag","ds_agid","ds_k","ds_kid","ds_kids","ds_kidnl","gclick","gsrc","gclsrc","_sgm_coupon","_sgm_term"])},_stripQueryParameters:function(e,t){if(void 0===t||!t)return e;"string"==typeof t&&(t=[t]);var n=(e||"").split("?");if(n.length>=2){for(var a=[],r=0;r<(t||[]).length;r++)a.push(encodeURIComponent(t[r])+"=");var i=n[1].split(/[&;]/g);for(r=i.length;r-- >0;)for(var s=0;s<a.length;s++)if(-1!==i[r].lastIndexOf(a[s],0)){i.splice(r,1);break}return i.length>0?n[0]+"?"+i.join("&"):n[0]}return e},_getQueryParameter:function(e,t){var n=location.search;if(this._isEmpty(n)){var a=location.hash;this._isNotEmpty(a)&&-1!==a.indexOf("?")&&(n=a.substring(a.indexOf("?")))}void 0!==t&&(n=t),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+e+"=([^&#?]*)").exec(n);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))},_sendTrackedEvent:function(e){var t,n,a,r,i,s=_SgmntfY_._getQueryParameter("_sgm_push_redirect_url",e);if(s&&0!==s.length&&(window.location=s),"segmentify"===_SgmntfY_._getQueryParameter("utm_source",e)?(t=_SgmntfY_._getQueryParameter("utm_campaign",e),n=_SgmntfY_._getQueryParameter("utm_medium",e),a=_SgmntfY_._getQueryParameter("utm_content",e)):(t=_SgmntfY_._getQueryParameter("_sgm_campaign",e),n=_SgmntfY_._getQueryParameter("_sgm_action",e),a=_SgmntfY_._getQueryParameter("_sgm_source",e)),r=_SgmntfY_._getQueryParameter("_sgm_coupon",e),i=_SgmntfY_._getQueryParameter("_sgm_term",e),"push"===n){var o=_SgmntfY_._getPersistentData(t);(_SgmntfY_._isEmpty(o)||_SgmntfY_._isNotEmpty(o)&&"0"===o||"REPLENISHMENT"===t)&&(_SgmntfY_.LOG_MESSAGE("DEBUG","Sending tracked event: "+n+" - "+t+" - "+a+" - type: push-click"),_SgmntfY_._variables.segmentifyObj("push:click:interaction",{type:"push-click",interactionId:a,instanceId:t}))}if("email"===n){o=_SgmntfY_._getPersistentData(t+"_email");(_SgmntfY_._isEmpty(o)||_SgmntfY_._isNotEmpty(o)&&"0"===o)&&_SgmntfY_._variables.segmentifyObj("email:click",{type:"email-click",interactionId:a,instanceId:t})}var c={};i&&(c.term=i),t&&n&&a&&(_SgmntfY_.LOG_MESSAGE("DEBUG","Sending tracked event: "+n+" - "+t+" - "+a),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:n,interactionId:a,instanceId:t,params:c}),"push"===n&&r&&_SgmntfY_._variables.segmentifyObj("coupon",{type:n,interactionId:a,instanceId:t}),"click"===n&&_SgmntfY_.GA.sendProductClick(t,a))},_setTestMode:function(e){var t=e||_SgmntfY_._getQueryParameter("_sgm_test");if(_SgmntfY_._toggleTestMode(t),"exists"!==_SgmntfY_._getExtensionStatus("test")&&"true"===_SgmntfY_._getTestMode())try{var n=['<div class="sgm-test-mode-header">','<a href="http://www.segmentify.com" target="_blank" class="sgm-logo"> </a>','<a href="https://chrome.google.com/webstore/detail/segmentify/dhcffckfimabfhbbjdngnajhnlohfjeo" target="_blank" class="sgm-ext"><span>Get <strong>Chrome Extension</strong> Now!</span></a>','<span class="sgm-test-mode-Show-Hide" data-hide="Hide" data-show="Show"></span>','<div class="sgm-test-mode-key">','<h2 id="sgm-test-mode-message"> Your browser is in<strong>Segmentify Test Mode</strong> </h2>','<div class="sgm-test-mode-radio">','<input class="sgm-tgl sgm-tgl-ios" id="sgm-cb1" type="checkbox" checked>','<label class="sgm-tgl-btn" for="sgm-cb1"></label>',"</div>","</div>","</div>"].join("\n");setTimeout(function(){_SgmntfY_._getJq()("body").prepend(n),"chrome"!==_SgmntfY_._variables.ua.name.toLowerCase()&&_SgmntfY_._getJq()(".sgm-test-mode-header .sgm-ext").hide(),_SgmntfY_._getJq()("body").addClass("sgm-test-body"),_SgmntfY_._getJq()("#sgm-cb1").change(function(){var e=_SgmntfY_._getJq()(this);setTimeout(function(){_SgmntfY_._toggleTestMode(e.is(":checked")?"on":"off")},400)}),_SgmntfY_._getJq()(".sgm-test-mode-Show-Hide").click(function(){_SgmntfY_._getJq()("body").toggleClass("sgm-test-header-open")})},800)}catch(e){_SgmntfY_.LOG_MESSAGE("DEBUG","Can't show test mode header: "+e)}},_getTestMode:function(){return _SgmntfY_._getPersistentData(_SgmntfY_._variables.testMode)},_toggleTestMode:function(e){"on"===e?(_SgmntfY_._getJq()("#sgm-test-mode-message").html("Your browser is in<strong>Segmentify Test Mode</strong>"),_SgmntfY_._getJq()("#sgm-test-mode-message").find("strong").css("color","#50BC61"),_SgmntfY_.LOG_MESSAGE("INFO","Segmentify Test Mode activated"),_SgmntfY_._storePersistentData(_SgmntfY_._variables.testMode,"true",180)):"off"===e&&(_SgmntfY_._getJq()("#sgm-test-mode-message").html("<strong>Segmentify Test Mode</strong> is disabled"),_SgmntfY_._getJq()("#sgm-test-mode-message").find("strong").css("color","#fff"),_SgmntfY_.LOG_MESSAGE("INFO","Segmentify Test Mode deactivated"),_SgmntfY_._storePersistentData(_SgmntfY_._variables.testMode,"false",180),window.alert("You are out of Segmentify Test Mode, you will not see test campaigns."),window.location=_SgmntfY_._stripQueryParameters(document.URL,"_sgm_test"))},_getTracking:function(){var e=_SgmntfY_._getPersistentData(_SgmntfY_._variables.tracking);return _SgmntfY_._isNotEmpty(e)&&_SgmntfY_._setTracking(e),e},_setTracking:function(e){"disabled"!==e&&(e="enabled"),_SgmntfY_._storePersistentData(_SgmntfY_._variables.tracking,e,390)},_getQaMode:function(){try{var e=_SgmntfY_._variables.storage.qaMode;return _SgmntfY_._getPersistentData(e.key,e.local)||"false"}catch(e){return _SgmntfY_.LOG_MESSAGE("DEBUG","Can't read QA mode status: "+err),"false"}},_setQaMode:function(e){var t=e||_SgmntfY_._getQueryParameter("_sgf_qa");if(_SgmntfY_._toggleQaMode(t),"exists"!==_SgmntfY_._getExtensionStatus("qa")&&"true"===_SgmntfY_._getQaMode())try{var n=['<div class="sgm-test-mode-header">','<a href="http://www.segmentify.com" target="_blank" class="sgm-logo-blue"> </a>','<a href="https://chrome.google.com/webstore/detail/segmentify/dhcffckfimabfhbbjdngnajhnlohfjeo" target="_blank" class="sgm-ext"><span>Get <strong>QA Extension</strong> Now!</span></a>','<span class="sgm-test-mode-Show-Hide" data-hide="Hide" data-show="Show"></span>','<div class="sgm-test-mode-key">','<h2 id="sgm-qa-mode-message"> Your browser is in<strong>Segmentify QA Mode</strong> </h2>','<div class="sgm-test-mode-radio">','<input class="sgm-tgl sgm-tgl-ios" id="sgm-cb1" type="checkbox" checked>','<label class="sgm-tgl-btn" for="sgm-cb1"></label>',"</div>","</div>","</div>"].join("\n");setTimeout(function(){_SgmntfY_._getJq()("body").prepend(n),"chrome"!==_SgmntfY_._variables.ua.name.toLowerCase()&&_SgmntfY_._getJq()(".sgm-test-mode-header .sgm-ext").hide(),_SgmntfY_._getJq()("body").addClass("sgm-test-body"),_SgmntfY_._getJq()("#sgm-cb1").change(function(){var e=_SgmntfY_._getJq()(this);setTimeout(function(){_SgmntfY_._toggleQaMode(e.is(":checked")?"on":"off")},400)}),_SgmntfY_._getJq()(".sgm-test-mode-Show-Hide").click(function(){_SgmntfY_._getJq()("body").toggleClass("sgm-test-header-open")})},800)}catch(e){_SgmntfY_.LOG_MESSAGE("DEBUG","Can't show test mode header: "+e)}},_toggleQaMode:function(e){var t=_SgmntfY_._variables.storage.qaMode;"on"===e?(_SgmntfY_._getJq()("#sgm-qa-mode-message").html("Your browser is in<strong>Segmentify QA Mode</strong>"),_SgmntfY_._getJq()("#sgm-qa-mode-message").find("strong").css("color","#50BC61"),_SgmntfY_.LOG_MESSAGE("INFO","Segmentify QA Mode activated"),_SgmntfY_._storePersistentData(t.key,"true",180,t.local)):"off"===e&&(_SgmntfY_._getJq()("#sgm-qa-mode-message").html("<strong>Segmentify QA Mode</strong> is disabled"),_SgmntfY_._getJq()("#sgm-qa-mode-message").find("strong").css("color","#fff"),_SgmntfY_.LOG_MESSAGE("INFO","Segmentify QA Mode deactivated"),_SgmntfY_._storePersistentData(t.key,"false",180,t.local),window.alert("You are out of Segmentify QA Mode."),window.location=_SgmntfY_._stripQueryParameters(document.URL,"_sgf_qa"))},_getSearchVerboseParams:function(e){var t=_SgmntfY_._getSearchQueryOverride();return t?(e._search_no_cache_="true",e._search_query_override_=t):e._search_no_cache_=_SgmntfY_._getSearchNoCache(),!0===_SgmntfY_._variables.search.queryVerboseLog&&(e._search_query_verbose_log_="true"),e},_getSearchNoCache:function(){try{if(!0===_SgmntfY_._variables.search.searchNoCache)return"true";var e=_SgmntfY_._variables.storage.searchNoCache;return _SgmntfY_._getPersistentData(e.key,e.local)||"false"}catch(e){return _SgmntfY_.LOG_MESSAGE("DEBUG","Can't read Search no cache status: "+err),"false"}},_getSearchQueryOverride:function(){try{var e=_SgmntfY_._getPersistentData(_SgmntfY_._variables.search.queryOverrideKey,!0),t=JSON.parse(e).expires;return Date.parse(t)>new Date?e:(_SgmntfY_._unsetSearchQueryOverride(),null)}catch(e){return null}},_getEventUrl:function(){return"true"===_SgmntfY_._getQaMode()?_SgmntfY_._variables.segmentifyQaApiUrl:_SgmntfY_._variables.segmentifyApiUrl},_getPushUrl:function(){return"true"===_SgmntfY_._getQaMode()?_SgmntfY_._variables.pushInfo.qaDataCenter:_SgmntfY_._variables.pushInfo.dataCenter},_getSessionId:function(){if(!0===_SgmntfY_._variables.doNotTrack)return"ANONYMOUS_SESSION";var e=_SgmntfY_._getPersistentData(_SgmntfY_._variables.sessionStorageKey,_SgmntfY_._variables.storage.session.local);return e?e.trim():""},_getUserId:function(){if(!0===_SgmntfY_._variables.doNotTrack)return"ANONYMOUS_USER";var e=_SgmntfY_._getPersistentData(_SgmntfY_._variables.userStorageKey,_SgmntfY_._variables.storage.user.local);return e?e.trim():""},_shuffle:function(e){for(var t,n,a=e.length;a;t=Math.floor(Math.random()*a),n=e[--a],e[a]=e[t],e[t]=n)return e},_getClickedBanners:function(){try{var e=_SgmntfY_._variables.storage.clickedBanners;return JSON.parse(_SgmntfY_._getPersistentData(e.key,e.local))||[]}catch(e){_SgmntfY_.LOG_MESSAGE("DEBUG","Can't read clicked banners: "+e)}return[]},_addClickedBanner:function(e,t,n,a){if(void 0!==e&&void 0!==t&&void 0!==n&&void 0!==a){var r=e+":"+t+":"+n+":"+a,i=_SgmntfY_._getClickedBanners();-1===i.indexOf(r)&&i.push(r),i.length>_SgmntfY_._variables.constants.clickedBannersLimit&&(i=i.splice(i.length-_SgmntfY_._variables.constants.clickedBannersLimit));var s=_SgmntfY_._variables.storage.clickedBanners;_SgmntfY_._storePersistentData(s.key,JSON.stringify(i),0,s.local)}},_getDelayedActions:function(){try{var e=_SgmntfY_._variables.storage.delayedActions;return JSON.parse(_SgmntfY_._getPersistentData(e.key,e.local))||[]}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't read delayed actions: "+e)}return[]},_setDelayedActions:function(e){var t=_SgmntfY_._variables.storage.delayedActions;_SgmntfY_._storePersistentData(t.key,JSON.stringify(e),0,t.local)},_addDelayedAction:function(e){for(var t=_SgmntfY_._getDelayedActions(),n=0;n<t.length;n++)if(t[n].params.actionId===e.params.actionId)return!1;var a=new Date;if(e.delayDate.getTime()<a.getTime())return!1;var r=e.type,i=_SgmntfY_._actions[e.type],s=e.params,o=e.request;return setTimeout(function(){for(var t=_SgmntfY_._getDelayedActions(),n=!1,a=0;a<t.length;a++)t[a].params.actionId===e.params.actionId&&(n=!0);n&&(_SgmntfY_.LOG_MESSAGE("INFO","Action("+r+") is triggered after delay"),i.call(null,s,o),_SgmntfY_._removeDelayedAction(s.actionId))},e.delayDate.getTime()-a.getTime()+Math.floor(750*Math.random())),t.push(e),_SgmntfY_._setDelayedActions(t),!0},_removeDelayedAction:function(e){for(var t=_SgmntfY_._getDelayedActions(),n=0;n<t.length;n++)if(t[n].params.actionId===e)return t.splice(n,1),void _SgmntfY_._setDelayedActions(t)},_getRetryQueue:function(){try{var e=_SgmntfY_._variables.storage.retryQueue;return JSON.parse(_SgmntfY_._getPersistentData(e.key,e.local))||[]}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't read retry queue: "+e)}return[]},_setRetryQueue:function(e){var t=_SgmntfY_._variables.storage.retryQueue;_SgmntfY_._storePersistentData(t.key,JSON.stringify(e),0,t.local)},_addToRetryQueue:function(e){for(var t=_SgmntfY_._getRetryQueue();e.length>0;){var n=e.shift();if("CHECKOUT"===n.eventName||"BASKET_OPERATIONS"===n.eventName||"INTERACTION"===n.eventName){var a=n.data.tryCount||0;a<_SgmntfY_._variables.constants.retryLimit&&(n.data.tryCount=a+1,_SgmntfY_._variables.isPageHide&&(n.originalParams.discardResponse="true"),t.push(n))}}_SgmntfY_._setRetryQueue(t)},_consumeRetryQueue:function(){var e=_SgmntfY_._getRetryQueue();if(e&&e.length>0){for(var t=[];e.length>0;){var n=e.shift();n.data.userId=_SgmntfY_._getUserId(),n.data.sessionId=_SgmntfY_._getSessionId(),t.push(n)}_SgmntfY_._sendRequestToServer(t),_SgmntfY_._setRetryQueue([])}},_getDataLayer:function(){return window[_SgmntfY_._variables.dataLayer]},_consumeDataLayer:function(){if(_SgmntfY_._variables.consumeDataLayer){var e=[],t=function(t,n){if(!n.hasOwnProperty("__processed__")||!0!==n.__processed__){var a=_SgmntfY_._extend(n,r),i=_SgmntfY_._functions.getDataLayerFunction(t,a).apply(null,[a]);i&&e.push(i)}},n=function(e,t){var n=JSON.parse(JSON.stringify(t)),a=_SgmntfY_._variables.dataLayerConfig[e]||{};for(var r in a)if(a.hasOwnProperty(r)){var i=a[r];if(n.hasOwnProperty(i)){var s=n[i];delete n[i],n[r]=s}}return n},a=_SgmntfY_._getDataLayer()||{},r=n("common",a.common||{});if(r.hasOwnProperty("userId")){var i=_SgmntfY_._functions.setUserId(r.userId);i&&(e.push(i),delete _SgmntfY_._getDataLayer().common.userId)}for(var s in a)if(a.hasOwnProperty(s)){if("common"===s)continue;if(_SgmntfY_._getJq().isArray(a[s]))for(var o=0;o<a[s].length;++o)t(s,n(s,a[s][o])),_SgmntfY_._getDataLayer()[s][o].__processed__=!0;else t(s,n(s,a[s])),_SgmntfY_._getDataLayer()[s].__processed__=!0}e.length>0&&_SgmntfY_._sendRequestToServer(e)}},_getNextPageQueue:function(){try{var e=_SgmntfY_._variables.storage.nextPageQueue;return JSON.parse(_SgmntfY_._getPersistentData(e.key,e.local))||[]}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't read next page queue: "+e)}return[]},_setNextPageQueue:function(e){var t=_SgmntfY_._variables.storage.nextPageQueue;_SgmntfY_._storePersistentData(t.key,JSON.stringify(e),0,t.local)},_addToNextPageQueue:function(e){var t=_SgmntfY_._getNextPageQueue();t.push(e),_SgmntfY_._setNextPageQueue(t)},_consumeNextPageQueue:function(){var e=_SgmntfY_._getNextPageQueue();if(e&&e.length>0){for(var t=[];e.length>0;){var n=e.shift();n.hasOwnProperty("data")||(n=_SgmntfY_._prepareRequest(n.params,n.eventName,!0)),n.data.userId=_SgmntfY_._getUserId(),n.data.sessionId=_SgmntfY_._getSessionId(),t.push(n)}_SgmntfY_._sendRequestToServer(t),_SgmntfY_._setNextPageQueue([])}},_addRecommendedProduct:function(e){_SgmntfY_._variables.recommendedProducts.push(e)},_containsRecommendedProduct:function(e){return _SgmntfY_._variables.recommendedProducts.indexOf(e)>=0},_addRecommendedPromotion:function(e){_SgmntfY_._variables.recommendedPromotions.push(e)},_containsRecommendedPromotion:function(e){return _SgmntfY_._variables.recommendedPromotions.indexOf(e)>=0},_getExtensionStatus:function(e){try{var t;return t="qa"===e?_SgmntfY_._variables.storage.qaExtensionStatus:_SgmntfY_._variables.storage.extensionStatus,_SgmntfY_._getPersistentData(t.key,t.local)||""}catch(e){_SgmntfY_.LOG_MESSAGE("DEBUG","Can't read extension status: "+e)}return""},_getDelayedCampaigns:function(){try{var e=_SgmntfY_._variables.storage.delayedCampaigns;return JSON.parse(_SgmntfY_._getPersistentData(e.key,e.local))||[]}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't read delayed campaigns: "+e)}return[]},_setDelayedCampaigns:function(e){var t=_SgmntfY_._variables.storage.delayedCampaigns;_SgmntfY_._storePersistentData(t.key,JSON.stringify(e),0,t.local)},_addDelayedCampaign:function(e){for(var t=_SgmntfY_._getDelayedCampaigns(),n=0;n<t.length;++n)if(t[n].campaign.instanceId===e.campaign.instanceId)return!1;var a=new Date;if(e.time.getTime()<a.getTime())return!1;var r=e.campaign,i=e.request,s=_SgmntfY_._campaigns[r.type];return setTimeout(function(){for(var t=_SgmntfY_._getDelayedCampaigns(),n=!1,a=0;a<t.length;++a)t[a].campaign.instanceId===e.campaign.instanceId&&(n=!0);n&&(_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+r.type+") triggered after delay"),s.call(null,r,i),_SgmntfY_._removeDelayedCampaign(r.instanceId))},e.time.getTime()-a.getTime()+Math.floor(750*Math.random())),t.push(e),_SgmntfY_._setDelayedCampaigns(t),!0},_removeDelayedCampaign:function(e){for(var t=_SgmntfY_._getDelayedCampaigns(),n=0;n<t.length;n++)if(t[n].campaign.instanceId===e)return t.splice(n,1),void _SgmntfY_._setDelayedCampaigns(t)},_getPageViewsCampaigns:function(){try{var e=_SgmntfY_._variables.storage.pageViewCampaigns;return JSON.parse(_SgmntfY_._getPersistentData(e.key,e.local))||[]}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't read pageview campaigns: "+e)}return[]},_setPageViewsCampaigns:function(e){var t=_SgmntfY_._variables.storage.pageViewCampaigns;_SgmntfY_._storePersistentData(t.key,JSON.stringify(e),0,t.local)},_addPageViewsCampaign:function(e){for(var t=_SgmntfY_._getPageViewsCampaigns(),n=0;n<t.length;++n)if(t[n].campaign.instanceId===e.campaign.instanceId){if(e.sessionId===_SgmntfY_._getSessionId())return!1;_SgmntfY_._removePageViewsCampaign(e.campaign.instanceId);break}return t.push(e),_SgmntfY_._setPageViewsCampaigns(t),!0},_removePageViewsCampaign:function(e){for(var t=_SgmntfY_._getPageViewsCampaigns(),n=0;n<t.length;n++)if(t[n].campaign.instanceId===e)return t.splice(n,1),void _SgmntfY_._setPageViewsCampaigns(t)},_triggerPageViewsCampaign:function(e){if(0===e.pageView&&e.sessionId===_SgmntfY_._getSessionId()){for(var t=e.campaign,n=e.request,a=_SgmntfY_._campaigns[t.type],r=_SgmntfY_._getPageViewsCampaigns(),i=!1,s=0;s<r.length;++s)r[s].campaign.instanceId===e.campaign.instanceId&&(i=!0);i&&(_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+t.type+") triggered after pageviews"),a.call(null,t,n),_SgmntfY_._removePageViewsCampaign(t.instanceId))}},_interaction:function(e,t,n){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:e,instanceId:t,interactionId:n})},_getFireTime:function(e){function t(e,t){for(var n=e.toString();n.length<t;)n="0"+n;return n}try{return e.getFullYear()+"."+t(e.getMonth()+1,2)+"."+t(e.getDate(),2)+" "+t(e.getHours(),2)+":"+t(e.getMinutes(),2)+":"+t(e.getSeconds(),2)+"."+t(e.getMilliseconds(),3)}catch(e){return""}},_getTimeZone:function(e){try{return e.getTimezoneOffset().toString()}catch(e){return""}},_getJq:function(){return _SgmntfY_._variables.jq},_getMustache:function(){return _SgmntfY_._variables.mustache},_getObjectByString:function(e,t){for(var n=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),a=0,r=n.length;a<r;++a){var i=n[a];if(!(i in e))return;e=e[i]}return e},_isUndefined:function(e){return void 0===e},_notNull:function(e){return void 0!==e&&null!=e},_isEmpty:function(e){return void 0===e||null==e||""===e},_isNotEmpty:function(e){return!_SgmntfY_._isEmpty(e)},_isPlainObject:function(e){if("object"==typeof e&&null!==e){if("function"==typeof Object.getPrototypeOf){var t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}return"[object Object]"==Object.prototype.toString.call(e)}return!1},_isElemVisible:function(e){try{if(_SgmntfY_._exists(e)&&"none"!==e.css("display")){var t=_SgmntfY_._getJq()(window),n=t.scrollTop(),a=n+t.height();e instanceof HTMLElement?e=_SgmntfY_._getJq()(e):e instanceof HTMLCollection&&(e=_SgmntfY_._getJq()(e[0]));var r=e.offset().top;return r+100<=a&&r>=n}return!1}catch(e){return!1}},_exists:function(e){return e instanceof HTMLElement?null!==e:(e instanceof HTMLCollection||e instanceof _SgmntfY_._getJq()||e instanceof jQuery||e instanceof $)&&e.length>0},_extend:function(){var e,t,n,a,r,i=arguments[0]||{},s=1,o=arguments.length,c=!1;for("boolean"==typeof i&&(c=i,i=arguments[s]||{},s++);s<o;s++)if(null!=(e=arguments[s]))for(t in e)if(e.hasOwnProperty(t)){if(n=i[t],i===(a=e[t]))continue;c&&a&&_SgmntfY_._isPlainObject(a)?(r=n&&"object"==typeof n&&null!==n?n:{},i[t]=_SgmntfY_._extend(c,r,a)):void 0!==a&&(i[t]=a)}return i},_split:function(e,t,n){if(e&&"string"==typeof e){var a,r=e.split(t);for(a=0;a<r.length;a++)r[a]=r[a].trim();if(n&&n<r.length){var i=r.splice(0,n-1);i.push(r.join(t)),r=i}return r}return null},_parseFloat:function(e){return null==e?e:void 0===e?null:"number"==typeof e?e:"string"==typeof e?parseFloat(e):e},_parseBoolean:function(e){return void 0===e?null:"number"==typeof e?0===e?"false":"true":"string"==typeof e?"0"===e||"false"===e.toLowerCase()?"false":"true":"boolean"==typeof e?e.toString():e},_null:function(e){return null!=e&&""!=e},_clearNullByte:function(e){return e.replace(/\0/g,"")},_checkVersion:function(e,t){var n=t.split("."),a=e.split(".");prevs=[];for(var r=0,i=Math.max(n.length,a.length);r<i;r++){if(n[r]=parseInt(n[r]),isNaN(n[r])&&(n[r]=0),a[r]=parseInt(a[r]),isNaN(a[r])&&(a[r]=0),n[r]<a[r])return!1;if(n[r]>a[r])return!0}return!0},_updateBrowserAndDeviceInfo:function(){if(void 0!==window.bowser){var e=window.bowser._detect(_SgmntfY_._variables.ua.agentString);null==_SgmntfY_._variables.ua.type&&(e.tablet?_SgmntfY_._variables.ua.type="tablet":e.mobile?_SgmntfY_._variables.ua.type="mobile":_SgmntfY_._variables.ua.type="PC",e.chromium?_SgmntfY_._variables.ua.name="Chrome":_SgmntfY_._variables.ua.name=e.name,_SgmntfY_._variables.ua.version=e.version),null==_SgmntfY_._variables.ua.os&&(_SgmntfY_._variables.ua.os=e.osname||"Other",_SgmntfY_._variables.ua.osversion=e.osversion)}},_addLeavePageHandler:function(e,t){var n=e.type,a=e.params,r=_SgmntfY_._actions[n];_SgmntfY_.LOG_MESSAGE("INFO","Action("+n+") will be triggered when user leaves page");var i=function(e){e.clientY<0&&(_SgmntfY_.LOG_MESSAGE("INFO","Action("+n+") is triggered at user leave page"),_SgmntfY_._getJq()(document).unbind("mouseleave",i),r.call(null,a,t))};_SgmntfY_._getJq()(document).bind("mouseleave",i)},_addWaitPageHandler:function(e,t){var n=e.type,a=e.params,r=e.delayAction||null,i=_SgmntfY_._actions[n],s=parseInt(r.time);_SgmntfY_.LOG_MESSAGE("INFO","Action("+n+") will be triggered after "+s+" second(s) delay on same page"),setTimeout(function(){_SgmntfY_.LOG_MESSAGE("INFO","Action("+n+") is triggered after delay"),i.call(null,a,t)},1e3*s)},_addScrollHandler:function(e,t){var n=e.type,a=e.delayAction,r=parseInt(a.time)||0;_SgmntfY_.LOG_MESSAGE("INFO","Action ("+n+") will be triggered after "+r+"% of page is scrolled");var i=function(){r<=_SgmntfY_._getScrollPercent()&&(_SgmntfY_.LOG_MESSAGE("INFO","Action ("+n+") triggered after "+r+"% of page is scrolled"),_SgmntfY_._getJq()(document).unbind("scroll",i),_SgmntfY_._actions[n].call(null,e.params,t))};_SgmntfY_._getJq()(document).bind("scroll",i)},_addCampaignDelayHandler:function(e,t){var n=e.type,a=e.timing,r=parseInt(a.param);_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") will be triggered after "+r+" second(s) delay on same page"),window.setTimeout(function(){_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") triggered after "+r+" delay"),_SgmntfY_._campaigns[n].call(null,e,t)},1e3*r)},_addCampaignDelayAllPagesHandler:function(e,t){var n=e.timing||"0",a={campaign:e,request:t,time:new Date((new Date).getTime()+1e3*parseInt(n.param))};_SgmntfY_._addDelayedCampaign(a)?_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+e.instanceId+") added for delayed campaign in future"):_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+e.instanceId+") already added for delayed campaign")},_addCampaignPageViewsHandler:function(e,t){var n=e.timing||"0",a={campaign:e,request:t,pageView:parseInt(n.param)-1,sessionId:_SgmntfY_._getSessionId()};_SgmntfY_._addPageViewsCampaign(a)?_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+e.instanceId+") added for pageview campaign in future"):_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+e.instanceId+") already added for pageview campaign")},_addCampaignScrollHandler:function(e,t){var n=e.type,a=e.timing,r=parseInt(a.param);_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") will be triggered after "+r+"% of page is scrolled");var i=function(){r<=_SgmntfY_._getScrollPercent()&&(_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") triggered after "+r+"% of page is scrolled"),_SgmntfY_._getJq()(document).unbind("scroll",i),_SgmntfY_._campaigns[n].call(null,e,t))};_SgmntfY_._getJq()(document).bind("scroll",i)},_addCampaignLeaveHandler:function(e,t){var n=e.type;_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") will be triggered when user leaves page");var a=function(r){r.clientY<0&&(_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") triggered at user leave page"),_SgmntfY_._getJq()(document).unbind("mouseleave",a),_SgmntfY_._campaigns[n].call(null,e,t))};_SgmntfY_._getJq()(document).bind("mouseleave",a)},_addCampaignInteractionHandler:function(e,t){},_getScrollPercent:function(){var e=document.documentElement,t=document.body,n="scrollTop",a="scrollHeight";return(e[n]||t[n])/((e[a]||t[a])-e.clientHeight)*100},_updateUserAndSessionId:function(e){if(!0!==_SgmntfY_._variables.doNotTrack){_SgmntfY_._variables.waitingKeys=!0;var t={data:null,url:_SgmntfY_._getEventUrl()+"/get/key/v1.json?count="+e};_SgmntfY_._getJq().ajax({contentType:"text/plain",processData:!1,type:"GET",url:t.url,timeout:1e3*_SgmntfY_._variables.constants.eventTimeout}).done(function(n,a,r){_SgmntfY_._ajaxSuccess(t,n,a),2===e&&_SgmntfY_._storePersistentData(_SgmntfY_._variables.userStorageKey,n[1],390,_SgmntfY_._variables.storage.user.local);var i=_SgmntfY_._getUserId();_SgmntfY_._isEmpty(i)?_SgmntfY_.LOG_MESSAGE("ERROR","Can't update User Id"):(_SgmntfY_.LOG_MESSAGE("INFO","User Id Changed: "+i),_SgmntfY_._storePersistentData(_SgmntfY_._variables.sessionStorageKey,n[0],0,_SgmntfY_._variables.storage.session.local),_SgmntfY_._isEmpty(_SgmntfY_._getSessionId())?_SgmntfY_.LOG_MESSAGE("ERROR","Can't update User Session"):(_SgmntfY_.LOG_MESSAGE("INFO","User Session Changed: "+n[0]),_SgmntfY_._variables.waitingKeys=!1,_SgmntfY_._variables.keysTryCount++))}).fail(function(e,n,a){_SgmntfY_._ajaxError(t,e,n,a),_SgmntfY_._variables.keysTryCount++,_SgmntfY_._variables.waitingKeys=!1})}},_sendRequestToServer:function(e){if(e&&!(e.length<=0)){for(var t=[],n=0;n<e.length;n++)t.push(e[n].data);var a={"X-Sfy-Api-Key":_SgmntfY_._variables.apiKey};_SgmntfY_._getJq().ajax({contentType:"text/plain",processData:!1,type:"POST",url:_SgmntfY_._getEventUrl()+"/add/events/v1.json?apiKey="+_SgmntfY_._variables.apiKey,data:JSON.stringify(t),headers:a,timeout:1e3*_SgmntfY_._variables.constants.eventTimeout}).done(function(n,a,r){_SgmntfY_._ajaxSuccess(t,n,a);var i=n.statusCode||"";if("SUCCESS"===i){var s=n.responses,o=n.campaigns,c=n.search,g=n.coupons||[[]],_=n.experiments||{};if(_SgmntfY_._experiment.get()!==_SgmntfY_._experiment.toString(_)&&_SgmntfY_._experiment.store(_SgmntfY_._experiment.toString(_)),s.length===e.length&&o.length===e.length)for(var m=0;m<s.length;m++){var l=e[m],d=s[m],f=o[m],u=c[m],p=g[m];"true"!==l.originalParams.discardResponse?(_SgmntfY_._getResponse(l,d),_SgmntfY_._getCampaign(l,f),_SgmntfY_._getSearchCampaign(l,u),_SgmntfY_.initCoupon(p)):_SgmntfY_.LOG_MESSAGE("DEBUG","Action("+l.eventName+") responses are discarded")}else _SgmntfY_.LOG_MESSAGE("WARN","Segmentify response length("+s.length+") doesn't match request length("+e.length+")")}else _SgmntfY_.LOG_MESSAGE("WARN","Segmentify response is ("+i+")"),"NO_SESSIONID"===i?_SgmntfY_._updateUserAndSessionId(1):"NO_USERID"===i&&_SgmntfY_._updateUserAndSessionId(2)}).fail(function(n,a,r){for(var i=!1,s=0;s<e.length;s++)_SgmntfY_._jbOverFlowOperations._journeyFinished(e[s])&&(i=!0);i&&_SgmntfY_._jbOnDestroyJourneyFlowExecution(!1),_SgmntfY_._searchFailHandler(e,n,a,r),_SgmntfY_._addToRetryQueue(e),_SgmntfY_._ajaxError(t,n,a,r)})}},_searchFailHandler:function(e,t,n,a){var r=null;if(e&&e.length>0&&(r=e.filter(function(e){return"SEARCH"===e.eventName})),r&&r.length>0){var i=r[0];if(i.data&&"faceted"===i.data.type&&"function"==typeof i._cb)i._cb(null,{jqXHR:t,textStatus:n,errorThrown:a});else if(0!==_SgmntfY_._getJq()(".seg-search-wrapper").length)if(_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth)(r=null)&&r.length>0&&_SgmntfY_._variables.search.initialCampaign?_SgmntfY_._getSearchCampaign(r[0],[{campaign:_SgmntfY_._variables.search.initialCampaign}]):_SgmntfY_._getJq().each(_SgmntfY_._searchGetInputElement(),function(){"matrix(1, 0, 0, 1, 0, -2000)"==_SgmntfY_._getJq()(this).css("transform")&&(_SgmntfY_._getJq()(this).addClass("seg-search-unset"),_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("open"),_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("sgm-search-open"),_SgmntfY_._getJq()(this).blur())});else(_SgmntfY_._getJq()(".seg-search-wrapper").hasClass("open")||_SgmntfY_._getJq()(".seg-search-wrapper").hasClass("sgm-search-open"))&&(_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("open"),_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("sgm-search-open"))}},_getResponse:function(e,t){_SgmntfY_._jbCheckDeliveryStep(e,t);for(var n=0;n<t.length;n++){var a=t[n];if(a.hasOwnProperty("type")){var r=a.type,i=a.delayAction||null,s=a.params,o=(a.instanceId,_SgmntfY_._actions[r]);if(!1===s.isControlGroup){_SgmntfY_.LOG_MESSAGE("DEBUG","User is in control group for campaign: "+s.instanceId);continue}if("function"==typeof o)if(i&&"LEAVE_PAGE"===i.type)_SgmntfY_._addLeavePageHandler(a,e);else if(i&&"WAIT_SAME_PAGE"===i.type&&parseInt(i.time)>0)_SgmntfY_._addWaitPageHandler(a,e);else if(i&&"WAIT_ALL_PAGES"===i.type&&parseInt(i.time)>0){var c={delayDate:new Date((new Date).getTime()+1e3*parseInt(i.time)),params:s,type:r,request:e};_SgmntfY_._addDelayedAction(c)?_SgmntfY_.LOG_MESSAGE("INFO","Action(id="+c.params.actionId+") is added for delayed action in future"):_SgmntfY_.LOG_MESSAGE("INFO","Action(id="+c.params.actionId+") is already added for delayed action")}else i&&"SCROLL"===i.type?_SgmntfY_._addScrollHandler(a,e):(_SgmntfY_.LOG_MESSAGE("INFO","Action("+r+") triggered immediately"),o.call(null,s,e));else _SgmntfY_.LOG_MESSAGE("WARN","Unknown action: "+r)}}},_jbCheckDeliveryStep:function(e,t){if(_SgmntfY_._jbOverFlowOperations._journeyFinished(e)){for(var n,a=!1,r=!1,i=!1,s=0;s<t.length;s++){var o=t[s],c=o.type;"recommendProducts"===c&&Object.keys(o.params.recommendedProducts)&&Object.keys(o.params.recommendedProducts).forEach(function(e){o.params.recommendedProducts[e]&&o.params.recommendedProducts[e].length>0&&(a=!0)}),"giveCoupon"===c&&(r=!0),"landingPage"===c&&(n=o.params.landingPageUrl)&&n.length>0&&(i=!0)}!0===a||!0===r||!0===i?(_SgmntfY_._jbOnDestroyJourneyFlowExecution(!0),!1===a&&!1===r&&(_SgmntfY_.LOG_MESSAGE("DEBUG","Redirecting action to url: "+n),window.location=n)):_SgmntfY_._jbOnDestroyJourneyFlowExecution(!1)}},_getCampaign:function(e,t){for(var n=0;n<t.length;n++){var a=t[n]||{};if(a.hasOwnProperty("type")){var r=a.type,i=_SgmntfY_._campaigns[r];if("function"==typeof i){var s=a.timing||{};"DELAY"===s.type?_SgmntfY_._addCampaignDelayHandler(a,e):"DELAY_ALL_PAGES"===s.type?_SgmntfY_._addCampaignDelayAllPagesHandler(a,e):"PAGE_VIEWS"===s.type?_SgmntfY_._addCampaignPageViewsHandler(a,e):"SCROLL"===s.type?_SgmntfY_._addCampaignScrollHandler(a,e):"PAGELEAVE"===s.type?_SgmntfY_._addCampaignLeaveHandler(a,e):"INTERACTION"===s.type?_SgmntfY_._addCampaignInteractionHandler(a,e):(_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+r+") triggered immediately."),i.call(null,a,e))}else _SgmntfY_.LOG_MESSAGE("WARN","Unknown campaign: "+r)}}},initCoupon:function(e){try{if(0===e.length)return;var t=_SgmntfY_._getJq()(document).find("#seg-coupon-asimov");if(t&&t.length>0)return;var n=e[0],a=n.widget.html,r=n.widget.validationText,i={code:n.code,valid_until:r+" "+new Date(n.validUntil).toLocaleDateString(),copy_button_text:n.widget.copyButtonText,description:n.widget.description,title:n.widget.title},s=_SgmntfY_._getMustache().render(a,i),o=(s=_SgmntfY_._getJq()(s)).first(),c=s.find(".seg-coupon-asimov_content"),g=s.find(".seg-coupon-asimov_switch");"RIGHT"===n.widget.position&&o.addClass("seg-coupon-asimov_right"),c.css({"background-color":n.widget.backgroundColor,color:n.widget.foregroundColor}),g.css({"background-color":n.widget.backgroundColor,color:n.widget.foregroundColor}),_SgmntfY_._getJq()("body").prepend(s),_SgmntfY_.bindCouponBindings({copiedInfoText:n.widget.copiedInfoText}),_SgmntfY_._openCoupon(),setTimeout(function(){_SgmntfY_._closeCoupon()},2e3)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Coupon couldn't be rendered!")}},bindCouponBindings:function(e){try{function t(){var e=_SgmntfY_._getJq()("#seg-coupon-asimov");if(e.addClass("no-interaction"),e.css("height",_SgmntfY_._getJq()("#seg-coupon-asimov").prop("scrollHeight")),e.hasClass("seg-coupon-asimov_open")){var t=e.children(".seg-coupon-asimov_switch").height();e.css("height",t)}else setTimeout(function(){e.css("height","auto")},500);setTimeout(function(){e.removeClass("no-interaction")},500),e.toggleClass("seg-coupon-asimov_open")}_SgmntfY_._getJq()(document).on("click",".seg-coupon-asimov_switch",function(){if(_SgmntfY_._getJq()(this).parent("#seg-coupon-asimov").hasClass("no-interaction"))return!1;t()}),_SgmntfY_._getJq()(document).on("click",".seg-coupon-asimov_copy:not(.no-interaction)",function(){_SgmntfY_._getJq()("#seg-coupon-asimov").addClass("no-interaction"),_SgmntfY_._getJq()(this).addClass("no-interaction"),_SgmntfY_._textCopyToClipBoard("seg-coupon-asimov_code");var n=_SgmntfY_._getJq()(".seg-coupon-asimov_copy").html();return _SgmntfY_._getJq()(".seg-coupon-asimov_copy").html(e.copiedInfoText),setTimeout(function(){t(),setTimeout(function(){_SgmntfY_._getJq()(".seg-coupon-asimov_copy").html(n),_SgmntfY_._getJq()("#seg-coupon-asimov").removeClass("no-interaction"),_SgmntfY_._getJq()(".seg-coupon-asimov_copy").removeClass("no-interaction")},400)},1e3),!1})}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Could not bind coupon bindings.")}},_textCopyToClipBoard:function(e){if(e=document.getElementsByClassName(e)[0],document.body.createTextRange)(t=document.body.createTextRange()).moveToElementText(e),t.select();else if(window.getSelection){var t,n=window.getSelection();(t=document.createRange()).selectNodeContents(e),n.removeAllRanges(),n.addRange(t)}else _SgmntfY_.LOG_MESSAGE("WARN","Could not select text in node: Unsupported browser.");document.execCommand("copy"),window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},_openCoupon:function(){var e=_SgmntfY_._getJq()("#seg-coupon-asimov");e.addClass("no-interaction"),e.css("height",_SgmntfY_._getJq()("#seg-coupon-asimov").prop("scrollHeight")),setTimeout(function(){e.css("height","auto")},500),setTimeout(function(){e.removeClass("no-interaction")},500),e.toggleClass("seg-coupon-asimov_open")},_closeCoupon:function(){var e=_SgmntfY_._getJq()("#seg-coupon-asimov");if(e.addClass("no-interaction"),e.css("height",_SgmntfY_._getJq()("#seg-coupon-asimov").prop("scrollHeight")),e.hasClass("seg-coupon-asimov_open")){var t=e.children(".seg-coupon-asimov_switch").height();e.css("height",t)}setTimeout(function(){e.removeClass("no-interaction")},500),e.toggleClass("seg-coupon-asimov_open")},_decodeHtml:function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value},_getControlGroup:function(){var e="REAL";try{if(_SgmntfY_._variables.controlGroup&&"OPTIMIZE"===_SgmntfY_._variables.controlGroup.source){var t=window.google_optimize&&window.google_optimize.get(_SgmntfY_._variables.controlGroup.experimentID);t&&t==_SgmntfY_._variables.controlGroup.controlValue&&(e="CONTROL")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing _getControlGroup: "+e)}return e},_getSearchCampaign:function(e,t){if("SEARCH"===e.eventName&&"faceted"===e.data.type){if("function"==typeof e._cb)return e._cb(t)}else if("SEARCH"===e.eventName&&(_SgmntfY_._variables.search.isExecutable||_SgmntfY_._variables.search.isExecutableForAfter)&&0===t.length&&(t=[{campaign:_SgmntfY_._variables.search.initialCampaign}]),0!==t.length)if(!0===t[0].isExecutable||!0===t[0].isExecutableForAfter)!function(){var e=t[0].initialCampaign;_SgmntfY_._variables.search.isExecutable=t[0].isExecutable,_SgmntfY_._variables.search.isExecutableForAfter=t[0].isExecutableForAfter,_SgmntfY_._variables.search.input=t[0].idOrClassName,_SgmntfY_._variables.search.manuelTrigger=t[0].manuelTrigger,_SgmntfY_._variables.search.initialCampaign=e,_SgmntfY_._variables.search.searchMinChar=e&&e.minCharacterCount||3,_SgmntfY_._variables.search.searchDelay=e&&e.searchDelay||500,_SgmntfY_._variables.search.shadowRootElements=t[0].shadowRootElements||[],_SgmntfY_._variables.search.shadowRootElementsForHide=t[0].shadowRootElementsForHide||[],_SgmntfY_._variables.search.shadowRootElementsForTrigger=t[0].shadowRootElementsForTrigger||[],_SgmntfY_._variables.search.forceRemoveInputVal=!(!e||void 0===e.forceRemoveInputVal)&&e.forceRemoveInputVal,_SgmntfY_._variables.search.clearInputBindingsOnSite=t[0].clearInputBindingsOnSite,-1===_SgmntfY_._variables.search.input.indexOf(",input#sgm-qa-search")&&(_SgmntfY_._variables.search.input=_SgmntfY_._variables.search.input+",input#sgm-qa-search");_SgmntfY_._searchSetActiveRootElement()}(),_SgmntfY_._initSearch();else if(void 0===t[0].isExecutable&&void 0===t[0].isExecutableForAfter){var n=void 0;_SgmntfY_._variables.search.currentActiveInput&&_SgmntfY_._variables.search.currentActiveInput.value&&(n=_SgmntfY_._variables.search.currentActiveInput.value.trim()),void 0!==e.data.query&&void 0!==_SgmntfY_._variables.search.currentActiveInput&&e.data.query!==_SgmntfY_._prepareSearchQuery(n)||_SgmntfY_._searchResultHandler(e,t)}},_searchSetActiveRootElement:function(){_SgmntfY_._variables.search.activeRootElement=document,_SgmntfY_._variables.search.activeRootElementForHide=document,_SgmntfY_._variables.search.activeRootElementForTrigger=document,_SgmntfY_._variables.search.shadowRootElements.forEach(function(e){var t=_SgmntfY_._getJq()(e,_SgmntfY_._variables.search.activeRootElement);t&&t.length>0?_SgmntfY_._variables.search.activeRootElement=t[0].shadowRoot:_SgmntfY_.LOG_MESSAGE("WARN","ShadowRoot Element could not be found: "+e)}),_SgmntfY_._variables.search.shadowRootElementsForHide.forEach(function(e){var t=_SgmntfY_._getJq()(e,_SgmntfY_._variables.search.activeRootElementForHide);t&&t.length>0?_SgmntfY_._variables.search.activeRootElementForHide=t[0].shadowRoot:_SgmntfY_.LOG_MESSAGE("WARN","ShadowRoot Element For Hide could not be found: "+e)}),_SgmntfY_._variables.search.shadowRootElementsForTrigger.forEach(function(e){var t=_SgmntfY_._getJq()(e,_SgmntfY_._variables.search.activeRootElementForTrigger);t&&t.length>0?_SgmntfY_._variables.search.activeRootElementForTrigger=t[0].shadowRoot:_SgmntfY_.LOG_MESSAGE("WARN","ShadowRoot Element For Trigger could not be found: "+e)})},_isSearchOpen:function(){var e=_SgmntfY_._getJq()(".seg-search-wrapper");return e.hasClass("open")||e.hasClass("sgm-search-open")},_searchInputActivateHandler:function(e){if(!_SgmntfY_._getJq()(".seg-search-wrapper")||!_SgmntfY_._isSearchOpen()){if(_SgmntfY_._variables.search.currentActiveInput=e.target,0===_SgmntfY_._getJq()(".seg-search-wrapper").length)_SgmntfY_._getJq()("<div/>",{class:"seg-search-wrapper"}).appendTo("body");!function(){if(_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth){/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&(_SgmntfY_._getJq()(".seg-search-wrapper").addClass("keyboard-on"),_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-keyboard-on"),_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-ios-device"));var e="undefined"!=typeof sgmSearchSettings&&sgmSearchSettings.mobileSearchAssets&&0===sgmSearchSettings.mobileSearchAssets.length;e&&(_SgmntfY_._getJq()(".seg-search-wrapper").addClass("no-sidebar"),_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-no-sidebar")),_SgmntfY_._getJq()(".seg-search-wrapper").addClass("mobile"),_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-mobile");var t=!1,n=_SgmntfY_._getJq()("meta");if(n.each(function(e){"viewport"===e.name&&(t=!0,!0===e.content.includes("width=")&&!0!==e.content.includes("width=device-width")?!0!==e.content.includes("user-scalable=")&&(e.content=e.content.concat(" ,user-scalable=no")):(!0!==e.content.includes("width=device-width")&&(e.content=e.content.concat(" ,width=device-width")),!0!==e.content.includes("initial-scale=")&&(e.content=e.content.concat(" ,initial-scale=1.0")),!0!==e.content.includes("maximum-scale=")&&(e.content=e.content.concat(" ,maximum-scale=1.0")),!0!==e.content.includes("user-scalable=")&&(e.content=e.content.concat(" ,user-scalable=no"))))}),!t){var a=document.createElement("meta");a.name="viewport",a.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",document.getElementsByTagName("head")[0].appendChild(a)}}}(),!0===_SgmntfY_._variables.search.forceRemoveInputVal&&(_SgmntfY_._variables.search.currentActiveInput.value="");var t=_SgmntfY_._variables.search.currentActiveInput.value.trim().length;_SgmntfY_._variables.search.keywordSearch=t>=_SgmntfY_._variables.search.searchMinChar,_SgmntfY_._variables.search.emptySearch=0===t||t<_SgmntfY_._variables.search.searchMinChar,!0!==_SgmntfY_._variables.search.emptySearch&&!0!==_SgmntfY_._variables.search.keywordSearch||_SgmntfY_._sendSearchRequest()}},_setSearchQueryOverride:function(e){if(e&&"object"==typeof e){var t=new Date;t.setHours(t.getHours()+2),e.expires=t,_SgmntfY_._storePersistentData(_SgmntfY_._variables.search.queryOverrideKey,JSON.stringify(e),1,!0)}},_unsetSearchQueryOverride:function(){_SgmntfY_._storePersistentData(_SgmntfY_._variables.search.queryOverrideKey,null,0,!0)},_disableSearchTriggerEventsOnSite:function(){!0===_SgmntfY_._variables.search.clearInputBindingsOnSite&&_SgmntfY_._searchGetInputElement().off(),_SgmntfY_._getActiveSearchManuelTrigger()&&_SgmntfY_._searchGetManuelTriggerElementForMobile().off(),_SgmntfY_._searchGetInputElement().attr("autocomplete","OFF")},_getActiveSearchManuelTrigger:function(){return _SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth?_SgmntfY_._variables.search.manuelTrigger:_SgmntfY_._getJq()(window).width()>=_SgmntfY_._variables.search.maxMobileWidth&&!0===_SgmntfY_._variables.search.manuelTriggerEnabledForDesktop?_SgmntfY_._variables.search.manuelTriggerDesktop:null},_activateSgmSearchTriggerEvents:function(){var e=_SgmntfY_._variables.search.activeRootElement.querySelectorAll(_SgmntfY_._variables.search.input);"safari"===bowser.name.toLowerCase()||/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?e&&e.length?(e.forEach(function(e){e.addEventListener("click",_SgmntfY_._searchInputActivateHandler)}),_SgmntfY_._getJq()(document).on("click","#sgm-mobile-input input",_SgmntfY_._searchInputActivateHandler)):(_SgmntfY_.LOG_MESSAGE("WARN","search input element could not found while loading the script"),_SgmntfY_._getJq()(document).on("click",_SgmntfY_._variables.search.input+", #sgm-mobile-input input",_SgmntfY_._searchInputActivateHandler)):e&&e.length?(e.forEach(function(e){e.addEventListener("focus",_SgmntfY_._searchInputActivateHandler)}),_SgmntfY_._getJq()(document).on("focus","#sgm-mobile-input input",_SgmntfY_._searchInputActivateHandler)):(_SgmntfY_.LOG_MESSAGE("WARN","search input element could not found while loading the script"),_SgmntfY_._getJq()(document).on("focus",_SgmntfY_._variables.search.input+", #sgm-mobile-input input",_SgmntfY_._searchInputActivateHandler))},_searchGetInputElement:function(){return _SgmntfY_._getJq()(_SgmntfY_._variables.search.input,_SgmntfY_._variables.search.activeRootElement)},_searchGetManuelTriggerElementForDesktop:function(){return _SgmntfY_._getJq()(_SgmntfY_._variables.search.manuelTriggerDesktop,_SgmntfY_._variables.search.activeRootElementForTrigger)},_searchGetManuelTriggerElementForMobile:function(){return _SgmntfY_._getJq()(_SgmntfY_._variables.search.manuelTrigger,_SgmntfY_._variables.search.activeRootElementForTrigger)},_initSearch:function(){_SgmntfY_._disableSearchTriggerEventsOnSite(),_SgmntfY_._activateSgmSearchTriggerEvents(),_SgmntfY_._getJq().each(_SgmntfY_._searchGetInputElement(),function(e){if(this===_SgmntfY_._variables.search.activeRootElement.activeElement)return _SgmntfY_._searchInputActivateHandler({target:this}),!1});var e=_SgmntfY_._variables.search.activeRootElement.querySelectorAll(_SgmntfY_._variables.search.input);if(e&&e.length>0?(e.forEach(function(e){e.addEventListener("input",n),e.addEventListener("blur",r)}),_SgmntfY_._getJq()(document).on("input","#sgm-mobile-input input",n),_SgmntfY_._getJq()(document).on("blur","#sgm-mobile-input input",r)):(_SgmntfY_.LOG_MESSAGE("WARN","search input element could not found while loading the script"),_SgmntfY_._getJq()(document).on("input",_SgmntfY_._variables.search.input+", #sgm-mobile-input input",n),_SgmntfY_._getJq()(document).on("blur",_SgmntfY_._variables.search.input+", #sgm-mobile-input input",r)),_SgmntfY_._getActiveSearchManuelTrigger()){var t=_SgmntfY_._variables.search.activeRootElementForTrigger.querySelectorAll(_SgmntfY_._getActiveSearchManuelTrigger());t&&t.length?t.forEach(function(e){e.addEventListener("click",a)}):(_SgmntfY_.LOG_MESSAGE("WARN","search manuel trigger element could not found while binding the event"),_SgmntfY_._getJq()(document).on("click",_SgmntfY_._getActiveSearchManuelTrigger(),a))}function n(e){_SgmntfY_._variables.search.currentActiveInput=e.target;var t=_SgmntfY_._variables.search.currentActiveInput.value;_SgmntfY_._getJq()(_SgmntfY_._variables.search.currentActiveInput).not("#sgm-mobile-input input").attr("value",t),_SgmntfY_._variables.search.keywordSearch=t.length>=_SgmntfY_._variables.search.searchMinChar,_SgmntfY_._variables.search.emptySearch=0===t.length||t.length<_SgmntfY_._variables.search.searchMinChar,!0!==_SgmntfY_._variables.search.emptySearch&&!0!==_SgmntfY_._variables.search.keywordSearch||_SgmntfY_._sendSearchRequest()}function a(){0===_SgmntfY_._getJq()(".seg-search-wrapper").length&&_SgmntfY_._getJq()("<div/>",{class:"seg-search-wrapper"}).appendTo("body");_SgmntfY_._variables.search.emptySearch=!0,_SgmntfY_._variables.search.keywordSearch=!1,_SgmntfY_._sendSearchRequest(!0)}function r(){_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("keyboard-on"),_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("sgm-search-keyboard-on"),_SgmntfY_._searchGetInputElement().removeAttr("readonly")}_SgmntfY_._evalSearchBodyScrollLockPreJs()},_sendSearchRequest:function(e){var t="";_SgmntfY_._variables.search.manuelTriggerClicked=!1,e?_SgmntfY_._variables.search.manuelTriggerClicked=!0:t=_SgmntfY_._variables.search.currentActiveInput&&_SgmntfY_._variables.search.currentActiveInput.value&&_SgmntfY_._variables.search.currentActiveInput.value.trim();try{_SgmntfY_._variables.search.searchTimer&&clearTimeout(_SgmntfY_._variables.search.searchTimer)}catch(e){}_SgmntfY_._variables.search.searchTimer=setTimeout(function(){!0===_SgmntfY_._variables.search.emptySearch&&_SgmntfY_._variables.segmentifyObj("search",{query:""});!0===_SgmntfY_._variables.search.keywordSearch&&t.length>=_SgmntfY_._variables.search.searchMinChar&&_SgmntfY_._variables.segmentifyObj("search",{query:_SgmntfY_._prepareSearchQuery(t)})},_SgmntfY_._variables.search.searchDelay)},_triggerSearch:function(e){if(!0===_SgmntfY_._variables.search.isExecutable||!0===_SgmntfY_._variables.search.isExecutableForAfter){var t=e&&e.searchText;if(!t)return void _SgmntfY_.LOG_MESSAGE("WARN","searchText is mandatory field to trigger search");var n={delay:0,isManuelTriggered:!1,inputSelector:_SgmntfY_._variables.search.input,manuelTrigger:_SgmntfY_._getActiveSearchManuelTrigger()},a=_SgmntfY_._getCopiedObject(n,e);setTimeout(function(){var e=_SgmntfY_._getJq()(a.inputSelector);e&&e.length>0&&(_SgmntfY_._variables.search.currentActiveInput=e[0],_SgmntfY_._variables.search.currentActiveInput.value=t,_SgmntfY_._getJq()(_SgmntfY_._variables.search.currentActiveInput,_SgmntfY_._variables.search.activeRootElement).click(),_SgmntfY_._getJq()(_SgmntfY_._variables.search.currentActiveInput,_SgmntfY_._variables.search.activeRootElement).focus(),!0===a.isManuelTriggered&&a.manuelTrigger?_SgmntfY_._getJq()(a.manuelTrigger).click():_SgmntfY_._sendSearchRequest())},a.delay)}else _SgmntfY_.LOG_MESSAGE("WARN","search is not executable to trigger search")},_prepareSearchQuery:function(e){return e},_searchResultHandler:function(request,searchResult){var searchArray=searchResult[0],campaign=searchArray.campaign,products=searchArray.products||[],brands=searchArray.brands||{},brandProducts=searchArray.brandProducts||{},categories=searchArray.categories||{},categoryProducts=searchArray.categoryProducts||{},mostSearchedProducts=searchArray.mostSearchedProducts||{},keywords=searchArray.keywords||{},meta=searchArray.meta||{},additionalContents=searchArray.contents||[],banners=searchArray.banners||[],lastSearches=searchArray.lastSearches||[],meanings=searchArray.meanings||[],noResultSearch=searchArray.noResult||{},isProductsFound=products.length>0,redirectUrl=searchArray.redirectUrl||{},isBigScreen=sessionStorage.getItem("isBigScreen");if(null!=campaign){if(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:"static",instanceId:campaign.instanceId}),(null!==products&&products.length>0||null!==noResultSearch&&null!==noResultSearch.recommendedProducts&&noResultSearch.recommendedProducts.length>0)&&_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:"static",instanceId:campaign.instanceId}),_SgmntfY_._variables.search.emptySearch="BEFORE_SEARCH"===campaign.instanceId,_SgmntfY_._variables.search.keywordSearch="SEARCH"===campaign.instanceId,_SgmntfY_._variables.search.forceRemoveInputVal=campaign.forceRemoveInputVal,sgmSearchSettings={data:{},mobileInput:"#sgm-mobile-input",searchResultsEl:".seg-search-wrapper",incremental:searchArray.incremental,searchUrlPrefix:campaign.searchUrlPrefix,instanceId:campaign.instanceId,html:campaign.html,postJs:campaign.postJs,preJs:campaign.preJs,css:campaign.css,openingDirection:campaign.openingDirection,input:campaign.searchInputSelector,forceRemoveInputVal:campaign.forceRemoveInputVal,currentSearchBoxEl:campaign.hideCurrentSelector,searchAssets:campaign.searchAssets||[],mobileSearchAssets:campaign.mobileSearchAssets||[],searchAssetsTexts:campaign.stringSearchAssetTextMap||[],categoryTreeView:!1,manuelTrigger:campaign.triggerSelector,sgmSearchShowAll:!1,resultsTopMargin:{mobile:0,desktop:0},searchHistoryClearSettings:{clearQueryBasedEnabled:!1,clearButtonEnabled:!1,clearButtonText:""},isSidebarItemsClickable:{categories:!1,brands:!1,keywords:!1,lastSearches:!1},highlightEnabled:{categories:!1,brands:!1,keywords:!1},itemLimits:{howManyBrand:0,howManyCategory:0,howManyKeyword:0,howManyDesktopProduct:campaign.desktopItemCount,howManyMobileProduct:campaign.mobileItemCount},itemEnable:{category:!1,brand:!1,keyword:!1,lastSearches:!1},sidebar:{mobile:!1,desktop:!0},texts:{categories:"",popularCategories:"",brands:"",popularBrands:"",keywords:"",products:"",showAll:"Show All",currency:"",notFound:"",cancelText:""}},-1===sgmSearchSettings.input.indexOf(",input#sgm-qa-search")&&(sgmSearchSettings.input=sgmSearchSettings.input+",input#sgm-qa-search"),_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth&&0===sgmSearchSettings.mobileSearchAssets.length&&(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("no-sidebar"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-no-sidebar")),0===_SgmntfY_._getJq()("#sgm_current_search_box").length){var siteSearchBoxSelector=_SgmntfY_._variables.search.activeRootElementForHide;_SgmntfY_._variables.search.activeRootElementForHide===document&&(siteSearchBoxSelector="head"),_SgmntfY_._getJq()(siteSearchBoxSelector).append('<style id="sgm_current_search_box">'+sgmSearchSettings.currentSearchBoxEl+" { display: none!important; position: absolute!important; left: -999999px!important; top: -99999999px!important; visibility: hidden!important; opacity: 0!important }</style>")}_SgmntfY_._variables.search.searchDelay=campaign.searchDelay>50?campaign.searchDelay:50,_SgmntfY_._variables.search.searchMinChar=campaign.minCharacterCount,sgmSearchSettings.texts.showAll=_SgmntfY_._variables.search.showAll;var searchAssetElements=_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth?sgmSearchSettings.mobileSearchAssets:sgmSearchSettings.searchAssets;_SgmntfY_._getJq().each(searchAssetElements,function(e,t){"CATEGORY"===t.type?(sgmSearchSettings.categoryTreeView=t.categoryTreeView,sgmSearchSettings.isSidebarItemsClickable.categories=t.clickable,sgmSearchSettings.itemLimits.howManyCategory=t.itemCount,sgmSearchSettings.itemEnable.category=!0,sgmSearchSettings.highlightEnabled.categories=t.highlight):"BRAND"===t.type?(sgmSearchSettings.isSidebarItemsClickable.brands=t.clickable,sgmSearchSettings.itemLimits.howManyBrand=t.itemCount,sgmSearchSettings.itemEnable.brand=!0,sgmSearchSettings.highlightEnabled.brands=t.highlight):"KEYWORD"===t.type?(sgmSearchSettings.isSidebarItemsClickable.keywords=t.clickable,sgmSearchSettings.itemLimits.howManyKeyword=t.itemCount,sgmSearchSettings.itemEnable.keyword=!0,sgmSearchSettings.highlightEnabled.keywords=t.highlight):"LAST_SEARCHES"===t.type&&(sgmSearchSettings.itemLimits.howManyKeyword=t.itemCount,sgmSearchSettings.itemEnable.lastSearches=!0,sgmSearchSettings.isSidebarItemsClickable.lastSearches=t.clickable,sgmSearchSettings.searchHistoryClearSettings.clearButtonText=t.clearButtonText,sgmSearchSettings.searchHistoryClearSettings.clearButtonEnabled=t.clearButtonEnabled,sgmSearchSettings.searchHistoryClearSettings.clearQueryBasedEnabled=t.clearQueryBasedEnabled)});var currentDeviceIsPC="PC"===(_SgmntfY_._variables.ua.type||"PC").toUpperCase();_SgmntfY_._getJq().each(sgmSearchSettings.searchAssetsTexts,function(e,t){e===request.data.lang&&(sgmSearchSettings.texts.categories=t.categoriesText,sgmSearchSettings.texts.popularCategories=currentDeviceIsPC?t.popularCategoriesText:t.mobilePopularCategoriesText,sgmSearchSettings.texts.brands=t.brandsText,sgmSearchSettings.texts.popularBrands=currentDeviceIsPC?t.popularBrandsText:t.mobilePopularBrandsText,sgmSearchSettings.texts.popularProducts=t.popularProductsText,sgmSearchSettings.texts.products=t.popularProductsText,sgmSearchSettings.texts.keywords=currentDeviceIsPC?t.popularKeywordsText:t.mobilePopularKeywordsText,sgmSearchSettings.texts.lastSearchesText=t.lastSearchesText,sgmSearchSettings.texts.cancelText=t.mobileCancelText,sgmSearchSettings.texts.notFound=t.notFoundText)}),sgmSearchSettings.data.categories=_SgmntfY_._getArrayOfMap(categories),sgmSearchSettings.data.brands=_SgmntfY_._getArrayOfMap(brands),sgmSearchSettings.data.keywords=_SgmntfY_._getArrayOfKeywordsMap(keywords),sgmSearchSettings.data.texts=sgmSearchSettings.texts,products.length?sgmSearchSettings.data.products=_SgmntfY_._getArrayOfProductMap(products):null!==noResultSearch&&null!==noResultSearch.recommendedProducts&&noResultSearch.recommendedProducts.length>0&&(sgmSearchSettings.data.products=_SgmntfY_._getArrayOfProductMap(noResultSearch.recommendedProducts),sgmSearchSettings.data.texts.products=noResultSearch.text),sgmSearchSettings.data.meta=meta,sgmSearchSettings.data.keywordsProducts=keywords,sgmSearchSettings.data.categoryProducts=categoryProducts,sgmSearchSettings.data.mostSearchedProducts=mostSearchedProducts,sgmSearchSettings.data.brandProducts=brandProducts,sgmSearchSettings.data.itemEnable=sgmSearchSettings.itemEnable,sgmSearchSettings.data.synonyms=searchArray.synonyms,sgmSearchSettings.data.additionalContents=additionalContents,sgmSearchSettings.data.banners=banners.slice(0,5),sgmSearchSettings.data.lastSearches=lastSearches,sgmSearchSettings.data.meanings=meanings,sgmSearchSettings.data.request=request,sgmSearchSettings.data.redirectUrl=redirectUrl,sgmSearchSettings.data.searchHistoryClearSettings=sgmSearchSettings.searchHistoryClearSettings;try{if(sgmSearchSettings.preJs){eval(sgmSearchSettings.preJs);var retVal=preRenderConf(sgmSearchSettings);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product search pre js code: "+e)}_SgmntfY_._populateSearchResults(sgmSearchSettings.data,null,!0),isProductsFound||(addNoResultIcon(),noResultStyle()),_SgmntfY_._getJq()(document).on("submit",sgmSearchSettings.searchResultsEl+" form",function(e){e.preventDefault(),_SgmntfY_._goToSearchResultPage()}),_SgmntfY_._getJq()(document).on("click",".sgm-search-sidebar ul li",function(){var e=_SgmntfY_._getJq()(this).parent("ul").data("group");!0===sgmSearchSettings.isSidebarItemsClickable[e]&&((_SgmntfY_._getJq()(this).attr("data-url")||"")&&(window.location.href=_SgmntfY_._getJq()(this).attr("data-url"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("open"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-open")))}),_SgmntfY_._getJq()(document).on("mouseover",".sgm-search-sidebar li",function(){var e=_SgmntfY_._getJq()(this).data("original"),t=function(){var e=document.querySelector(".sgm-search-sidebar li.selected");if(e&&e.dataset&&e.dataset.original)return e.dataset.original.toString();return""}();if(_SgmntfY_._getJq()(window).width()>=_SgmntfY_._variables.search.maxMobileWidth&&e!=t){var n=_SgmntfY_._getJq()(this).parent("ul").data("group");_SgmntfY_._getJq()(".sgm-search-sidebar li.selected").removeClass("selected"),_SgmntfY_._getJq()(".sgm-search-sidebar li.sgm-search-selected").removeClass("sgm-search-selected"),_SgmntfY_._getJq()(this).addClass("selected"),_SgmntfY_._getJq()(this).addClass("sgm-search-selected");var a={};"keywords"===n?a=sgmSearchSettings.data.keywordsProducts:"categories"===n?a=sgmSearchSettings.data.categoryProducts:"brands"===n&&(a=sgmSearchSettings.data.brandProducts),_SgmntfY_._getJq().each(a,function(t,n){if(t&&e&&t.toString()===e.toString()){var a={};a.products=_SgmntfY_._getArrayOfProductMap(n),_SgmntfY_._populateSearchResults(a,"products")}}),_SgmntfY_._getJq()(".sgm-search-products-title").html(_SgmntfY_._getJq()(this).text())}}),_SgmntfY_._getJq()(window).on("load resize scroll orientationchange",onChangeWindowOrOrientation),_SgmntfY_._getJq()(document).on("click","#sgm-mobile-input-cancel",_SgmntfY_.mobileSearchCancel),_SgmntfY_._getJq()(document).on("click",".sgm-search-show-all",function(e){document.location=sgmSearchSettings.searchUrlPrefix+_SgmntfY_._variables.search.currentActiveInput.value.trim()}),"1"!==isBigScreen&&(_SgmntfY_._getJq()(document).on("click","*",onCloseSearchResult),_SgmntfY_._getJq()(".sgm-search-wrapper").addClass("seg-infinit-z-index"))}function onChangeWindowOrOrientation(e){_SgmntfY_._setSearchResultsPosition(),_SgmntfY_._openSearchResults(),_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth?(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-mobile"),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-ios-device")):(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-ios-device"))}function onCloseSearchResult(e){try{if(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).hasClass("open")||_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).hasClass("sgm-search-open")){var t=_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl),n=_SgmntfY_._getJq()(sgmSearchSettings.input,_SgmntfY_._variables.search.activeRootElement);if(!t.is(e.target)&&0===t.has(e.target).length&&!_SgmntfY_._getJq()(n).is(_SgmntfY_._variables.search.activeRootElement.activeElement)||"sgm-mobile-input-cancel"===_SgmntfY_._getJq()(e.target).attr("id")){var a=document.querySelector(sgmSearchSettings.searchResultsEl);bodyScrollLock.enableBodyScroll(a),_SgmntfY_._getJq()(".seg-search-wrapper").remove(),_SgmntfY_._variables.search.manuelTriggerClicked=!1}}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in document click: "+e)}}function addNoResultIcon(){try{var e=(new DOMParser).parseFromString('\n            <svg width="42" height="42" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <path d="M16.9765 0.398438C7.84221 0.398438 0.399597 7.84034 0.399597 16.9753C0.399597 26.1096 7.8415 33.5522 16.9765 33.5522C20.9273 33.5522 24.5561 32.1554 27.4087 29.8368L38.626 41.0542C39.2957 41.7239 40.3857 41.7239 41.0554 41.0542C41.725 40.3846 41.725 39.3125 41.0554 38.6428L29.838 27.4254C32.1613 24.5715 33.5534 20.9309 33.5534 16.976C33.5534 7.84176 26.1115 0.399146 16.9765 0.399146V0.398438ZM16.9765 3.82785C24.2576 3.82785 30.1233 9.69351 30.1233 16.9746C30.1233 24.2557 24.2576 30.1214 16.9765 30.1214C9.69538 30.1214 3.82972 24.2557 3.82972 16.9746C3.82972 9.69351 9.69538 3.82785 16.9765 3.82785Z" fill="#999999"/>\n            </svg>',"text/html").getElementsByTagName("svg")[0],t=document.createElement("br"),n=document.querySelector(".sgm-search-products-title-container");n.prepend(t),n.prepend(e),n.style["text-align"]="center",n.style["margin-bottom"]="8px"}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in adding no search result icon in after search: ",+e)}}function noResultStyle(){var e=_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl);e.find("ul a").css("width","calc(50% - 6px)"),e.find("ul a:nth-child(odd)").css("margin-right","10px"),e.find("ul a:nth-child(even)").css("margin-right","unset"),e.find("hr").css("background-color","transparent")}},_getArrayOfMap:function(e){var t=[],n=0;return _SgmntfY_._getJq().each(e,function(e,a){t[n]={name:e,url:a},n+=1}),t},_populateSearchResults:function(data,type,openResultsFlag){data.emptySearch=_SgmntfY_._variables.search.emptySearch,data.keywordSearch=_SgmntfY_._variables.search.keywordSearch;var productsTemplate=null,domparser=new DOMParser,template,rendered;try{productsTemplate=domparser.parseFromString(sgmSearchSettings.html,"text/html").getElementById("sgm-search-product-template")}catch(e){return void _SgmntfY_.LOG_MESSAGE("WARN","Error in html parsing for id: sgm-search-product-template: "+e)}var tempSgmSearchSettingsData=_SgmntfY_._getCopiedObject(data);if(_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth?tempSgmSearchSettingsData.products=data.products.slice(0,sgmSearchSettings.itemLimits.howManyMobileProduct):tempSgmSearchSettingsData.products=data.products.slice(0,sgmSearchSettings.itemLimits.howManyDesktopProduct),"products"===type)rendered=_SgmntfY_._getMustache().render(productsTemplate.innerHTML,tempSgmSearchSettingsData),_SgmntfY_._fillSearchResults(rendered,"products");else{if(0===_SgmntfY_._getJq()(".sgm-search-sidebar").length)try{template=domparser.parseFromString(sgmSearchSettings.html,"text/html").getElementById("sgm-search-template"),template&&(template=_SgmntfY_._decodeHtml(template.innerHTML),rendered=_SgmntfY_._getMustache().render(template,tempSgmSearchSettingsData,{products:productsTemplate.innerHTML}),_SgmntfY_._fillSearchResults(rendered))}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in html parsing for id: sgm-search-template: "+e)}else getTemplateAndFillSearchResult("sgm-search-sidebar"),getTemplateAndFillSearchResult("sgm-search-header"),getTemplateAndFillSearchResult("sgm-search-products");1===_SgmntfY_._getJq()(".sgm-search-sidebar").length&&(rendered=_SgmntfY_._getMustache().render(productsTemplate.innerHTML,tempSgmSearchSettingsData),_SgmntfY_._fillSearchResults(rendered,"products"))}if(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).find(".sgm-search-sidebar").find("li").each(function(){var e=_SgmntfY_._getJq()(this).text();e=_SgmntfY_._prepareSearchAssetText(e);var t="";_SgmntfY_._variables.search.currentActiveInput&&_SgmntfY_._variables.search.currentActiveInput.value&&(t=_SgmntfY_._variables.search.currentActiveInput.value.trim());var n=this.parentElement.getAttribute("data-group"),a=sgmSearchSettings.data.synonyms||[];0===a.length&&a.push(t),_SgmntfY_._getJq()(window).width()>=_SgmntfY_._variables.search.maxMobileWidth&&t&&""!==t&&("categories"===n&&sgmSearchSettings.highlightEnabled.categories?e=_SgmntfY_._highlight(a,e):"brands"===n&&sgmSearchSettings.highlightEnabled.brands?e=_SgmntfY_._highlight(a,e):"keywords"===n&&sgmSearchSettings.highlightEnabled.keywords&&(e=_SgmntfY_._highlight(a,e))),_SgmntfY_._getJq()(this).html(e)}),_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth){var newFormWrapper='<form action="/"></form>',newInputWrapper='<div id="sgm-mobile-input"></div>';if(0===_SgmntfY_._getJq()("#sgm-mobile-input").length){var currentInputClone=_SgmntfY_._getJq()("<input type='search' name='search' autocomplete='OFF'>");currentInputClone.insertBefore(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).children(".sgm-search-header")).wrap(newInputWrapper).wrap(newFormWrapper),_SgmntfY_._getJq()("#sgm-mobile-input").append('<div id="sgm-mobile-input-clear"></div><div id="sgm-mobile-input-cancel">'+sgmSearchSettings.texts.cancelText+"</div>");var sgmMobileInput=_SgmntfY_._getJq()("#sgm-mobile-input input");sgmMobileInput&&sgmMobileInput.length>0&&(_SgmntfY_._variables.search.currentActiveInput||(_SgmntfY_._variables.search.currentActiveInput=sgmMobileInput[0]),setTimeout(function(){sgmMobileInput.val(_SgmntfY_._variables.search.currentActiveInput.value).focus(),_SgmntfY_._variables.search.currentActiveInput=sgmMobileInput[0],_SgmntfY_._searchGetInputElement().not("#sgm-mobile-input input").attr("readonly","readonly")},10))}}function getTemplateAndFillSearchResult(e){try{var t=domparser.parseFromString(sgmSearchSettings.html,"text/html").getElementsByClassName(e)[0];t&&(t=_SgmntfY_._decodeHtml(t.innerHTML),rendered=_SgmntfY_._getMustache().render(t,tempSgmSearchSettingsData,{products:productsTemplate.innerHTML}),_SgmntfY_._fillSearchResults(rendered,e))}catch(t){_SgmntfY_.LOG_MESSAGE("WARN","Error in parsing html for  "+e+" in search "+t)}}function applyPostProcess(){try{var sgmSearchStyleId="sgmStyle"+sgmSearchSettings.instanceId,sgmStyleElement=document.getElementById(sgmSearchStyleId);null!==sgmStyleElement&&sgmSearchSettings.css?sgmStyleElement.innerHTML=sgmSearchSettings.css:sgmSearchSettings.css&&_SgmntfY_._getJq()('<style id="'+sgmSearchStyleId+'" />').html(sgmSearchSettings.css).prependTo(_SgmntfY_._getJq()("body")),sgmSearchSettings.postJs&&eval(sgmSearchSettings.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product SEARCH post js or css code: "+e)}}!0===openResultsFlag&&(_SgmntfY_._openSearchResults(!0),_SgmntfY_._searchFillAdditionalContents(),_SgmntfY_._searchFillBanners(sgmSearchSettings.data.banners)),applyPostProcess()},_searchResetAdditionalContents:function(){_SgmntfY_._getJq()(".seg-search-wrapper div[data-sgm-ac-position^=searchbox]").each(function(e,t){_SgmntfY_._getJq()(t).html("")})},_searchFillAdditionalContents:function(){if(_SgmntfY_._searchResetAdditionalContents(),sgmSearchSettings.data.additionalContents)for(var e=0;e<sgmSearchSettings.data.additionalContents.length;e++){var t=sgmSearchSettings.data.additionalContents[e];_SgmntfY_._getJq()(".seg-search-wrapper div[data-sgm-ac-position="+t.key+"]").html(t.html)}},_searchResetBanners:function(){_SgmntfY_._getJq()(".seg-search-wrapper .seg-search-banner").each(function(e,t){_SgmntfY_._getJq()(t).html("")})},_searchRenderBanner:function(e){var t=document.querySelector('[seg-search-banner-position="'+e.position+'"]');if(null===t){var n=_SgmntfY_._variables.search.bannerTargets;(t=document.createElement("div")).classList.add("seg-search-banner-position"),t.setAttribute("seg-search-banner-position",e.position),"ASSETS_HEADER"===e.position||"RESULTS_HEADER"===e.position?_SgmntfY_._getJq()(n[e.position]).prepend(t):_SgmntfY_._getJq()(n[e.position]).append(t)}var a=document.createElement("div");a.classList.add("seg-search-banner"),a.style.width=e.width||"100%",a.style.height=e.height||"auto",t.appendChild(a);var r=document.createElement("a");r.classList.add("seg-search-banner__anchor"),r.href=e.targetUrl,!0===e.newtab&&(r.target="_blank"),a.appendChild(r);var i=document.createElement("img");i.classList.add("seg-search-banner__image"),i.alt=e.name,i.src=e.bannerUrl,i.style.width="100%",i.style.height=e.height||"auto",r.appendChild(i)},_searchFillBanners:function(e){try{if(_SgmntfY_._searchResetBanners(),e)for(var t=0;t<e.length;t++){var n=e[t];_SgmntfY_._searchRenderBanner(n),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:_SgmntfY_._getQueryParameter("_sgm_source",n.targetUrl),instanceId:_SgmntfY_._getQueryParameter("_sgm_campaign",n.targetUrl)})}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling searchbox banners."+e)}},_prepareSearchAssetText:function(e){return e=!1===sgmSearchSettings.categoryTreeView?(e=e.replace(/>/g,"/").toLocaleLowerCase(_SgmntfY_._variables.language).split("/"))[e.length-1]:e.replace(/>/g,"/").toLocaleLowerCase(_SgmntfY_._variables.language),e=e.toLowerCase().split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.substring(1)}).join(" ")},mobileSearchCancel:function(e){e.stopImmediatePropagation();var t=document.querySelector(".seg-search-wrapper");bodyScrollLock.enableBodyScroll(t),_SgmntfY_._getJq()("body, .wrapper-1").removeClass("noscroll"),_SgmntfY_._getJq()(".seg-search-wrapper").remove(),_SgmntfY_._searchGetInputElement().val(""),_SgmntfY_._variables.search.manuelTriggerClicked=!1},_goToSearchResultPage:function(){return _SgmntfY_._variables.search.currentActiveInput.value.trim().length>0&&(window.location.href=sgmSearchSettings.searchUrlPrefix+encodeURIComponent(_SgmntfY_._variables.search.currentActiveInput.value.trim())),!1},_highlight:function(e,t){return e.forEach(function(e){var n=e.toLocaleLowerCase(_SgmntfY_._variables.language),a=new RegExp(n,"ig");t=t.replace(a,"<span class='sgm-search-keyword-highlight'>$&</span>")}),t},_openSearchResults:function(e){_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).hasClass("mobile")||_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).hasClass("sgm-search-mobile"),0===_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).find(".sgm-search-sidebar li").length?(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("no-sidebar"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-no-sidebar")):(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("no-sidebar"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-no-sidebar")),0===_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).find(".sgm-search-products li").length?(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("no-products"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-no-products")):(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("no-products"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-no-products")),!0===sgmSearchSettings.isSidebarItemsClickable.categories&&_SgmntfY_._getJq()(".sgm-search-sidebar ul[data-group=categories] li").addClass("sgm-cursor-pointer"),!0===sgmSearchSettings.isSidebarItemsClickable.brands&&_SgmntfY_._getJq()(".sgm-search-sidebar ul[data-group=brands] li").addClass("sgm-cursor-pointer"),!0===sgmSearchSettings.isSidebarItemsClickable.keywords&&_SgmntfY_._getJq()(".sgm-search-sidebar ul[data-group=keywords] li").addClass("sgm-cursor-pointer"),!1===sgmSearchSettings.sgmSearchShowAll&&(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("no-show-all"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-no-show-all")),!0===_SgmntfY_._variables.search.manuelTriggerClicked?(_SgmntfY_._disableBodyScrollAndAddOpen(e),_SgmntfY_._variables.search.manuelTriggerClicked=!1):_SgmntfY_._getJq().each(_SgmntfY_._getJq()(sgmSearchSettings.input,_SgmntfY_._variables.search.activeRootElement),function(){if(_SgmntfY_._getJq()(this).is(":focus"))return _SgmntfY_._disableBodyScrollAndAddOpen(e),!1})},_disableBodyScrollAndAddOpen:function(e){if(_SgmntfY_._setSearchResultsPosition(),e&&(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("open"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-open"),_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth)){var t=document.querySelector(".seg-search-wrapper");t&&bodyScrollLock.disableBodyScroll(t),0===sgmSearchSettings.mobileSearchAssets.length&&(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("no-sidebar"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-no-sidebar"))}},_setSearchProductCategory:function(e,t){if(t.category&&t.category.length>0){if(!1===sgmSearchSettings.categoryTreeView){var n=t.category[0].replace(/>/g,"/").toLocaleLowerCase(_SgmntfY_._variables.language);n=(n=n.split("/"))[n.length-1],e.category=n}else e.category=t.category[0].replace(/>/g,"/").toLocaleLowerCase(_SgmntfY_._variables.language);e["categories-original"]=t.category[0],!0===sgmSearchSettings.incremental&&(e["categories-original"]=[],_SgmntfY_._getJq().each(t.category,function(t,n){e["categories-original"].push(n)}))}},_getArrayOfProductMap:function(e){var t=[];return Array.isArray(e)&&e.forEach(function(e){var n={};_SgmntfY_._getJq().extend(n,e),n.name=_SgmntfY_._decodeHtml(e.name),_SgmntfY_._setSearchProductCategory(n,e),n.brand&&(n.brand=e.brand.toLocaleLowerCase(_SgmntfY_._variables.language),n["brands-original"]=e.brand);t.push(n)}),t},_getArrayOfKeywordsMap:function(e){var t=[],n=0;return _SgmntfY_._getJq().each(e,function(e,a){t[n]={name:e,url:sgmSearchSettings.searchUrlPrefix+e},n+=1}),t},_fillSearchResults:function(e,t){try{0===_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).length?_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).html(e):"products"===t?_SgmntfY_._getJq()(".sgm-search-products ul").html(e):0===_SgmntfY_._getJq()(".sgm-search-sidebar").length?_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).html(e):"sgm-search-sidebar"===t?_SgmntfY_._getJq()(".sgm-search-sidebar").html(e):"sgm-search-header"===t?_SgmntfY_._getJq()(".sgm-search-header").html(e):"sgm-search-products"===t&&_SgmntfY_._getJq()(".sgm-search-products").html(e)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling target element["+t+"] with product recommendations: "+e)}},_setSearchResultsPosition:function(){if(_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth){var e=.01*_SgmntfY_._getJq()(window).innerHeight();document.documentElement.style.setProperty("--vh",e+"px"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-mobile"),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-ios-device")}else{_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-ios-device");var t=0|Date.now();_SgmntfY_._setSearchPositionInterval(),_SgmntfY_._renderOnNextTick(_SgmntfY_._setSearchPositionInterval,t,3e3)}},_renderOnNextTick:function(e,t,n){(0|Date.now())-t<n&&requestAnimationFrame(function(){requestAnimationFrame(e),requestAnimationFrame(function(){_SgmntfY_._renderOnNextTick(e,t,n)})})},_setSearchPositionInterval:function(){if(!(_SgmntfY_._getJq()(window).width()>_SgmntfY_._variables.search.maxMobileWidth&&(_SgmntfY_._getJq()(".seg-search-wrapper").hasClass("no-products")||_SgmntfY_._getJq()(".seg-search-wrapper").hasClass("sgm-search-no-products")))){var e=sgmSearchSettings.openingDirection.toLowerCase(),t=!1,n=!1,a=!1;if(_SgmntfY_._getJq()(_SgmntfY_._variables.search.currentActiveInput,_SgmntfY_._variables.search.activeRootElement).parents().not("body").not("html").each(function(e,r){return"fixed"===_SgmntfY_._getJq()(r).css("position")?(t=!0,!1):"static"===_SgmntfY_._getJq()(r).css("position")?(n=!0,!1):"none"===_SgmntfY_._getJq()(r).css("display")?(a=!0,_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("open"),_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("sgm-search-open"),!1):void 0}),!1===a){!0===t?(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("seg-position-absolute"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("seg-position-fixed")):!0===n?(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("seg-position-absolute"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("seg-position-fixed")):(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("seg-position-absolute"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("seg-position-absolute"));var r=_SgmntfY_._variables.search.currentActiveInput.getBoundingClientRect(),i={top:"",left:""};if(void 0===r)return;if(r.top!==i.top){var s=_SgmntfY_._getJq()(_SgmntfY_._variables.search.currentActiveInput,_SgmntfY_._variables.search.activeRootElement).outerHeight();_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).css("top",r.top+s+1),i.top=r.top}if(r.left!==i.left){var o=_SgmntfY_._getJq()(window).width(),c=_SgmntfY_._getJq()(_SgmntfY_._variables.search.currentActiveInput,_SgmntfY_._variables.search.activeRootElement).parent().outerWidth(),g=_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).outerWidth(),_={right:r.left,center:r.left-g/2+c/2,left:r.left+c-g};"right"===e?_[e]+g>=o&&(_[e]=_.center):"left"===e&&_[e]<=0&&(_[e]=_.center),_[e]===_.center&&(_.center<=0||_.center+g>=o)&&(_[e]=o/2-g/2),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).css("left",_[e])}i=r}}},_evalSearchBodyScrollLockPreJs:function(){var e;(function(e){"use strict";function t(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(e,"__esModule",{value:!0});var n=!1;if("undefined"!=typeof window){var a={get passive(){n=!0}};window.addEventListener("testPassive",null,a),window.removeEventListener("testPassive",null,a)}var r="undefined"!=typeof window&&window.navigator&&window.navigator.platform&&/iP(ad|hone|od)/.test(window.navigator.platform),i=[],s=!1,o=-1,c=void 0,g=void 0,_=void 0,m=function(e){return i.some(function(t){return!(!t.options.allowTouchMove||!t.options.allowTouchMove(e))})},l=function(e){var t=e||window.event;return!!m(t.target)||t.touches.length>1||(t.preventDefault&&t.preventDefault(),!1)},d=function(){setTimeout(function(){void 0!==_&&(document.body.style.paddingRight=_,_=void 0),void 0!==c&&(document.body.style.overflow=c,c=void 0),void 0!==g&&(_SgmntfY_._getJq()("html").css("overflow",g),g=void 0)})};e.disableBodyScroll=function(e,a){if(r){if(!e)return void console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.");if(e&&!i.some(function(t){return t.targetElement===e})){var d={targetElement:e,options:a||{}};i=[].concat(t(i),[d]),e.ontouchstart=function(e){1===e.targetTouches.length&&(o=e.targetTouches[0].clientY)},e.ontouchmove=function(t){1===t.targetTouches.length&&function(e,t){var n=e.targetTouches[0].clientY-o;!m(e.target)&&(t&&0===t.scrollTop&&n>0?l(e):function(e){return!!e&&e.scrollHeight-e.scrollTop<=e.clientHeight}(t)&&n<0?l(e):e.stopPropagation())}(t,e)},s||(document.addEventListener("touchmove",l,n?{passive:!1}:void 0),s=!0)}}else{!function(e){setTimeout(function(){if(void 0===_){var t=!!e&&!0===e.reserveScrollBarGap,n=window.innerWidth-document.documentElement.clientWidth;t&&n>0&&(_=document.body.style.paddingRight,document.body.style.paddingRight=n+"px")}void 0===c&&(c=document.body.style.overflow,document.body.style.cssText="overflow:hidden !important",_SgmntfY_._getJq()("html").css("overflow","hidden !important")),void 0===g&&(g=_SgmntfY_._getJq()("html").css("overflow"),_SgmntfY_._getJq()("html").css("overflow","hidden"))})}(a);var f={targetElement:e,options:a||{}};i=[].concat(t(i),[f])}},e.clearAllBodyScrollLocks=function(){r?(i.forEach(function(e){e.targetElement.ontouchstart=null,e.targetElement.ontouchmove=null}),s&&(document.removeEventListener("touchmove",l,n?{passive:!1}:void 0),s=!1),i=[],o=-1):(d(),i=[])},e.enableBodyScroll=function(e){if(r){if(!e)return void console.error("enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.");e.ontouchstart=null,e.ontouchmove=null,i=i.filter(function(t){return t.targetElement!==e}),s&&0===i.length&&(document.removeEventListener("touchmove",l,n?{passive:!1}:void 0),s=!1)}else(i=i.filter(function(t){return t.targetElement!==e})).length||d()}})(e={}),window.bodyScrollLock=e},_getCopiedObject:function(){for(var e=Object(),t=0;t<arguments.length;t++)"function"==typeof Object.assign?Object.assign(e,arguments[t]):_SgmntfY_._getJq().extend(e,arguments[t]);return e},_pushInitPermissionCampaign:function(e,t){if(t.safariEnabled&&"Safari"===_SgmntfY_._variables.pushInfo.agent){if("GRANTED"!==_SgmntfY_._variables.pushInfo.subscription&&"DENIED"!==_SgmntfY_._variables.pushInfo.subscription){!function(n){if("denied"===n.permission){if("DENIED"!==_SgmntfY_._variables.pushInfo.subscription)return void fetch(_SgmntfY_._getPushUrl()+"subscription/deny?apiKey="+_SgmntfY_._variables.apiKey+"&userId="+_SgmntfY_._getUserId()+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&browser="+_SgmntfY_._variables.pushInfo.agent+"&device="+_SgmntfY_._variables.ua.type.toUpperCase());_SgmntfY_._variables.pushInfo.promptInteraction="denied"}else"granted"===n.permission?(_SgmntfY_._pushSendSafariSubscription(n,!0),_SgmntfY_._variables.pushInfo.promptInteraction="granted"):(_SgmntfY_._pushRenderHtml(e,t),_SgmntfY_._pushBindClickHandlers(!1,!1),_SgmntfY_._variables.pushInfo.safariEnabled=t.safariEnabled)}(window.safari.pushNotification.permission(_SgmntfY_._variables.pushInfo.safari.webPushId))}}else{var n="Vapid"===_SgmntfY_._variables.pushInfo.permissionMethod,a=_SgmntfY_._variables.pushInfo.isFirebaseCompatible&&"Firebase"===_SgmntfY_._variables.pushInfo.permissionMethod,r=_SgmntfY_._pushShouldShowPopUp(t);_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.getSubscription().then(function(i){i?"GRANTED"!==_SgmntfY_._variables.pushInfo.subscription&&i.unsubscribe().then(function(e){e&&_SgmntfY_._pushRequestPermissionFunc(n,a,!0)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while unsubscribing user: "+e)}):_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.permissionState({userVisibleOnly:!0}).then(function(i){"denied"===i||"DENIED"===i?(_SgmntfY_._variables.pushInfo.promptInteraction="denied",_SgmntfY_.LOG_MESSAGE("WARN","Permission request denied!"),"DENIED"!==_SgmntfY_._variables.pushInfo.subscription&&fetch(_SgmntfY_._getPushUrl()+"subscription/deny?apiKey="+_SgmntfY_._variables.apiKey+"&userId="+_SgmntfY_._getUserId()+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&browser="+_SgmntfY_._variables.pushInfo.agent+"&device="+_SgmntfY_._variables.ua.type.toUpperCase())):"granted"===i||"GRANTED"===i?(_SgmntfY_._variables.pushInfo.promptInteraction="granted","GRANTED"!==_SgmntfY_._variables.pushInfo.subscription&&_SgmntfY_._pushRequestPermissionFunc(n,a,!0)):"prompt"!==i&&"PROMPT"!==i||(_SgmntfY_._variables.pushInfo.promptInteraction="prompt",r?(_SgmntfY_._pushRenderHtml(e,t),_SgmntfY_._pushBindClickHandlers(!0,!1)):_SgmntfY_._pushRequestPermissionFunc(n,a,!1))}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting push permission state, isVapid ["+n+"], isFirebase ["+a+"] "+e),_SgmntfY_._pushFadeUp(1)})}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription, isVapid ["+n+"], isFirebase ["+a+"] "+e),_SgmntfY_._pushFadeUp(1)})}},_pushRequestPermissionFunc:function(e,t,n){e?_SgmntfY_._pushRequestPermissionVapid(n):t&&_SgmntfY_._pushRequestPermission(n)},_pushFadeUp:function(e){_SgmntfY_._getJq()(".seg-popup-push").addClass("seg-fade-up"),window.setTimeout(function(){_SgmntfY_._getJq()(".seg-popup-push").remove()},e)},_pushRenderHtml:function(e,t){var n=_SgmntfY_._getMustache().render(e.html,t);_SgmntfY_._getJq()("body").prepend(n),e.css&&_SgmntfY_._getJq()("<style />").html(e.css).prependTo(_SgmntfY_._getJq()("body")),_SgmntfY_.LOG_MESSAGE("DEBUG","Push Permission appended to html body for campaign("+e.instanceId+")")},_pushBindClickHandlers:function(e,t){_SgmntfY_._getJq()(".seg-popup-push-bttn-later-new").click(function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"push-permission-impression",instanceId:_SgmntfY_._variables.pushInfo.instanceId,interactionId:_SgmntfY_._variables.pushInfo.instanceId}),_SgmntfY_._pushFadeUp(500)}),_SgmntfY_._getJq()(".seg-popup-push-bttn-allow-new").click(function(){if(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"push-permission-impression",instanceId:_SgmntfY_._variables.pushInfo.instanceId,interactionId:_SgmntfY_._variables.pushInfo.instanceId}),_SgmntfY_._pushFadeUp(500),e)if("Firebase"===_SgmntfY_._variables.pushInfo.permissionMethod)_SgmntfY_._variables.pushInfo.messaging.requestPermission().then(function(){_SgmntfY_._pushGetFirebasePermission(t)}).catch(function(e){"messaging/permission-blocked"===e.code?(_SgmntfY_._variables.pushInfo.promptInteraction="denied",_SgmntfY_.LOG_MESSAGE("WARN","Permission requested denied :"+e),"DENIED"!==_SgmntfY_._variables.pushInfo.subscription&&fetch(_SgmntfY_._getPushUrl()+"subscription/deny?apiKey="+_SgmntfY_._variables.apiKey+"&userId="+_SgmntfY_._getUserId()+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&browser="+_SgmntfY_._variables.pushInfo.agent+"&device="+_SgmntfY_._variables.ua.type.toUpperCase())):"messaging/permission-default"===e.code?_SgmntfY_._variables.pushInfo.promptInteraction="close":(_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription details at _pushBindClickHandlers() isFireBase [true]: "+e),_SgmntfY_._pushFadeUp(1))});else if("Vapid"===_SgmntfY_._variables.pushInfo.permissionMethod){var n={userVisibleOnly:!0,applicationServerKey:_SgmntfY_._pushUrlBase64ToUint8Array(_SgmntfY_._variables.pushInfo.vapid.publicKey)};_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.subscribe(n).then(function(e){_SgmntfY_._pushSendSubscription(e,!0,t),_SgmntfY_._variables.pushInfo.promptInteraction="granted"}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription details at _pushBindClickHandlers() isVapid [true]: "+e),_SgmntfY_._pushFadeUp(1),_SgmntfY_._pushSetPromptInteractionForVapid()})}"Safari"===_SgmntfY_._variables.pushInfo.agent&&_SgmntfY_._variables.pushInfo.safariEnabled&&_SgmntfY_._pushGetSafariPermission()})},_pushGetSafariPermission:function(){!function e(t){"default"===t.permission?window.safari.pushNotification.requestPermission(_SgmntfY_._variables.pushInfo.safari.packageUrl,_SgmntfY_._variables.pushInfo.safari.webPushId,{},e):"denied"===t.permission?(_SgmntfY_._variables.pushInfo.promptInteraction="denied","DENIED"!==_SgmntfY_._variables.pushInfo.subscription&&fetch(_SgmntfY_._getPushUrl()+"subscription/deny?apiKey="+_SgmntfY_._variables.apiKey+"&userId="+_SgmntfY_._getUserId()+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&browser="+_SgmntfY_._variables.pushInfo.agent+"&device="+_SgmntfY_._variables.ua.type.toUpperCase())):"granted"===t.permission&&(_SgmntfY_._variables.pushInfo.promptInteraction="granted",_SgmntfY_._pushSendSafariSubscription(t,!1))}(window.safari.pushNotification.permission(_SgmntfY_._variables.pushInfo.safari.webPushId))},_pushShouldShowPopUp:function(e){if(!e.twoStepEnabled)return!1;var t=bowser.name.toLowerCase(),n=parseFloat(bowser.version);return t.indexOf("chrome")>=0&&n>=80||(t.indexOf("firefox")>=0&&n>=72||(t.indexOf("opera")>=0&&n>=67||(t.indexOf("yandex")>=0&&n>=20||t.indexOf("samsung")>=0&&n>=12)))},_pushGetFirebasePermission:function(e){_SgmntfY_._variables.pushInfo.messaging.getToken().then(function(t){t&&_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.getSubscription().then(function(t){_SgmntfY_._pushSendSubscription(t,!1,e)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription details at _pushGetFirebasePermission() : "+e)})}).catch(function(t){t.code&&"messaging/token-unsubscribe-failed"===t.code?_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.getSubscription().then(function(t){_SgmntfY_._pushSendSubscription(t,!1,e)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription details at _pushGetFirebasePermission() : "+e)}):_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription token at _pushGetFirebasePermission() :  "+t)})},_pushRequestPermission:function(e){_SgmntfY_._variables.pushInfo.messaging.requestPermission().then(function(){_SgmntfY_._pushGetFirebasePermission(e)}).catch(function(e){"messaging/permission-blocked"===e.code?(_SgmntfY_._variables.pushInfo.promptInteraction="denied",_SgmntfY_.LOG_MESSAGE("WARN","Permission requested denied :"+e),"DENIED"!==_SgmntfY_._variables.pushInfo.subscription&&fetch(_SgmntfY_._getPushUrl()+"subscription/deny?apiKey="+_SgmntfY_._variables.apiKey+"&userId="+_SgmntfY_._getUserId()+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&browser="+_SgmntfY_._variables.pushInfo.agent+"&device="+_SgmntfY_._variables.ua.type.toUpperCase())):"messaging/permission-default"===e.code?_SgmntfY_._variables.pushInfo.promptInteraction="close":(_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription details at _pushRequestPermission() isFireBase [true]: "+e),_SgmntfY_._pushFadeUp(1))})},_pushRequestPermissionVapid:function(e){var t={userVisibleOnly:!0,applicationServerKey:_SgmntfY_._pushUrlBase64ToUint8Array(_SgmntfY_._variables.pushInfo.vapid.publicKey)};_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.subscribe(t).then(function(t){_SgmntfY_._pushSendSubscription(t,!0,e)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription details at _pushRequestPermissionVapid() : "+e),_SgmntfY_._pushSetPromptInteractionForVapid()})},_pushSendSubscription:function(e,t,n){var a=e.endpoint.split("/").slice(-1)[0],r=e.endpoint.replace(a,"").slice(0,-1),i=e.getKey?e.getKey("auth"):"",s=e.getKey?e.getKey("p256dh"):"",o=_SgmntfY_._getUserId(),c={subscriptionId:a,auth:i?btoa(String.fromCharCode.apply(null,new Uint8Array(i))):"",key:s?btoa(String.fromCharCode.apply(null,new Uint8Array(s))):"",userId:o,agent:_SgmntfY_._variables.pushInfo.agent,endpoint:r,deviceType:_SgmntfY_._variables.ua.type.toUpperCase(),isVapid:t};_SgmntfY_._variables.pushInfo.promptInteraction="granted",_SgmntfY_._pushSendFetchSubscriptionAllowRequest(c,n)},_pushSendSafariSubscription:function(e,t){var n={subscriptionId:e.deviceToken,auth:"",key:"",userId:_SgmntfY_._getUserId(),agent:"Safari",endpoint:"",deviceType:_SgmntfY_._variables.ua.type.toUpperCase(),isVapid:!1};_SgmntfY_._pushSendFetchSubscriptionAllowRequest(n,t)},_pushSendFetchSubscriptionAllowRequest:function(e,t){var n=_SgmntfY_._getPushUrl()+"subscription/push?apiKey="+_SgmntfY_._variables.apiKey+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&isSilent="+t;fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(t){t.ok||t.text().then(function(t){_SgmntfY_._pushSendPermissionError(e.subscriptionId,t)})},function(t){_SgmntfY_._pushSendPermissionError(e.subscriptionId,t),_SgmntfY_.LOG_MESSAGE("ERROR","Error while sending subscription info to BE: "+t)})},_pushSendPermissionError:function(e,t){var n=_SgmntfY_._getPushUrl()+"subscription/error?apiKey="+_SgmntfY_._variables.apiKey,a={subscriptionId:e,userId:_SgmntfY_._getUserId(),message:t};fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})},_pushUrlBase64ToUint8Array:function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),a=new Uint8Array(n.length),r=0;r<n.length;++r)a[r]=n.charCodeAt(r);return a},_pushSetPromptInteractionForVapid:function(){"Notification"in window&&("denied"===Notification.permission?_SgmntfY_._variables.pushInfo.promptInteraction="denied":"default"===Notification.permission&&(_SgmntfY_._variables.pushInfo.promptInteraction="close"))},GA:{activateTracker:function(){try{if(++_SgmntfY_._variables.ga.activateTriedCount,_SgmntfY_._variables.ga.activateTriedCount>_SgmntfY_._variables.ga.activateTryCount)return;var _tracker=eval(_SgmntfY_._variables.ga.tracker);if(_tracker){if(_tracker.loaded)if(_SgmntfY_._variables.ga.tracker=_tracker,_SgmntfY_._variables.ga.trackerName)_SgmntfY_._variables.ga.activated=!0;else for(var trackerList=_SgmntfY_._variables.ga.tracker.getAll(),i=0;i<trackerList.length;i++){var tracker=trackerList[i];if(tracker){_SgmntfY_._variables.ga.trackerName=tracker.get("name"),_SgmntfY_._variables.ga.activated=!0;break}}}else _SgmntfY_.LOG_MESSAGE("WARN","Error evaluating _SgmntfY_._variables.ga.tracker, cannot evaluate ga!")}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error evaluating _SgmntfY_._variables.ga.tracker: "+e)}},setDimension:function(e,t){_SgmntfY_._variables.ga.activated||(_SgmntfY_.GA.activateTracker(),_SgmntfY_._variables.ga.activateTriedCount<_SgmntfY_._variables.ga.activateTryCount&&_SgmntfY_.GA.setDimension(e,t));var n=_SgmntfY_._variables.ga.trackerName;n&&_SgmntfY_._variables.ga.tracker(n+".set",e,t)},setGroup:function(e){_SgmntfY_.GA.setDimension(_SgmntfY_._variables.ga.dimensions.sgmGroup,e),_SgmntfY_._variables.ga.activeGroup=e},setUser:function(e){_SgmntfY_.GA.setDimension(_SgmntfY_._variables.ga.dimensions.sgmUser,e)},setSession:function(e){_SgmntfY_.GA.setDimension(_SgmntfY_._variables.ga.dimensions.sgmSession,e)},setPage:function(e){_SgmntfY_.GA.setDimension(_SgmntfY_._variables.ga.dimensions.sgmPage,e)},setWidget:function(e){_SgmntfY_.GA.setDimension(_SgmntfY_._variables.ga.dimensions.sgmWidget,e)},setProduct:function(e){_SgmntfY_.GA.setDimension(_SgmntfY_._variables.ga.dimensions.sgmProduct,e)},eventCategory:function(){if(_SgmntfY_._variables.ga.activeGroup)return"Segmentify."+_SgmntfY_._variables.ga.activeGroup;if(!_SgmntfY_._variables.ga.group||"CHECK"!==_SgmntfY_._variables.ga.group){var e=_SgmntfY_._variables.ga.groups[_SgmntfY_._variables.ga.group];return e?"Segmentify."+e:"Segmentify."+_SgmntfY_._variables.ga.groups.unknown}_SgmntfY_.GA.getGroup(_SgmntfY_._getUserId(),_SgmntfY_.GA.setGroup)},convertAndSend:function(e){var t={eventCategory:e.category||_SgmntfY_.GA.eventCategory(),eventAction:e.action,eventLabel:e.label,eventValue:e.value,nonInteraction:!0};t[_SgmntfY_._variables.ga.dimensions.sgmPage]=_SgmntfY_._variables.ga.activePage,e.sgmWidget&&(t[_SgmntfY_._variables.ga.dimensions.sgmWidget]=e.sgmWidget),e.sgmProduct&&(t[_SgmntfY_._variables.ga.dimensions.sgmProduct]=e.sgmProduct),_SgmntfY_.GA.sendEvent(t)},sendEvent:function(e){if(_SgmntfY_._variables.ga.enabled){if(!e.eventCategory)return e.eventCategory=_SgmntfY_.GA.eventCategory(),void _SgmntfY_._variables.segmentifyObj("ga:event",e);_SgmntfY_._variables.ga.activated||_SgmntfY_.GA.activateTracker(),_SgmntfY_._variables.ga.activated?_SgmntfY_._variables.ga.tracker(_SgmntfY_._variables.ga.trackerName+".send","event",e):_SgmntfY_._variables.ga.activateTriedCount<_SgmntfY_._variables.ga.activateTryCount&&_SgmntfY_._variables.segmentifyObj("ga:event",e)}},sendPageView:function(e){_SgmntfY_.GA.convertAndSend({action:"Page View",label:e||_SgmntfY_._variables.ga.activePage})},sendWidgetImpression:function(e,t){_SgmntfY_.GA.convertAndSend({action:"Widget Impression",label:e,sgmWidget:t})},sendWidgetView:function(e,t){_SgmntfY_.GA.convertAndSend({action:"Widget View",label:e,sgmWidget:t})},sendWidgetClick:function(e,t){_SgmntfY_.GA.convertAndSend({action:"Widget Click",label:e,sgmWidget:t})},sendArrowClick:function(e,t){_SgmntfY_.GA.convertAndSend({action:"Arrow Click",label:e,sgmWidget:t})},sendProductClick:function(e,t,n){_SgmntfY_.GA.convertAndSend({action:"Product Click",label:e,sgmWidget:t,sgmProduct:n})},sendQuickBasket:function(e,t,n){_SgmntfY_.GA.convertAndSend({action:"Quick Basket",label:e,sgmWidget:t,sgmProduct:n})},getGroup:function(e,t){if(!_SgmntfY_._variables.apiKey)return t(_SgmntfY_._variables.ga.groups.unknown);var n=_SgmntfY_._getEventUrl()+"/v2/global/user/"+_SgmntfY_._variables.apiKey+"/"+e;_SgmntfY_._getRequest(n,{},function(e){var n="REAL"===e.customObject?_SgmntfY_._variables.ga.groups.groupA:_SgmntfY_._variables.ga.groups.control;_SgmntfY_._storePersistentData(_SgmntfY_._variables.ga.groupCookie,n,1),t(n)},function(){t(_SgmntfY_._variables.ga.groups.unknown)})}},_getRequest:function(e,t,n,a){var r=new XMLHttpRequest;for(var i in r.open("GET",e,!0),r.responseType="json",r.timeout=5e3,t||{})r.setRequestHeader(i,t[i]);r.ontimeout=function(e){a()},r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE)if(r.status>=200&&r.status<400){var e=r.response;try{"string"==typeof e&&(e=JSON.parse(e))}catch(e){}n(e)}else a()},r.send()},_sourceOfUrl:function(){var e="",t=document.referrer||document.URL;if(t){var n=_SgmntfY_._getQueryParameter("gclid"),a=_SgmntfY_._getQueryParameter("utm_medium");function r(e){var n=t,a=["facebook","instagram","pinterest","snapchat","tiktok","twitter"];return e?!!a.find(function(e){return n.indexOf(e)>-1}):a.find(function(e){return n.indexOf(e)>-1})}function i(e){if(e){return{source:"SOCIAL",subSource:{facebook:"FACEBOOK",instagram:"INSTAGRAM",pinterest:"PINTEREST",snapchat:"SNAPCHAT",twitter:"TWITTER",tiktok:"TIKTOK"}[r(!1)]}}return null}if(r(!0))return i(document.referrer);if(n.length)return"PAID";if(a.length)switch(a){case"social":e="SOCIAL";break;case"organic":e="SEARCH";break;case"cpc":case"cpm":case"ocpm":case"paid-media":case"affiliate":case"banner":case"retargeting":case"shopping":e="PAID";break;case"email":e="EMAIL"}if(!e.length&&_SgmntfY_._notNull(document.referrer)){var s=document.referrer.replace("https://","").replace("http://","");-1!==(s=s.substring(0,s.indexOf("/"))).indexOf(_SgmntfY_._variables.domain)?e="INTERNAL":r(s)?e=i(s):-1!==s.indexOf("google")||-1!==s.indexOf("g.co")||-1!==s.indexOf("bing")||-1!==s.indexOf("yandex")||-1!==s.indexOf("yahoo")?e="SEARCH":-1===s.indexOf("cimri.com")&&-1===s.indexOf("akakce.com")&&-1===s.indexOf("ucuzcu.com")&&-1===s.indexOf("bilio.com")&&-1===s.indexOf("auspreiser.de")&&-1===s.indexOf("billiger.de")&&-1===s.indexOf("dooyoo.de")&&-1===s.indexOf("geizhals.de")&&-1===s.indexOf("guenstiger.de")&&-1===s.indexOf("idealo.de")&&-1===s.indexOf("kelkoo.de")&&-1===s.indexOf("preis.de")&&-1===s.indexOf("preissuchmaschine.de")&&-1===s.indexOf("geizkragen.de")&&-1===s.indexOf("preisvergleich.de")&&-1===s.indexOf("preisroboter.de")&&-1===s.indexOf("vergelijk.be")&&-1===s.indexOf("pazaruvaj")&&-1===s.indexOf("nabava.net")&&-1===s.indexOf("ceneje.si")&&-1===s.indexOf("heureka")&&-1===s.indexOf("pricerunner")&&-1===s.indexOf("hinnavaatlus")&&-1===s.indexOf("skroutz.gr")&&-1===s.indexOf("agrep.hu")&&-1===s.indexOf("arukereso.hu")&&-1===s.indexOf("trovaprezzi.it")&&-1===s.indexOf("prisjakt.no")&&-1===s.indexOf("prisguiden.no")&&-1===s.indexOf("ceneo.pl")&&-1===s.indexOf("kuantokusta.pt")&&-1===s.indexOf("compari.ro")||(e="LISTING")}e.length||(e="OTHER")}return e},_enableSerializeForm:function(e){e.fn.sgmSerializeForm||(e.fn.sgmSerializeForm=function(){"use strict";var t={};return e.each(this.serializeArray(),function(n,a){var r=t[a.name];null!=r?e.isArray(r)?r.push(a.value):t[a.name]=[r,a.value]:t[a.name]=a.value}),e.each(t,function(n,a){null!=a&&e.isArray(a)&&(t[n]=a.join())}),t})},init:function(){_SgmntfY_._variables.namespace=window.SegmentifyTrackingObject,_SgmntfY_._variables.segmentifyObj=window[_SgmntfY_._variables.namespace];var e=_SgmntfY_._getQueryParameter("_sgm_tracking");if(_SgmntfY_._isNotEmpty(e)&&_SgmntfY_._setTracking(e),"disabled"!==_SgmntfY_._getTracking())if(_SgmntfY_._notNull(_SgmntfY_._variables.segmentifyObj)&&_SgmntfY_._notNull(_SgmntfY_._variables.segmentifyObj.q)){if(_SgmntfY_._variables.initTimer&&window.clearTimeout(_SgmntfY_._variables.initTimer),_SgmntfY_.modernize(),_SgmntfY_.LOG_MESSAGE("DEBUG","*** Segmentify is loading... ***"),_SgmntfY_._extend(!0,_SgmntfY_._variables,_SgmntfY_._variables.segmentifyObj.config),_SgmntfY_._functions.setLogLevel(_SgmntfY_._variables.logLevel),!(_SgmntfY_._variables.domain&&document.URL.indexOf(_SgmntfY_._variables.domain)>=0))return void console.error("Segmentify domain is not set properly: "+_SgmntfY_._variables.domain);if(window.onpagehide=_SgmntfY_._windowPageHide,null==_SgmntfY_._variables.jq)_SgmntfY_._loadJavascript(_SgmntfY_._variables.jQueryUrl,!0,function(){_SgmntfY_._variables.jq=jQuery.noConflict(!0),_SgmntfY_._enableSerializeForm(_SgmntfY_._variables.jq),_SgmntfY_._initializeDelayedActions(),_SgmntfY_._initializeDelayedCampaigns(),_SgmntfY_._initializePageViewsCampaigns(),_SgmntfY_._sendTrackedEvent(),_SgmntfY_._setTestMode(),_SgmntfY_._setQaMode()});else{if(!_SgmntfY_._checkVersion("1.7",_SgmntfY_._variables.jq.fn.jquery))return void console.error("Segmentify requires jQuery version >= 1.7");_SgmntfY_._enableSerializeForm(_SgmntfY_._variables.jq),_SgmntfY_._initializeDelayedActions(),_SgmntfY_._initializeDelayedCampaigns(),_SgmntfY_._initializePageViewsCampaigns(),_SgmntfY_._sendTrackedEvent(),_SgmntfY_._setTestMode(),_SgmntfY_._setQaMode()}!1===_SgmntfY_._variables.doNotTrack&&!1===_SgmntfY_._variables.pa.loaded&&(_SgmntfY_._loadJavascript(_SgmntfY_._variables.paUrl,!0,function(){_SgmntfY_._variables.pa.loaded=!0,_SgmntfY_._variables.pa.data=__PA.default}),setTimeout(function(){!1===_SgmntfY_._variables.pa.loaded&&(_SgmntfY_._variables.pa.loaded=!0,_SgmntfY_._variables.pa.disabled=!0)},5*_SgmntfY_._variables.constants.frequency)),null==_SgmntfY_._variables.mustache&&(_SgmntfY_._variables.mustache={},initializeMustache(_SgmntfY_._variables.mustache),_SgmntfY_._variables.mustache.tags=["[[","]]"]),_SgmntfY_._updateBrowserAndDeviceInfo(),_SgmntfY_.LOG_MESSAGE("DEBUG","*** Running on a "+_SgmntfY_._variables.ua.type+" ***"),_SgmntfY_.LOG_MESSAGE("DEBUG","*** Segmentify loaded and started... ***"),_SgmntfY_.run(),_SgmntfY_._dispatchInitEvent()}else{if(++_SgmntfY_._variables.initTryCount,_SgmntfY_._variables.initTryCount>_SgmntfY_._variables.initTryLimit)return void window.clearTimeout(_SgmntfY_._variables.initTimer);window.clearTimeout(_SgmntfY_._variables.initTimer),_SgmntfY_._variables.initTimer=window.setTimeout(_SgmntfY_.init,100)}else _SgmntfY_.LOG_MESSAGE("DEBUG","End-user opted-out Segmentify tracking!")},_initializeDelayedActions:function(){try{var e=_SgmntfY_._getDelayedActions();_SgmntfY_._setDelayedActions([]);for(var t=new Date,n=0;n<e.length;n++)e[n].delayDate=new Date(e[n].delayDate),e[n].delayDate.getTime()>t.getTime()&&_SgmntfY_._addDelayedAction(e[n])}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't initialize delayed actions: "+e)}},_initializeDelayedCampaigns:function(){try{var e=_SgmntfY_._getDelayedCampaigns();_SgmntfY_._setDelayedCampaigns([]);for(var t=new Date,n=0;n<e.length;++n)e[n].time=new Date(e[n].time),e[n].time.getTime()>t.getTime()&&_SgmntfY_._addDelayedCampaign(e[n])}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't initialize delayed campaigns: "+e)}},_initializePageViewsCampaigns:function(){try{for(var e=_SgmntfY_._getPageViewsCampaigns(),t=0;t<e.length;++t)e[t].pageView=e[t].pageView-1,_SgmntfY_._setPageViewsCampaigns(e),_SgmntfY_._triggerPageViewsCampaign(e[t])}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't initialize pageview campaigns: "+e)}},_dispatchInitEvent:function(){try{if(window.dispatchEvent){var e={testMode:_SgmntfY_._getTestMode(),qaMode:_SgmntfY_._getQaMode()};window.dispatchEvent(new CustomEvent("segmentifyInited",{detail:e}))}}catch(e){}},_ajaxError:function(e,t,n,a){_SgmntfY_.LOG_MESSAGE("WARN","Error in sending event:\nEvent Data: "+JSON.stringify(e.data)+"\nResponse: "+t.responseText+"\nStatus: "+n+"\nError: "+a)},_ajaxSuccess:function(e,t,n){_SgmntfY_.LOG_MESSAGE("DEBUG","Success in sending event:\nEvent Data: "+JSON.stringify(e)+"\nStatus: "+n+"\nResponse Data: "+JSON.stringify(t))},_windowPageHide:function(){_SgmntfY_._variables.isPageHide=!0,window.clearTimeout(_SgmntfY_._variables.runTimer);for(var e=[];_SgmntfY_._variables.segmentifyObj.q.length>0;)try{var t=_SgmntfY_._variables.segmentifyObj.q.shift(),n=_SgmntfY_._functions.getFunction(t[0]),a=Array.prototype.slice.call(t,1);(i=n.apply(null,a)).originalParams.discardResponse="true",e.push(i)}catch(e){}for(var r=_SgmntfY_._getRetryQueue();r.length>0;)try{var i;(i=r.shift()).originalParams.discardResponse="true",e.push(i)}catch(e){}_SgmntfY_._setRetryQueue(e)},run:function(){try{var e;if(e=!0!==_SgmntfY_._variables.pa.wait||!0===_SgmntfY_._variables.pa.loaded,_SgmntfY_._variables.jq&&e&&(_SgmntfY_._variables.segmentifyObj.q&&_SgmntfY_._variables.segmentifyObj.q.length>0||_SgmntfY_._getDataLayer())&&!_SgmntfY_._variables.waitingKeys&&_SgmntfY_._variables.keysTryCount<5){var t=0;if(!1===_SgmntfY_._variables.doNotTrack){var n=_SgmntfY_._getUserId(),a=_SgmntfY_._getSessionId();_SgmntfY_._isEmpty(n)?t=2:_SgmntfY_._isEmpty(a)?t=1:_SgmntfY_._isNotEmpty(a)&&_SgmntfY_._variables.segmentifyObj.q.length>0&&(_SgmntfY_._storePersistentData(_SgmntfY_._variables.sessionStorageKey,a,0,_SgmntfY_._variables.storage.session.local),_SgmntfY_._storePersistentData(_SgmntfY_._variables.userStorageKey,n,390,_SgmntfY_._variables.storage.user.local))}if(t>0)_SgmntfY_._updateUserAndSessionId(t);else{if(_SgmntfY_._variables.segmentifyObj.q&&_SgmntfY_._variables.segmentifyObj.q.length>0){var r=_SgmntfY_._variables.segmentifyObj.q.splice(0,_SgmntfY_._variables.segmentifyObj.q.length);_SgmntfY_._functions.callFunction(r)}_SgmntfY_._getDataLayer()&&_SgmntfY_._consumeDataLayer()}}window.clearTimeout(_SgmntfY_._variables.runTimer),_SgmntfY_._variables.runTimer=window.setTimeout(_SgmntfY_.run,_SgmntfY_._variables.constants.frequency)}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error in run: "+e),window.clearTimeout(_SgmntfY_._variables.runTimer),_SgmntfY_._variables.runTimer=window.setTimeout(_SgmntfY_.run,_SgmntfY_._variables.constants.frequency)}},modernize:function(){"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),a=n.length>>>0;if(0===a)return-1;var r=+t||0;if(Math.abs(r)===1/0&&(r=0),r>=a)return-1;for(var i=Math.max(r>=0?r:a-Math.abs(r),0);i<a;){if(i in n&&n[i]===e)return i;i++}return-1}),Array.prototype.map||(Array.prototype.map=function(e,t){var n,a,r;if(null==this)throw new TypeError(" this is null or not defined");var i=Object(this),s=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),a=new Array(s),r=0;r<s;){var o,c;r in i&&(o=i[r],c=e.call(n,o,r,i),a[r]=c),r++}return a});var e=JSON.stringify;if(JSON.stringify=function(t,n,a){var r=Array.prototype.toJSON,i=Number.prototype.toJSON,s=String.prototype.toJSON;delete Number.prototype.toJSON,delete Array.prototype.toJSON,delete String.prototype.toJSON;var o=void 0;try{o=e(t,n,a)}catch(e){o=void 0}return r&&(Array.prototype.toJSON=r),i&&(Number.prototype.toJSON=i),s&&(String.prototype.toJSON=s),o},"function"!=typeof window.CustomEvent){function t(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}t.prototype=window.Event.prototype,window.CustomEvent=t}},LOG_MESSAGE:function(e,t){var n=_SgmntfY_._variables.logLevel,a=_SgmntfY_.LOG_LEVELS[e];void 0!==a&&a<=n&&console.log("Segmentify["+e+"]: "+t)},_experiment:{toString:function(e){try{for(var t=_SgmntfY_._experiment.config,n=Object.keys(t.modules),a=[],r=0;r<n.length;r++){var i=n[r];for(var s in e[i])if(Object.prototype.hasOwnProperty.call(e[i],s)){var o=e[i][s],c=t.modules[i];a.push([s,o,c].join(t.seperator.sub))}}return a.join(t.seperator.items)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in converting experiments to string: "+e)}},toJson:function(e){try{if(null===e||""===e)return{};for(var t=_SgmntfY_._experiment.config,n=e.split(t.seperator.items),a=Object.fromEntries(Object.entries(t.modules).map(function(e){return[e[1],e[0]]})),r={},i=0;i<n.length;i++){var s=n[i].split(t.seperator.sub),o=s[0],c=s[1],g=s[2];void 0===r[a[g]]&&(r[a[g]]={}),r[a[g]][o]=c}return r}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in converting experiments to JSON: "+e)}},store:function(e){var t=_SgmntfY_._experiment.config;_SgmntfY_.LOG_MESSAGE("INFO","Experiment stored: ["+e+"]"),_SgmntfY_._storePersistentData(t.storage.name,e,t.storage.expire)},get:function(){var e=_SgmntfY_._experiment.config;return _SgmntfY_._getPersistentData(e.storage.name)},preview:function(e){try{var t=_SgmntfY_._experiment.config,n=e||_SgmntfY_._getQueryParameter("_sgf_experiment");if(""===n)return;for(var a=n.split(t.seperator.sub)[0],r=n.split(t.seperator.sub)[1],i=Object.keys(t.modules),s=_SgmntfY_._experiment.toJson(_SgmntfY_._experiment.get()),o=0;o<i.length;o++){var c=i[o];void 0!==s[c]&&void 0!==s[c][a]&&(s[c][a]=r,_SgmntfY_._experiment.toString(s)!==_SgmntfY_._experiment.get()&&(_SgmntfY_.LOG_MESSAGE("INFO",'Experiment "'+a+'" group changed to the "'+r+'"'),_SgmntfY_._experiment.store(_SgmntfY_._experiment.toString(s))))}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in experiments preview: "+e)}},init:function(){return _SgmntfY_._experiment.preview(),_SgmntfY_._experiment.toJson(_SgmntfY_._experiment.get())||{}},config:{storage:{name:"_sgf_exp",expire:30},queryName:"_sgf_experiment",modules:{RECOMMENDATION:"R",SEARCH:"S",PUSH:"P",BT:"B"},seperator:{items:"|",sub:":"}}}};_SgmntfY_.init()}(window);