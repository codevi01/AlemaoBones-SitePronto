!function(){"use strict";const e=[];let t={};const n=function(){const[e,t]=window.location.pathname.match(/[0-9a-fA-F]{8}[-]?(?:[0-9a-fA-F]{4}[-]?){3}[0-9a-fA-F]{12}/g);return t}(),o={currentStep:"",isOptinCompleted:!1,isJourneyCompleted:!1},i={email:"email",whatsapp:"whatsapp",coupon:"coupon"};const a={email:function(){return{email:document.getElementById("optin-email"),whatsapp:document.getElementById("optin-phone")}},whatsapp:function(){return{email:document.getElementById("optin-email"),whatsapp:document.getElementById("optin-phone")}},coupon:function(){return{coupon:document.getElementById("coupon"),main:document.getElementById("main")}},showLoadingEmail:function(){return{showLoadingEmail:document.getElementById("loading-email-show"),hideLoadingEmail:document.getElementById("loading-email-hide")}},showLoadingWhatsApp:function(){return{showLoadingWhatsApp:document.getElementById("loading-phone-show"),hideLoadingWhatsApp:document.getElementById("loading-phone-hide")}}};function l(e){let t=a[e];"function"==typeof t&&(t=t()),o.currentStep=i[e]?e:o.currentStep;for(const n in t){const o=n==e?"block":"none";t[n]&&(t[n].style.display=o)}}function c(e,t,o){if(e.channelId=n,t){let n=new Promise(((n,o)=>{parent.postMessage(JSON.stringify(e),"*"),t.push(n)}));return o?function(e,t){let n;const o=new Promise(((e,o)=>{n=setTimeout((()=>{o(new Error("Event timed out"))}),t)})),i=e.then((function(e){return clearTimeout(n),e}));return Promise.race([i,o])}(n,o):n}return parent.postMessage(JSON.stringify(e),"*"),null}function d(e,t){for(;e.length;)e.shift()(t)}function s(e){return""===e?(document.getElementById("optin-email-is-valid").style.display="none",document.getElementById("optin-email-required").style.display="block",!1):(document.getElementById("optin-email-required").style.display="none",/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).trim().toLowerCase())?(document.getElementById("optin-email-is-valid").style.display="none",!0):(document.getElementById("optin-email-is-valid").style.display="block",!1))}function p(e){return""===e||e.replace(/\D/g,"").length<11?(document.getElementById("optin-phone-required").style.display="block",!1):(document.getElementById("optin-phone-required").style.display="none",!0)}function u(){return document.getElementById("agree").checked?(document.getElementById("agree-required").style.display="none",!0):(document.getElementById("agree-required").style.display="block",!1)}function r(){var e=document.getElementById("tooltipCoupon");e.innerHTML="Cupom copiado!",e.style.visibility="visible",e.style.opacity="1",setTimeout((function(){e.style.visibility="hidden"}),2e3)}window.addEventListener("message",(function(n){var i=JSON.parse(n.data);switch(i.event){case"init":t=i.data,!t.hasEmail&&t.haspluginemail?l("email"):t.hasWaba&&!t.hasPhone&&t.haspluginwa?l("whatsapp"):l("coupon");break;case"optin-email-response":case"optin-phone-response":d(e,i.data);break;case"on-show":c({event:"channel-event",type:"VIEW"}),c({event:"channel-event",type:"VIEW",step:o.currentStep});break;default:console.log("error")}}),!1),window.addEventListener("load",(function(){c({event:"ready"})})),document.getElementById("close").onclick=function(){c({event:"close"}),c({event:"channel-event",type:"REJECTION",step:o.currentStep}),console.log({isJourneyCompleted:o.isJourneyCompleted,isOptinCompleted:o.isOptinCompleted}),o.isJourneyCompleted?c({event:"channel-event",type:"CONCLUSION"}):o.isOptinCompleted?c({event:"channel-event",type:"CONCLUSION_WITH_REJECTION"}):c({event:"channel-event",type:"REJECTION"})},document.getElementById("email").addEventListener("keyup",(function(e){s(e.target.value)})),document.getElementById("optin-email").addEventListener("submit",(function(n){if(n.preventDefault(),s(document.getElementById("email").value)&&u())l("showLoadingEmail"),c({event:"optin-email",formData:{email:n.target[0].value.trim()?n.target[0].value.trim():""}},e,3e4).then((e=>{c({event:"channel-event",type:"CONCLUSION",step:o.currentStep}),o.isOptinCompleted=!0,t.hasWaba&&!t.hasPhone&&t.haspluginwa?l("whatsapp"):(o.isJourneyCompleted=!0,l("coupon")),c({event:"channel-event",type:"VIEW",step:o.currentStep})})).catch((e=>{l("email")}));else{const e=[];s(document.getElementById("email").value)||e.push("Email"),u()||e.push("Privacy"),c({event:"channel-event",type:"CLICK_FAILURE",step:o.currentStep,additionalData:e})}})),document.getElementById("phone").addEventListener("input",(function(e){p(e.target.value=e.target.value.replace(/\D/g,"").replace(/^(\d)/,"($1").replace(/^(\(\d{2})(\d)/,"$1) $2").replace(/(\d{4})(\d{1,5})/,"$1-$2").replace(/(-\d{5})\d+?$/,"$1"))})),document.getElementById("optin-phone").addEventListener("submit",(function(n){if(n.preventDefault(),p(document.getElementById("phone").value)&&u())l("showLoadingWhatsApp"),c({event:"optin-phone",formData:{phone:n.target[0].value.trim()?n.target[0].value.trim():""}},e,3e4).then((e=>{console.log("Success: ",e),t.hasWaba&&(c({event:"channel-event",type:"CONCLUSION",step:o.currentStep}),o.isOptinCompleted=!0,o.isJourneyCompleted=!0,l("coupon"),c({event:"channel-event",type:"VIEW",step:o.currentStep}),window.open(encodeURI(`https://socl.me/whatsapp/${t.customerId}?text=${document.getElementById("register-phone").getAttribute("data-text")}`)))})).catch((e=>{console.log("Catch: ",e),l("whatsapp")}));else{const e=[];p(document.getElementById("phone").value)||e.push("Phone"),u()||e.push("Privacy"),c({event:"channel-event",type:"CLICK_FAILURE",step:o.currentStep,additionalData:e})}})),document.getElementById("agree").addEventListener("change",(function(e){u()})),document.getElementById("offers").addEventListener("click",(function(e){c({event:"close"}),c({event:"channel-event",type:"CONCLUSION",step:o.currentStep}),c({event:"channel-event",type:"CONCLUSION"}),window.open(encodeURI(`https://socl.me/store/${t.customerId}?cupom=${document.getElementById("text-code").innerText}`),"_top")})),document.getElementById("privacy").addEventListener("click",(function(e){window.open(encodeURI(`https://socl.me/policysmb/${t.customerId}`))})),document.getElementById("copy").onclick=function(){if(void 0!==navigator.clipboard)navigator.clipboard.writeText(document.getElementById("text-code").innerText).then((function(){r(),console.log("successful!")}),(function(e){console.log("unsuccessful!",e)}));else{console.log("navigator.clipboard");var e=document.createElement("textarea");e.value=document.getElementById("text-code").innerText,e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{var t=document.execCommand("copy")?"successful":"unsuccessful";r(),console.log(t)}catch(e){console.log("Was not possible to copy te text: ",e)}document.body.removeChild(e)}}}();
